<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>MASTEMR - 10 Correlation and regression</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><link rel="stylesheet" href="../css/mastemr.css">
</head>
<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg navbar-dark "><div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="index.qmd" class="navbar-brand navbar-brand-logo">
    <img src="../images/KCL_logo.png" alt="" class="navbar-logo"></a>
    <a class="navbar-brand" href="index.qmd">
    <span class="navbar-title">MASTEMR</span>
    </a>
  </div>
        <div class="quarto-navbar-tools ms-auto">
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../chapters/01-Intro_to_quant_methods.html">Sessions</a></li><li class="breadcrumb-item"><a href="../chapters/10-teachers_relationships_and_STEM_achievement.html">10 Correlation and regression</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation docked overflow-auto"><div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Home</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Sessions</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/01-Intro_to_quant_methods.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">01 Introduction</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false">
 <span class="menu-text">02 Intro to R</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth2 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/02-1-Intro_to_analysis_software.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">02 Introduction to R</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/02-2-Intro_to_analysis_software.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">02 Loading packages and exploring data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/02-3-Intro_to_analysis_software.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">02 Piping and dplyr</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/02-4-Intro_to_graphs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">02 Intro to graphs</span></a>
  </div>
</li>
      </ul>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/03-Differing_performance_in_STEM_PISA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">03 Descriptive Statistics</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/04-Presentations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">04 Presentations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/05-Introduction_to_PISA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">05 Introduction to PISA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/06-ChisqPISA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">06 Maths anxiety</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/07-Inquiry_learning_in_science_RB_version.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">07 Inquiry learning</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/08-Science_capital.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">08 Science capital</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/09-Assignment_3_tutorials.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">09 Assignment 3 tutorials</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/10-teachers_relationships_and_STEM_achievement.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">10 Correlation and regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/11-selecting_statistical_tools.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">11 Selecting statistical tools</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/12-effective_international_STEM_ed.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">12 Effective international STEM education</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/QandA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Questions and Answers</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Data sets</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/A1-PISA_analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">PISA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/A2-DfE_analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">DfE England</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/A3-TIMSS_analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">TIMSS</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/A4-Other_datasets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Other datasets</span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">On this page</h2>
   
  <ul>
<li>
<a href="#correlation" id="toc-correlation" class="nav-link active" data-scroll-target="#correlation"><span class="header-section-number">1</span> Correlation</a>
  <ul class="collapse">
<li><a href="#other-correlation-coefficients" id="toc-other-correlation-coefficients" class="nav-link" data-scroll-target="#other-correlation-coefficients"><span class="header-section-number">1.1</span> Other correlation-coefficients</a></li>
  <li><a href="#reporting-correlations" id="toc-reporting-correlations" class="nav-link" data-scroll-target="#reporting-correlations"><span class="header-section-number">1.2</span> Reporting correlations</a></li>
  <li><a href="#questions" id="toc-questions" class="nav-link" data-scroll-target="#questions"><span class="header-section-number">1.3</span> Questions</a></li>
  </ul>
</li>
  <li>
<a href="#regression" id="toc-regression" class="nav-link" data-scroll-target="#regression"><span class="header-section-number">2</span> Regression</a>
  <ul class="collapse">
<li><a href="#linear-models-and-regression" id="toc-linear-models-and-regression" class="nav-link" data-scroll-target="#linear-models-and-regression"><span class="header-section-number">2.1</span> Linear models and regression</a></li>
  <li><a href="#r-squared" id="toc-r-squared" class="nav-link" data-scroll-target="#r-squared"><span class="header-section-number">2.2</span> R squared</a></li>
  <li><a href="#questions-1" id="toc-questions-1" class="nav-link" data-scroll-target="#questions-1"><span class="header-section-number">2.3</span> Questions</a></li>
  </ul>
</li>
  <li><a href="#multiple-linear-regression" id="toc-multiple-linear-regression" class="nav-link" data-scroll-target="#multiple-linear-regression"><span class="header-section-number">3</span> Multiple linear regression</a></li>
  <li><a href="#reporting-regression" id="toc-reporting-regression" class="nav-link" data-scroll-target="#reporting-regression"><span class="header-section-number">4</span> Reporting regression</a></li>
  <li><a href="#questions-2" id="toc-questions-2" class="nav-link" data-scroll-target="#questions-2"><span class="header-section-number">5</span> Questions</a></li>
  <li><a href="#sec-z-values" id="toc-sec-z-values" class="nav-link" data-scroll-target="#sec-z-values"><span class="header-section-number">6</span> Standardising results with z-values</a></li>
  <li>
<a href="#sec-Stoet-Geary" id="toc-sec-Stoet-Geary" class="nav-link" data-scroll-target="#sec-Stoet-Geary"><span class="header-section-number">7</span> Recreating Stoet and Geary’s paper</a>
  <ul class="collapse">
<li><a href="#loading-data-sets" id="toc-loading-data-sets" class="nav-link" data-scroll-target="#loading-data-sets"><span class="header-section-number">7.1</span> Loading data sets</a></li>
  <li><a href="#sec-leftjoin" id="toc-sec-leftjoin" class="nav-link" data-scroll-target="#sec-leftjoin"><span class="header-section-number">7.2</span> Linking data using <code>left_join</code></a></li>
  <li><a href="#sec-standard-stoet-geary" id="toc-sec-standard-stoet-geary" class="nav-link" data-scroll-target="#sec-standard-stoet-geary"><span class="header-section-number">7.3</span> Standardising PISA results</a></li>
  </ul>
</li>
  <li><a href="#seminar-tasks" id="toc-seminar-tasks" class="nav-link" data-scroll-target="#seminar-tasks"><span class="header-section-number">8</span> Seminar Tasks</a></li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title">10 Correlation and regression</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header><!-- Correlation 
https://docs.google.com/presentation/d/1QlXhCOaFMRyg8IJ2JczKkpjx26eS9BRi/edit#slide=id.p1--><!-- Correlation 
https://docs.google.com/presentation/d/1QlXhCOaFMRyg8IJ2JczKkpjx26eS9BRi/edit#slide=id.p1
@mikk2016relationships
--><p>In this session we will be exploring the use of <strong>linear regression</strong> to describe data and predict results. We will be looking for patterns within the PISA data sets, as well we trying to recreate some of the controversial findings from <span class="citation" data-cites="stoet2018gender">Stoet and Geary (<a href="#ref-stoet2018gender" role="doc-biblioref">2018</a>)</span> by linking <code>PISA_2018</code> data to global gender equality indices using the <code>left_join</code> function.</p>
<p>There are two types of statistics that we can create:</p>
<p><strong>Descriptive statistics</strong> describe/summarise a data set. E.g. what’s the average height of a woman, how many people called George were born in Somerset each year since 1921?</p>
<p><strong>Inferential statistics</strong> estimate something from a set of data, make generalisations about larger populations. E.g. If I know the height of a woman, can I predict her shoe size? If I meet someone called George, what is the likelihood that they were born in Somerset?</p>
<p>The first few sessions of this course taught you how to use R to perform descriptive statistics, with you finding the <code>mean</code>, <code>max</code>, <code>min</code> etc of data. Following sessions have given you a range of inferential tools, for example chi-square, t-tests and ANOVA. This session will introduce you to <em>linear regression</em> a means by which you can predict the value of a variable based on the value of another variable. Before we can start using linear regression we will introduce you to <em>correlation</em>, another type of inferential statistics.</p>
<section id="correlation" class="level1" data-number="1"><h1 data-number="1">
<span class="header-section-number">1</span> Correlation</h1>
<p>Correlation gives the direction and strength of the relationship between two numeric variables. For example we might see a relationship between the reading level of a student and their maths results in the UK: the better a student is at reading, typically, the higher their maths grade. Correlation allows us to describe this relation statistically:</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="10-teachers_relationships_and_STEM_achievement_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The graph above shows that there is a correlation between Maths score and Reading score. This relationship is a <em>positive</em> one, i.e.&nbsp;as the reading level of an individual increases the maths grade is also likely to increase. The strength, <em>correlation coefficient</em> (<code>Pearson's r</code>) of the relationship between these two numeric fields is 0.7812. The correlation coefficient runs from -1 to +1.</p>
<ul>
<li>If the correlation coefficient (r) is negative, i.e.&nbsp;as one factor increase the other declines, the slope of the line of best-fit will be negative. E.g “The more time you spend running on a treadmill, the more calories you will burn”</li>
<li>If the correlation coefficient (r) is positive, i.e.&nbsp;as one factor increase the other increases, the slope of the line of best-fit will be positive. E.g. “As the temperature decreases, more heaters are purchased.”</li>
<li>If the correlation coefficient (r) is 0, i.e one factor increasing doesn’t impact the other factor, the slope of the line of best-fit will be flat. E.g. “the number of trees in a city has no relation to the number of chocolate bars purchased by children”</li>
</ul>
<div class="cell">
<div class="cell-output-display">
<p><img src="10-teachers_relationships_and_STEM_achievement_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>To run the correlation test in R we use the <code>cor.test</code> function:</p>
<p><code>cor.test(&lt;vector1&gt;, &lt;vector2&gt;, method = "pearson")</code></p>
<p>For our data we will be using the <code>PV1MATH</code> and <code>PV1READ</code> columns.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
    Pearson's product-moment correlation

data:  corr_data$PV1MATH and corr_data$PV1READ
t = 147.09, df = 13816, p-value &lt; 2.2e-16
alternative hypothesis: true correlation is not equal to 0
95 percent confidence interval:
 0.7746249 0.7876230
sample estimates:
      cor 
0.7812086 </code></pre>
</div>
</div>
<ul>
<li>
<code>df</code> the number of ways that the data can vary, the larger this number the more ways the data could have been different</li>
<li>
<code>p-value</code> significance of the result, can we dismiss the null-hypothesis that there isn’t a relationship between maths score and wealth as the p-value is less than <code>0.05</code>
</li>
<li>
<code>sample estimates</code> the strength of the relationship between the factors</li>
<li>
<code>confidence intervals</code> the upper and lower limit of where the correlation coefficient is likely to lie, with 95% confidence.</li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Degrees of freedom (<code>df</code>)</p>
<p>Two individuals from different countries might have a weight difference of 5 KG. So what?! But if <em>average</em> weights between <em>whole</em> populations of countries vary by 5 KG then this becomes much more interesting.</p>
<p>Roughly: Number of independent values that can vary without questioning the significance of the model. So the more <code>df</code> you have, the safer your model. Degrees of freedom can be calculated by looking at the number of values that can vary, often this is the number of observations that you have minus one – if you had just one element it wouldn’t be able to vary against anything else:</p>
<p><code>df = n - 1</code></p>
</div>
</div>
<section id="other-correlation-coefficients" class="level2" data-number="1.1"><h2 data-number="1.1" class="anchored" data-anchor-id="other-correlation-coefficients">
<span class="header-section-number">1.1</span> Other correlation-coefficients</h2>
<p>When looking for correlations in data that is <em>non-parametric</em>, i.e.&nbsp;not normally distributed you could use <em>Spearman’s rank order correlation-coefficient (rho ρ)</em> rather than <em>Pearson’s r</em>. <code>cor.test(... method = "...")</code> allows you to specify the <code>method</code> used for correlation, you can set this to Spearman’s rho by writing <code>method = "spearman"</code></p>
<p>Data will need to contain continuous or ordinal variables. The Spearman correlation coefficient is based on the <em>ranked</em> values for each variable rather than the raw data. The Spearman correlation between two variables is equal to the Pearson correlation between the rank values of those two variables.</p>
<p>We want to look at the correlation between attitudes towards the learning activities in schools (<code>ATTLNACT</code>) and wealth (<code>WEALTH</code>) for females from the UK with fathers who are Cooks.</p>
<p>Graphing this data, it is unclear if it is normalised:</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="10-teachers_relationships_and_STEM_achievement_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We can run the <em>Shapiro-Wilk Test</em> to check for the the normality of the data, any alpha value greater than <code>0.05</code> means we can assume that the data is normally distributed.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
    Shapiro-Wilk normality test

data:  sub_data$ATTLNACT
W = 0.84971, p-value = 0.003354</code></pre>
</div>
</div>
<p>In this case the data <em>isn’t</em> normally distributed as <code>p &lt; 0.05</code> and we need to use a non-parametric correlation test. We need to run <em>Spearman</em> rather than <em>Pearson</em>:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
    Spearman's rank correlation rho

data:  sub_data$WEALTH and sub_data$ATTLNACT
S = 1369, p-value = 0.3097
alternative hypothesis: true rho is not equal to 0
sample estimates:
      rho 
0.2269763 </code></pre>
</div>
</div>
<p>The result shows no significant correlation (<code>p=0.31</code>) between wealth and attitude to school for this group of students</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>the <em>central limit theorem</em> means that when you have a sufficiently large sample you can presume that the data is normally distributed. As a rule of thumb <em>“30 is the magic number”</em>, and any samples you are studying with 30 or more data items can be treated as parametric, e.g.&nbsp;you would always use pearson when running correlation analysis on 30 or more items.</p>
</div>
</div>
<p>When dealing with non-parametric and small data sets you can also use <strong>Kendall’s Tau</strong> i.e.&nbsp;<code>cor.test(... method = "kendall")</code></p>
</section><section id="reporting-correlations" class="level2" data-number="1.2"><h2 data-number="1.2" class="anchored" data-anchor-id="reporting-correlations">
<span class="header-section-number">1.2</span> Reporting correlations</h2>
<p>To interpret the correlation co-efficient of a model we can use the following table:</p>
<table class="table">
<thead><tr class="header">
<th>Correlation co-efficient</th>
<th>Relationship</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>.70 or higher</td>
<td>very strong positive</td>
</tr>
<tr class="even">
<td>.40 to .69</td>
<td>strong positive</td>
</tr>
<tr class="odd">
<td>.30 to .39</td>
<td>moderate positive</td>
</tr>
<tr class="even">
<td>.20 to .29</td>
<td>weak positive</td>
</tr>
<tr class="odd">
<td>.01 to .19</td>
<td>negligible or none</td>
</tr>
<tr class="even">
<td>0</td>
<td>no relationship</td>
</tr>
<tr class="odd">
<td>-.01 to -.19</td>
<td>negligible or none</td>
</tr>
<tr class="even">
<td>-.20 to -.29</td>
<td>weak negative</td>
</tr>
<tr class="odd">
<td>-.30 to -.39</td>
<td>moderate negative</td>
</tr>
<tr class="even">
<td>-.40 to -.69</td>
<td>strong negative</td>
</tr>
<tr class="odd">
<td>-.70 or higher</td>
<td>very strong negative</td>
</tr>
</tbody>
</table>
<p>When writing a report we might present our findings like this:</p>
<blockquote class="blockquote">
<p>There was no significant relationship between the perceived quality of sleep and its impact on Mood, <em>r</em> = -.12, <em>p</em> = .17</p>
</blockquote>
<p>or</p>
<blockquote class="blockquote">
<p>There is a significant very strong correlation between overall well-being and life satisfaction, <em>r</em> = .86, <em>p</em> = .00</p>
</blockquote>
</section><section id="questions" class="level2" data-number="1.3"><h2 data-number="1.3" class="anchored" data-anchor-id="questions">
<span class="header-section-number">1.3</span> Questions</h2>
<div class="question">
<p>Use <code>cor.test</code> to explore the following relationships:</p>
<ol type="1">
<li>
<code>PV1MATH</code> to <code>PV1SCIE</code>, is this a stronger relationship than that between Maths and Reading?</li>
</ol>
<ol start="2" type="1">
<li>The wealth <code>WEALTH</code> of females <code>ST004D01T</code> and their Reading <code>PV1READ</code> score, how does this compare to males? Why might they be different?</li>
</ol>
<ol start="3" type="1">
<li>For the <code>United Kingdom</code> How does the sense of belonging to school <code>BELONG</code> correlate with the attitude to learning activities <code>ATTLNACT</code>? How does the UK compare against other countries?</li>
</ol>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>If you want to find all the <code>numeric</code> fields, i.e.&nbsp;the fields that you can easily run correlation calculations on, use the following code to list them:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code> [1] "WVARSTRR"   "ESCS"       "LMINS"      "CNTSCHID"   "CNTSTUID"  
 [6] "ST060Q01NA" "MMINS"      "SMINS"      "TMINS"      "CULTPOSS"  
[11] "WEALTH"     "PV1MATH"    "PV1READ"    "PV1SCIE"    "ATTLNACT"  
[16] "BELONG"     "DISCLIMA"  </code></pre>
</div>
</div>
</div>
</div>
</section></section><section id="regression" class="level1" data-number="2"><h1 data-number="2">
<span class="header-section-number">2</span> Regression</h1>
<p>Correlation allows us to see the strength of the relationship but it doesn’t allow us to <em>predict</em> what would happen if a variable changed. “When the wind blows, the trees move. When the trees move, the wind blows.” Which is it? Correlation suggests there is a link but tells us nothing about causation. To do this we need <em>regression</em>.</p>
<table class="table">
<caption>differences and similarities between correlation and regression</caption>
<colgroup>
<col style="width: 50%">
<col style="width: 49%">
</colgroup>
<thead><tr class="header">
<th>Correlation</th>
<th>Regression</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>an example of inferential statistics</td>
<td>an example of inferential statistics</td>
</tr>
<tr class="even">
<td>give direction and strength of the relationship between two (or more) numeric variables</td>
<td>give direction and strength of the relationship between two (or more) variables</td>
</tr>
<tr class="odd">
<td>Relationship between variables</td>
<td>The extent to which one variable <u>predicts</u> another</td>
</tr>
<tr class="even">
<td>Effect only (no cause)</td>
<td>Cause and effect</td>
</tr>
<tr class="odd">
<td>p(x,y) == p(y,x)</td>
<td>One way (e.g.&nbsp;education affects income differently from how income affects education)</td>
</tr>
<tr class="even">
<td>Single point/value</td>
<td>An equation that creates a best fitting line</td>
</tr>
</tbody>
</table>
<p>Regression is a way of <em>predicting</em> the value of one <em>dependent</em> variable from one or more <em>independent</em> variables by creating a hypothetical model of the relationship between them.</p>
<ul>
<li>
<strong>independent variable</strong> - the cause of the change that is independent of other variables</li>
<li>
<strong>dependent variable</strong> - the effect of the cause</li>
</ul>
<section id="linear-models-and-regression" class="level2" data-number="2.1"><h2 data-number="2.1" class="anchored" data-anchor-id="linear-models-and-regression">
<span class="header-section-number">2.1</span> Linear models and regression</h2>
<p>The model used is a <strong>linear</strong> one, therefore, we describe the relationship using the equation of a straight line. In linear regression, with one dependent and one independent variable, we use the <em>Method of Least Squares</em> to find the line of best fit. The means finding a straight line that passes as close as possible to all the points. The distance between a point and this line is called a residual. The line of best fit is the line where the sum of the residuals squared is the smallest number possible.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="images/method_of_least_squares.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Method of Least Squares</figcaption></figure>
</div>
<p>The line that is created can be described by the equation:</p>
<p><code>Output = Intercept + Coefficient * Input</code> <!--F-statistic = a measure of the ratio of the variation explained by the model and the variation attributable to unsystematic factors (the error of the model).--></p>
<p>Let’s use linear regression to explore the relationship between the score in maths(<code>PV1MATH</code>) and the score in reading (<code>PV1READ</code>). To build this model we use the <code>lm</code> command:</p>
<p><code>lm(&lt;dependent_var&gt; ~ &lt;independent_var&gt; , data=&lt;dataframe&gt;)</code></p>
<p>The first part defines the model we are going to explore, listing the dependent variable and separating it from the independent variable[s] with a tilde <code>~</code>. You can specify multiple independent variables by adding more plusses, but for the example here we are only going to use one. Once the model has been built we can feed it into the <code>summary(&lt;mdl&gt;)</code> command to output the results:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = PV1MATH ~ PV1READ, data = PISA_2018)

Residuals:
    Min      1Q  Median      3Q     Max 
-289.48  -39.35   -0.79   38.68  341.71 

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 9.617e+01  3.254e-01   295.5   &lt;2e-16 ***
PV1READ     8.003e-01  6.942e-04  1152.9   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 58.42 on 606625 degrees of freedom
  (5377 observations deleted due to missingness)
Multiple R-squared:  0.6866,    Adjusted R-squared:  0.6866 
F-statistic: 1.329e+06 on 1 and 606625 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>If you look at the <code>Coefficents:</code> table we can see that <code>PV1READ</code> is significant in explaining the outcome of the model as the p-value <code>Pr(&gt;|t|)</code> is less than 0.001 <code>&lt;2e-16 ***</code>. The null hypothesis is that one variable does not predict another, we can dismiss this. By looking at the <code>Estimate</code> we can also see by how much a <code>PV1MATH</code> grade would increase if the <code>PV1READ</code> increased by one: <code>0.8003</code>. Additionally, we have <em>R<sup>2</sup></em> value of <code>0.6866</code>, this suggests that the model is very good at explaining the value of the dependent variable, 68.7% of the variance in the <code>PV1MATH</code> grade is explained by the <code>PV1READ</code> grade.</p>
</section><section id="r-squared" class="level2" data-number="2.2"><h2 data-number="2.2" class="anchored" data-anchor-id="r-squared">
<span class="header-section-number">2.2</span> R squared</h2>
<p>With large data sets you will often find a statistically significant difference, but <em>p-values</em> should be read with caution as the larger the data set you use the more likely you are to get a low <em>p-value</em>. The actual magnitude of a significant difference might be very small. <strong>r-squared</strong> and <strong>adjusted r-squared</strong> are ways for you to report on the magnitude of a significant difference and when you report the findings from a linear model you should be looking at the <code>p</code> and the <code>R^2^</code> values. You have already met <em>R</em>, this is the correlation coefficient from earlier, <em>R<sup>2</sup></em> is this value squared:</p>
<ul>
<li>
<strong>R</strong> - The correlation between the observed values of the outcome, and the values predicted by the model.</li>
<li>
<strong>R<sup>2</sup></strong> - The proportion of variance in the dependent variable accounted for by the model.</li>
<li>
<strong>Adj. R<sup>2</sup></strong> - An estimate of R<sup>2</sup> in the population (shrinkage), often very similar to plain R<sup>2</sup>.</li>
</ul>
<!--Effect size measurements include Cohen's d, Glass' g and Pearson's r--><p>Imagine we take two experiments a) and b)</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="images/effectsize.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">a) larger effect-size; b) smaller effect-size from <span class="citation" data-cites="coe2002s">Coe (<a href="#ref-coe2002s" role="doc-biblioref">2002</a>)</span></figcaption></figure>
</div>
<p>Both have statistically significant results, but it’s clear that the impact of the intervention in graph a) is larger as there is less overlap between the curves, i.e.&nbsp;there is more difference between the the outcomes.</p>
<blockquote class="blockquote">
<p>if the difference were as in graph (a) it would be very significant; in graph (b), on the other hand, the difference might hardly be noticeable <span class="citation" data-cites="coe2002s">(<a href="#ref-coe2002s" role="doc-biblioref">Coe 2002, p2</a>)</span></p>
</blockquote>
<p>Different effect sizes have different meanings and there is some debate on how to interpret them, with different interpretations for different fields of research <span class="citation" data-cites="schafer2019meaningfulness">(<a href="#ref-schafer2019meaningfulness" role="doc-biblioref">Schäfer and Schwarz 2019</a>)</span></p>
<table class="table">
<caption>How to interpret effect sizes <span class="citation" data-cites="cohen1962statistical">(<a href="#ref-cohen1962statistical" role="doc-biblioref">Cohen 1962</a>)</span>
</caption>
<thead><tr class="header">
<th>Effect size value</th>
<th>Effect size</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>0.0 to 0.19</td>
<td>negligible</td>
</tr>
<tr class="even">
<td>0.2 to 0.49</td>
<td>small</td>
</tr>
<tr class="odd">
<td>0.5 to 0.79</td>
<td>medium</td>
</tr>
<tr class="even">
<td>0.8+</td>
<td>large</td>
</tr>
</tbody>
</table>
<p>You might be familiar with the Education Endowment Foundation’s <em>Teaching and Learning Toolkit</em> which outlines the <em>Impact</em> of different interventions on student learning. For example, repeating a year is seen to decrease student progress by 3 months and providing students with feedback is seen to increase student progress by 6 months. Behind the scenes they are using effect-sizes to predict the impact of educational interventions. In their model an effect-size of 0.1 is considered to have “Low impact”, but also an effect size of this magnitude is translated to 2 months progress in the Toolkit <span class="citation" data-cites="higgins2016sutton">(<a href="#ref-higgins2016sutton" role="doc-biblioref">Higgins et al. 2016, 5</a>)</span>.</p>
</section><section id="questions-1" class="level2" data-number="2.3"><h2 data-number="2.3" class="anchored" data-anchor-id="questions-1">
<span class="header-section-number">2.3</span> Questions</h2>
<div class="question">
<ol type="1">
<li><p>Is it reasonable to presume that using 5 interventions from the education endowment foundation toolkit, each with effect-sizes of 0.1, i.e.&nbsp;2 months improvement, will increase the progress for the average student in your class by 10 months (5 * 2)?</p></li>
<li><p>Run a regression model to look at how science grades predict Maths outcomes in UK students. How does this compare to students in France?</p></li>
</ol>
<ol start="3" type="1">
<li>Create a linear model to look at how wealth <code>WEALTH</code> influences Maths grades in the United Kingdom and Belarus. If we use the Education Endowment Foundation’s interpretation of effect sizes <span class="citation" data-cites="higgins2016sutton">(<a href="#ref-higgins2016sutton" role="doc-biblioref">Higgins et al. 2016, 5</a>)</span> what is the impact of increasing the wealth of students in each country?</li>
</ol>
</div>
</section></section><section id="multiple-linear-regression" class="level1" data-number="3"><h1 data-number="3">
<span class="header-section-number">3</span> Multiple linear regression</h1>
<p>So far we have looked at the impact of a single independent variable on a single dependent variable. We are now going to look at building models that contain multiple independent variables, of both continuous and discrete values. For example, we might want to see how Gender (<code>ST004D01T</code>) and Reading score (<code>PV1READ</code>) help predict a maths score. To add extra independent variables, use the plus symbol <code>+</code>:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = PV1MATH ~ PV1READ + gender, data = PISA_2018 %&gt;% 
    rename(gender = ST004D01T))

Residuals:
    Min      1Q  Median      3Q     Max 
-289.42  -38.14   -0.68   37.51  356.24 

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 7.405e+01  3.368e-01   219.8   &lt;2e-16 ***
PV1READ     8.180e-01  6.808e-04  1201.6   &lt;2e-16 ***
genderMale  2.798e+01  1.471e-01   190.2   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 56.75 on 606622 degrees of freedom
  (5379 observations deleted due to missingness)
Multiple R-squared:  0.7043,    Adjusted R-squared:  0.7043 
F-statistic: 7.223e+05 on 2 and 606622 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>Both independent variables are significant (<code>p&lt;0.001</code>), and the <em>R<sup>2</sup></em> of the model is high at <code>0.7043</code>, this model explains 70% of the variance in Maths grade. Looking at the Estimates, we see both independent variables presented, this means we can read them as if the other factor has been <em>controlled</em> for; e.g.&nbsp;what is the impact of reading score if the impact of gender has been taken into consideration. <code>PV1READ</code> is <code>0.818</code>, meaning for an increase of 1 in this score, the <code>PV1MATH</code> grade would increase by <code>0.818</code>. Gender is different, this is a <em>nominal</em> field, being either Male or Female, and <code>genderMale</code> is shown in the coefficients table. This means that the model has taken <code>gender == Female</code> as the base state, and modeled what happens if the gender were to change to Male. Interestingly, it suggests that when controlling for the reading grade, e.g.&nbsp;comparing females and males of the same reading score, males would do <code>27.98</code> points better in their <code>PV1MATH</code> grade than females(!). We’ll be exploring these gender differences a little further in section <a href="#sec-Stoet-Geary">Chapter&nbsp;7</a>.</p>
</section><section id="reporting-regression" class="level1" data-number="4"><h1 data-number="4">
<span class="header-section-number">4</span> Reporting regression</h1>
<p>When reporting linear regression we should make note of the <em>estimate</em> (also known as beta <em>β-value</em>) of each factor along with their <em>p-values</em>. We need to know the <em>R<sup>2</sup></em> and <em>p-value</em> for the model as well as the <em>F-statistic</em> and the <em>degrees of freedom</em>. We can then construct a few sentences to explain our findings <span class="citation" data-cites="statology2021">(<a href="#ref-statology2021" role="doc-biblioref">Zach 2021</a>)</span>:</p>
<blockquote class="blockquote">
<p>Simple linear regression was used to test if [predictor variable] significantly predicted [response variable]. The overall regression was statistically significant (R2 = [R2 value], F(df regression, df residual) = [F-value], p = [p-value]). It was found that [predictor variable] significantly predicted [response variable] (β = [β-value], p = [p-value]).</p>
</blockquote>
<p>For the example above, this would be:</p>
<blockquote class="blockquote">
<p>Simple linear regression was used to test if a student reading grade significantly predicted student maths grade. The overall regression was statistically significant (R<sup>2</sup> = 0.6866, F(1,606625) = 1329000, p = &lt;0.001). It was found that reading grade significantly predicted maths grade (β = 0.8003, p = &lt;0.001).</p>
</blockquote>
<p>Alternatively, you could make use of the <code>easystats</code> package which will do most of the heavy lifting for you:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = PV1MATH ~ PV1READ, data = PISA_2018)

Residuals:
    Min      1Q  Median      3Q     Max 
-289.48  -39.35   -0.79   38.68  341.71 

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 9.617e+01  3.254e-01   295.5   &lt;2e-16 ***
PV1READ     8.003e-01  6.942e-04  1152.9   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 58.42 on 606625 degrees of freedom
  (5377 observations deleted due to missingness)
Multiple R-squared:  0.6866,    Adjusted R-squared:  0.6866 
F-statistic: 1.329e+06 on 1 and 606625 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>We fitted a linear model (estimated using OLS) to predict PV1MATH with PV1READ
(formula: PV1MATH ~ PV1READ). The model explains a statistically significant
and substantial proportion of variance (R2 = 0.69, F(1, 606625) = 1.33e+06, p &lt;
.001, adj. R2 = 0.69). The model's intercept, corresponding to PV1READ = 0, is
at 96.17 (95% CI [95.53, 96.80], t(606625) = 295.53, p &lt; .001). Within this
model:

  - The effect of PV1READ is statistically significant and positive (beta = 0.80,
95% CI [0.80, 0.80], t(606625) = 1152.88, p &lt; .001; Std. beta = 0.83, 95% CI
[0.83, 0.83])

Standardized parameters were obtained by fitting the model on a standardized
version of the dataset. 95% Confidence Intervals (CIs) and p-values were
computed using a Wald t-distribution approximation.</code></pre>
</div>
</div>
</section><section id="questions-2" class="level1" data-number="5"><h1 data-number="5">
<span class="header-section-number">5</span> Questions</h1>
<div class="question">
<ol type="1">
<li>What errors can you see in this code:</li>
</ol>
<ol start="2" type="1">
<li>PV1MATH given PV1READ and PV1SCIE</li>
</ol>
<ol start="3" type="1">
<li>
</li></ol>
</div>
</section><section id="sec-z-values" class="level1" data-number="6"><h1 data-number="6">
<span class="header-section-number">6</span> Standardising results with z-values</h1>
<p>When we are trying to compare data between countries, our results can be heavily skewed by the overall performance of a country. For example, imagine we have country <em>A</em> and country <em>U</em>. Students in country <em>A</em> generally get high grades with a very high standard deviation, whilst students in country <em>U</em> generally get very low grades with a very low standard deviation.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 6
  country M_max F_max difference    sd  mean
  &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt;      &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 A          95    89          6  6.90    92
2 U           9    11         -2  1.41    10</code></pre>
</div>
</div>
<p>If we look for the difference in grades between females and males in country <em>A</em> we might see a massive difference, whilst female and male students in country <em>U</em> have a much smaller difference. We might then conclude that country <em>U</em> is more equitable. But in reality, because the standard deviation in country <em>U</em> is so small, the relative difference between females and males is actually larger than that seen in country <em>A</em>! To get around this problem, when dealing with situations like this, we can use <em>standardised</em>, or <em>z</em>, values. These z-values would be a student’s grade in relation to the standard deviation of all of that country’s grades.</p>
<p>To calculate the standardised <em>z-value</em> for each entry, we use:</p>
<p><code>(entry - mean of grouping) / sd of grouping</code></p>
<p>For example, for the first Male student in country A who scored 100 points, we would calculate</p>
<p><code>(100 - 92) / 6.899 = 1.16</code></p>
<p>This shows that this student got 1.16 standard deviations more than the mean of the population. For the first female in country U, we would calculate:</p>
<p><code>(12 - 10) / 1.141 = 1.75</code></p>
<p>These two values are then directly comparable, the first males in country A is relatively closer to the mean grade of country A, than the first female in country U. How does this work out for the whole country? Going back to whether sex had a greater impact on results in country A or country U we can calculate the z-values for each student by using the <code><a href="https://rdrr.io/r/base/scale.html">scale()</a></code> command:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 4
# Groups:   country [2]
   sex   country grade zgrade[,1]
   &lt;chr&gt; &lt;chr&gt;   &lt;dbl&gt;      &lt;dbl&gt;
 1 M     A         100      1.16 
 2 M     A          87     -0.725
 3 M     A          98      0.870
 4 F     A          95      0.435
 5 F     A          82     -1.45 
 6 F     A          90     -0.290
 7 M     U          10      0    
 8 M     U           8     -1.41 
 9 M     U           9     -0.707
10 F     U          12      1.41 
11 F     U          10      0    
12 F     U          11      0.707</code></pre>
</div>
</div>
<p>We can then group by country and by sex and see how the <code>mean</code> z-value varies</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 3
# Groups:   country [2]
  country sex   mean_zgrade
  &lt;chr&gt;   &lt;chr&gt;       &lt;dbl&gt;
1 A       F          -0.435
2 A       M           0.435
3 U       F           0.707
4 U       M          -0.707</code></pre>
</div>
</div>
<p>We can clearly see that the grades in country <em>A</em> are relatively closer to the mean of country <em>A</em>, than the grades in country <em>U</em>, meaning that there is less variation in country <em>A</em>.</p>
</section><section id="sec-Stoet-Geary" class="level1" data-number="7"><h1 data-number="7">
<span class="header-section-number">7</span> Recreating Stoet and Geary’s paper</h1>
<p>Stoet and Geary’s 2018 paper: <em>“The Gender-Equality Paradox in Science, Technology, Engineering, and Mathematics Education”</em> presented controversial findings, including how the increased female uptake of STEM degrees in country could be partially explained (using regression) by the decreased gender equality in that country. We are going to explore part of this paper by looking at another finding (figure 3a) that looked at girls’ achievement in the <code>PISA_2015</code> science test compared to their maths and reading grades. Comparing this relative grade to boys in the same country, it showed that as gender equality of their country increased, the gap got bigger, i.e.&nbsp;the more gender equal a country, the worse the female relative performance in science.</p>
<blockquote class="blockquote">
<p>The gender gap in intraindividual science scores (a) was larger in more gender-equal countries (<em>r<sub>s</sub></em> = .42)</p>
</blockquote>
<!-- fields used by stoet geary and 2012 equivalents

MATHEFF 2012 MATINTFC 2012 SCIEEFF 2015-->
<section id="loading-data-sets" class="level2" data-number="7.1"><h2 data-number="7.1" class="anchored" data-anchor-id="loading-data-sets">
<span class="header-section-number">7.1</span> Loading data sets</h2>
<p>To perform more complex analysis you will often want to join different data sets together. <span class="citation" data-cites="stoet2018gender">Stoet and Geary (<a href="#ref-stoet2018gender" role="doc-biblioref">2018</a>)</span> explore gender differences in outcomes with gender equality in countries (see their figures 3 and 4), by using the <code>PISA_2015</code> data set with the science efficacy <code>SCIEEFF</code>, and science performance (maybe <code>PV1SCIE</code>, or a aggregation of <code>PV1</code>, <code>PV2</code> etc ) fields; mapping this data set to the 2015 Global Gender Gap Index (GGGI). Let’s try and recreate what they did.</p>
<p>First we are going to download the GGGI, unfortunately, it’s difficult to find the 2015 data set, so we’ll use 2013 instead, which can be found <a href="https://data.humdata.org/dataset/29f2f52f-a9c2-4ff9-a99e-42b894dc18e9/resource/a8fe8c72-1359-4ce3-b8cc-03d9e5e85875/download/table-3b-detailed-rankings-2013.csv">here</a></p>
<p>The data is in a <code>.csv</code> format so we need to use <code>read.csv</code> to get it into R (make sure that you use <code>read.csv</code> rather than <code>read_csv</code> as the names will come out slightly differently)</p>
<p>If we look at the names of the GGGI fields we find that there is a <code>Country</code> column and the <code>Overall.Score</code> column, these are the columns that we are interested in. We can also see that many of the top scoring countries, i.e.&nbsp;those with better gender equality are Nordic countries.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>      Country Overall.Score
1     Iceland        0.8731
2     Finland        0.8421
3      Norway        0.8417
4      Sweden        0.8129
5 Philippines        0.7832</code></pre>
</div>
</div>
<p>Now we will load the 2015 PISA data set, we have a <code>.parquet</code> copy for you <a href="https://drive.google.com/file/d/18NpQO1DGY5dnjnlR2b3IF9Zv8xtpc1Fk/view?usp=share_link">here</a></p>
</section><section id="sec-leftjoin" class="level2" data-number="7.2"><h2 data-number="7.2" class="anchored" data-anchor-id="sec-leftjoin">
<span class="header-section-number">7.2</span> Linking data using <code>left_join</code>
</h2>
<p>To link the <code>GGGI</code> to the <code>PISA_2015</code> data set we will use the <code>left_join</code> function from the tidyverse. This takes a few parameters</p>
<pre><code>left_join(&lt;table_1&gt;, &lt;table_2&gt;, by=&lt;matching_field[s]&gt;)</code></pre>
<p>We will now join a subset of the <code>PISA_2015</code> data set to a subset of the <code>GGGI</code> scores:</p>
<ul>
<li>line 1, assigns <code>&lt;-</code> the result of the <code>left_join</code> to a new object, <code>PISA_2015_GGGI</code>,</li>
<li>line 2, specifies <code>&lt;table_1&gt;</code> to be <code>PISA_2015</code> with the selected fields, note we have chosen to use <code>PV1</code> grades here, it’s unclear what the original paper uses (See <strong>?@sec-PV</strong> for a discussion on the use of <code>PV</code> grades)</li>
<li>line 3, specifies <code>&lt;table_2&gt;</code> to be <code>GGGI</code> with just the country and <code>Overall.Score</code> fields</li>
<li>line 4, specifies the <code>&lt;matching_field&gt;</code> to be <code>CNT</code>from <code>PISA_2015</code> and <code>Country</code> from <code>GGGI</code>, this means that the data in <code>&lt;table_2&gt;</code> will be added to <code>&lt;table_1&gt;</code> where <code>CNT</code> and <code>Country</code> are the same. For example for every entry of <code>Finland</code> in <code>PISA_2015</code>, the <code>Overall.Score</code> of <code>0.8421</code> will be added. Where it can’t find a matching country, e.g.&nbsp;Albania doesn’t have a GGGI entry, <code>NA</code> will be added.</li>
</ul>
<p>You can see the new data set has attached the <code>Overall.Score</code> field from <code>GGGI</code> to the selected fields from <code>PISA_2015</code>:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 7
  CNT     ST004D01T PV1MATH PV1SCIE PV1READ SCIEEFF Overall.Score
  &lt;chr&gt;   &lt;fct&gt;       &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;         &lt;dbl&gt;
1 Albania Female       463.    517.    430.      NA         0.641
2 Albania Female       430.    480.    463.      NA         0.641
3 Albania Female       303.    447.    503.      NA         0.641</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>There are multiple types of join in the tidyverse, you can find out more about them <a href="https://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf">here</a></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="..\images/joins.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">The available joins in the tidyverse, CC 4.0, by rstudio.com</figcaption></figure>
</div>
</div>
</div>
</section><section id="sec-standard-stoet-geary" class="level2" data-number="7.3"><h2 data-number="7.3" class="anchored" data-anchor-id="sec-standard-stoet-geary">
<span class="header-section-number">7.3</span> Standardising PISA results</h2>
<p>Next, we will try to wrangle the data into shape to recreate figure 3 from <span class="citation" data-cites="stoet2018gender">Stoet and Geary (<a href="#ref-stoet2018gender" role="doc-biblioref">2018</a>)</span>. To do this we first need to standardise the grades for maths, science and reading so we can compare the results of students between countries without low performing or high performing countries skewing the results (see <a href="#sec-z-values">Chapter&nbsp;6</a> for details on how to standardise data). Following the steps outlined on page 7:</p>
<blockquote class="blockquote">
<ol type="1">
<li>We standardized the mathematics, science, and reading scores on a nation-by-nation basis. We call these new standardized scores <em>zMath</em>, <em>zRead</em>, and <em>zScience</em>.</li>
<li>We calculated for each student the standardized average score of the new z-scores and we call this <em>zGeneral</em>.</li>
<li>Then, we calculated for each student their intra-individual strengths by subtracting <em>zGeneral</em> as follows: <em>relativeSciencestrength = zScience - zGeneral</em>, <em>relativeMathstrength = zMath - zGeneral</em>, <em>relativeReadingstrength = zReading - zGeneral</em>.</li>
<li>Finally, using these new intra-individual (relative) scores, we calculated for each country the averages for boys and girls and subtracted those to calculate the gender gaps in relative academic strengths</li>
</ol>
</blockquote>
<p>produces the following code:</p>
<p>Finally we will plot the results:</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="10-teachers_relationships_and_STEM_achievement_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The graph is pretty good recreation of what the paper presented, with the general shape the same; differences in grades for each country might be explained by the original paper using 5 plausible values rather than just <code>PV1SCIE</code>, as we have used <span class="citation" data-cites="stoet2020gender">(<a href="#ref-stoet2020gender" role="doc-biblioref">Stoet and Geary 2020</a>)</span>. Does the statistical model stand up to scrutiny? To find out we will use <em>correlation</em>. Stoet and Geary used <em>Spearman’s rho</em>, signified by the <sub><em>s</em></sub> in <em>r<sub>s</sub></em>:</p>
<blockquote class="blockquote">
<p>The most important and novel finding here is that the sex difference in intraindividual strength in science was higher and more favorable to boys in more gender-equal countries, <em>r<sub>s</sub></em> = .42, 95% CI = [.19,.61], <em>p</em> &lt; .001, <em>n</em> = 62 (Fig. 3a)</p>
</blockquote>
<p>We can run our version of this model using the following:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
    Spearman's rank correlation rho

data:  pisa_gggi_diff$gggi and pisa_gggi_diff$difference
S = 24384, p-value = 0.02763
alternative hypothesis: true rho is not equal to 0
sample estimates:
      rho 
0.2874342 </code></pre>
</div>
</div>
<p>Our model doesn’t show such a strong correlation. In fact, our model shows a “weak positive” relationship of just <code>0.287</code>, albeit a significant one (<code>p&lt;0.05</code>).</p>
<p>For our version of this model it seems unnecessary to use Spearman’s rho, the number of countries we are comparing with valid data is 59 (<code>pisa_gggi_diff %&gt;% na.omit() %&gt;% nrow()</code>), which is greater than 30 and using the <em>central limit theorem</em> we should be able to use <em>Pearson’s r</em>. Additionally,<code>shapiro.test</code>on both difference and<code>gggi</code> give non-significant results, suggesting Pearson is the better test to use here:</p>
<p>If we run the model again using Pearson’s r, we get:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
    Pearson's product-moment correlation

data:  pisa_gggi_diff$gggi and pisa_gggi_diff$difference
t = 3.9972, df = 57, p-value = 0.0001863
alternative hypothesis: true correlation is not equal to 0
95 percent confidence interval:
 0.2406661 0.6465242
sample estimates:
      cor 
0.4679109 </code></pre>
</div>
</div>
<p>A result much closer to the one published. The differences here might be the result of the different GGGI data set we used or a difference in the way we calculated <code>difference</code>, or something to do with the correlation model used. It would be good to know!</p>
<p>We can also explore this data using regression and a linear model looking at the relationship between <code>difference</code> in grades and the <code>gggi</code> value for each country:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = difference ~ gggi, data = pisa_gggi_diff)

Residuals:
      Min        1Q    Median        3Q       Max 
-0.067343 -0.018964 -0.003605  0.023548  0.083991 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) -0.12926    0.05317  -2.431 0.018228 *  
gggi         0.29826    0.07462   3.997 0.000186 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.03247 on 57 degrees of freedom
  (14 observations deleted due to missingness)
Multiple R-squared:  0.2189,    Adjusted R-squared:  0.2052 
F-statistic: 15.98 on 1 and 57 DF,  p-value: 0.0001863</code></pre>
</div>
</div>
<p>This model also finds a significant difference (<code>p&lt;0.001</code>) and an estimate for gggi of <code>0.298</code>, i.e.&nbsp;for each increase of 1 in gggi, males will do <code>0.298</code> of a standard deviation better than females. The R<sup>2</sup> is pretty decent too at <code>0.219</code> suggesting the finding that Stoet and Geary reported is a sound one.</p>
<!--
### Science self efficacy

We can also try and recreate fig. 4 from @stoet2018gender, looking at how self-efficacy in science `SCIEEFF` varies given the GGGI `Overall.Score`:


::: {.cell}
::: {.cell-output-display}
![](10-teachers_relationships_and_STEM_achievement_files/figure-html/unnamed-chunk-42-1.png){width=672}
:::
:::

::: {.cell}
::: {.cell-output .cell-output-stdout}
```

Call:
lm(formula = sci_eff_mean ~ gggi + gender, data = pisa_gggi_scislfeff)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.65859 -0.12151 -0.00445  0.14761  0.63470 

Coefficients:
            Estimate Std. Error t value Pr(>|t|)   
(Intercept)  0.25947    0.26408   0.983  0.32792   
gggi        -0.36891    0.36882  -1.000  0.31933   
genderMale   0.13872    0.04161   3.334  0.00116 **
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.2241 on 113 degrees of freedom
  (30 observations deleted due to missingness)
Multiple R-squared:  0.09685,   Adjusted R-squared:  0.08086 
F-statistic: 6.059 on 2 and 113 DF,  p-value: 0.003166
```
:::
:::


> We used the UNESCO graduation data (available via http://data.uis.unesco.org) labelled "Distribution of tertiary graduates"

::: question
1.  


::: {.cell}

:::


2.  


::: {.cell}

:::


3.  calculate a new field, then conduct a


::: {.cell}

:::

:::

## Logistic regression

Sometimes the dependent variable will be *boolean*, that is a field that can only have two values, e.g. `True/False`, `Yes/No`, `High/Low`, etc. Unfortunately we can't use the linear model to do th


::: {.cell}

:::

::: {.cell}

:::


-->
</section></section><section id="seminar-tasks" class="level1" data-number="8"><h1 data-number="8">
<span class="header-section-number">8</span> Seminar Tasks</h1>
<div class="question">
<p>Group discussion:</p>
<ul>
<li>What were the most important findings from Stoet and Geary’s paper?</li>
<li>How trustworthy are the results?</li>
<li>What do these results mean for gender equality in STEM?</li>
</ul>
<ol type="1">
<li>What are <em>Spearman’s Rho</em> and <em>Pearson’s r</em>? When might you use one rather than the other?</li>
</ol>
<ol start="2" type="1">
<li>Identify dependent and independent variables in the following scenarios and select the most appropriate statistical test (from all that you have learnt) for the analysis.</li>
</ol>
<ul>
<li>The government is trying to understand which groups of people have been affected by a pandemic. They have data on healthcare professionals, education professionals and train drivers and the number of days taken off ill in the last 6 months.</li>
<li>A cigarette company, working in a country that still allows cigarette advertising(!), wants to work out which groups in society are not currently smoking that many cigarettes. They want to find out if city dwellers are more likely to smoke than people living in the countryside.</li>
<li>A netball team is trying to work out how likely their players are to get injured in a season. They have data on the number of injuries per player and the number of minutes each player has been playing netball.</li>
<li>A country is trying to find out whether girls or boys are better behaved in schools. They have access to school databases that record the number of bad behaviour slips for each student.</li>
</ul>
<ol start="3" type="1">
<li>Interpret this correlation coefficient between the Index of economic, social and cultural status <code>ESCS</code> and Family wealth <code>WEALTH</code>
</li>
</ol>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
    Pearson's product-moment correlation

data:  PISA_2018$ESCS and PISA_2018$WEALTH
t = 751.83, df = 595193, p-value &lt; 2.2e-16
alternative hypothesis: true correlation is not equal to 0
95 percent confidence interval:
 0.6966207 0.6992267
sample estimates:
     cor 
0.697926 </code></pre>
</div>
</div>
<ol start="4" type="1">
<li>Interpret this linear model based on the FBI’s 2006 crime statistics. It explores the relationship between size of population (1,000s) and the number of murders (units)<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>:</li>
</ol>
<table class="table">
<thead><tr class="header">
<th></th>
<th>Estimate</th>
<th>Std. Error</th>
<th>t value</th>
<th>Pr(&gt;|t|)</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>(Intercept)</td>
<td>-0.726</td>
<td>0.089</td>
<td>-8.191</td>
<td>&lt;2e-16 ***</td>
</tr>
<tr class="even">
<td>Pop_thou</td>
<td>0.103</td>
<td>0.001</td>
<td>145.932</td>
<td>&lt;2e-16 ***</td>
</tr>
</tbody>
</table>
<p><em>Adj R<sup>2</sup></em> 0.721</p>
<ol start="5" type="1">
<li>Work out the correlation between a country’s mean female science grade and mean male science grade. Should you use <em>Spearman’s Rho</em> or <em>Pearson’s r</em> in your model? Why?</li>
</ol>
<ol start="6" type="1">
<li>Create a linear model to explore the relationship between the time spent in science lessons (<code>SMINS</code>) and the grade in science (<code>PV1SCIE</code>)</li>
</ol>
<p>Add the student maths score <code>PV1MATH</code> this model, how does this change the outcome?</p>
<ol start="7" type="1">
<li>Load the school level data set for 2018 (file <a href="https://drive.google.com/file/d/1ZJkiIGkVfBdRupTVxbaRQ1fwOZr_RV8O/view?usp=share_link">here</a>) and explore the fields.</li>
</ol>
<p>Using a linear model, how do “Shortage of educational staff” <code>STAFFSHORT</code> and “Shortage of educational material” <code>EDUSHORT</code> relate to “Student behaviour hindering learning” <code>STUBEHA</code></p>
<p>Adjust the model to incorporate the percentage of boys in a school (see <code>SC002Q01TA</code> and <code>SCHSIZE</code>), what difference does this make?</p>
<p>How does the explanatory value of this model change if you only look at schools in the UK?</p>
<ol start="8" type="1">
<li>Using <code>left_join</code> (see <a href="#sec-leftjoin">Section&nbsp;7.2</a>), link each student record in <code>PISA_2018</code> to their school details (file <a href="https://drive.google.com/file/d/1ZJkiIGkVfBdRupTVxbaRQ1fwOZr_RV8O/view?usp=share_link">here</a>). You will need need to <code>select</code> a subset of the school table to cover: <code>CNT, CNTSCHID, SC016Q02TA, SC156Q03HA, SC156Q04HA, SC154Q01HA,</code> <code>SC154Q02WA, SC154Q05WA, SC154Q08WA, SC154Q09HA, STRATIO, CLSIZE,</code> <code>EDUSHORT, STAFFSHORT, STUBEHA</code>
</li>
</ol>
<p>Using a linear model, find out how well the student teacher ratio <code>STRATIO</code> in a school predicts the <code>mean</code> maths achievement <code>PV1MATH</code> in that school. <strong>HINT</strong>: you need one row for each school, so use summarise with unique on <code>STRATIO</code> and mean on <code>PV1MATH</code>:</p>
<p>Adjust the linear model used above to incorporate <code>STUBEHA</code> “Student behaviour hindering learning” in addition to the student teacher ratio:</p>
<ol start="9" type="1">
<li>Explore the schools data set to look at other interesting models. The school data set has a lot more numeric/continuous fields than the student table! To find these fields use this code:</li>
</ol>
<ol start="10" type="1">
<li><p>In pairs discuss how you could use correlation and regression in your own research. Start building some models to explore the data sets.</p></li>
<li><p>Recreate the Stoet &amp; Geary analysis (see <a href="#sec-standard-stoet-geary">Section&nbsp;7.3</a>) to see if there is a “gender gap in intraindividual <strong>mathematics</strong> scores” that is “larger in more gender-equal countries”. You might expect this to be the case as it exists for science. Is this a STEM wide finding? How does the science model look for 2018 data? Was it a one off finding?</p></li>
</ol>
</div>



</section><div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" role="list">
<div id="ref-coe2002s" class="csl-entry" role="listitem">
Coe, Robert. 2002. <span>“It’s the Effect Size, Stupid.”</span> In <em>British Educational Research Association Annual Conference</em>, 12:14.
</div>
<div id="ref-cohen1962statistical" class="csl-entry" role="listitem">
Cohen, Jacob. 1962. <span>“The Statistical Power of Abnormal-Social Psychological Research: A Review.”</span> <em>The Journal of Abnormal and Social Psychology</em> 65 (3): 145.
</div>
<div id="ref-higgins2016sutton" class="csl-entry" role="listitem">
Higgins, Steve, Maria Katsipataki, AB Villanueva-Aguilera, Robbie Coleman, P Henderson, LE Major, R Coe, and Danielle Mason. 2016. <span>“The Sutton Trust-Education Endowment Foundation Teaching and Learning Toolkit.”</span> <a href="https://dro.dur.ac.uk/20987/1/20987.pdf">https://dro.dur.ac.uk/20987/1/20987.pdf</a>.
</div>
<div id="ref-schafer2019meaningfulness" class="csl-entry" role="listitem">
Schäfer, Thomas, and Marcus A Schwarz. 2019. <span>“The Meaningfulness of Effect Sizes in Psychological Research: Differences Between Sub-Disciplines and the Impact of Potential Biases.”</span> <em>Frontiers in Psychology</em> 10: 813. <a href="https://www.frontiersin.org/articles/10.3389/fpsyg.2019.00813/full">https://www.frontiersin.org/articles/10.3389/fpsyg.2019.00813/full</a>.
</div>
<div id="ref-stoet2018gender" class="csl-entry" role="listitem">
Stoet, Gijsbert, and David C Geary. 2018. <span>“The Gender-Equality Paradox in Science, Technology, Engineering, and Mathematics Education.”</span> <em>Psychological Science</em> 29 (4): 581–93. <a href="https://eprints.leedsbeckett.ac.uk/id/eprint/4753/6/symplectic-version.pdf">https://eprints.leedsbeckett.ac.uk/id/eprint/4753/6/symplectic-version.pdf</a>.
</div>
<div id="ref-stoet2020gender" class="csl-entry" role="listitem">
———. 2020. <span>“Corrigendum: The Gender-Equality Paradox in Science, Technology, Engineering, and Mathematics Education.”</span> <a href="https://journals.sagepub.com/doi/10.1177/0956797619892892">https://journals.sagepub.com/doi/10.1177/0956797619892892</a>.
</div>
<div id="ref-statology2021" class="csl-entry" role="listitem">
Zach. 2021. <span>“The Complete Guide: How to Report Regression Results.”</span> <a href="https://www.statology.org/how-to-report-regression-results/">https://www.statology.org/how-to-report-regression-results/</a>.
</div>
</div></section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>
<ol>
<li id="fn1"><p>https://www.statisticssolutions.com/the-linear-regression-analysis-in-spss/:<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol></section></div></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>