<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-0.9.377">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>MASTEMR - Quantitative methods in the context of STEM education research</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>
<script src="site_libs/quarto-nav/quarto-nav.js"></script><script src="site_libs/quarto-nav/headroom.min.js"></script><script src="site_libs/clipboard/clipboard.min.js"></script><meta name="quarto:offset" content="./">
<script src="site_libs/quarto-search/autocomplete.umd.js"></script><script src="site_libs/quarto-search/fuse.min.js"></script><script src="site_libs/quarto-search/quarto-search.js"></script><script src="site_libs/quarto-html/quarto.js"></script><script src="site_libs/quarto-html/popper.min.js"></script><script src="site_libs/quarto-html/tippy.umd.min.js"></script><script src="site_libs/quarto-html/anchor.min.js"></script><link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link id="quarto-text-highlighting-styles" href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet">
<script src="site_libs/bootstrap/bootstrap.min.js"></script><link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><link rel="stylesheet" href="styles.css">
<link rel="stylesheet" href="css/CRESTEMR.css">
</head>
<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg navbar-dark "><div class="navbar-container container-fluid">
      <a class="navbar-brand" href="./index.html">
    <img src="./images/KCL_logo.png" alt=""><span class="navbar-title">MASTEMR</span>
  </a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
<li class="nav-item">
    <a class="nav-link active" href="./index.html" aria-current="page">Home</a>
  </li>  
</ul>
<div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc"><h2 id="toc-title">On this page</h2>
   
  <ul>
<li>
<a href="#introduction-to-quantitative-methods" id="toc-introduction-to-quantitative-methods" class="nav-link active" data-scroll-target="#introduction-to-quantitative-methods"> <span class="header-section-number">1</span> Introduction to quantitative methods</a>
  <ul class="collapse">
<li>
<a href="#seminar-tasks" id="toc-seminar-tasks" class="nav-link" data-scroll-target="#seminar-tasks"> <span class="header-section-number">1.1</span> Seminar Tasks</a>
  <ul class="collapse">
<li><a href="#task-1" id="toc-task-1" class="nav-link" data-scroll-target="#task-1"> <span class="header-section-number">1.1.1</span> Task 1</a></li>
  <li><a href="#task-2" id="toc-task-2" class="nav-link" data-scroll-target="#task-2"> <span class="header-section-number">1.1.2</span> Task 2</a></li>
  <li><a href="#tool" id="toc-tool" class="nav-link" data-scroll-target="#tool"> <span class="header-section-number">1.1.3</span> Tool</a></li>
  <li><a href="#findings" id="toc-findings" class="nav-link" data-scroll-target="#findings"> <span class="header-section-number">1.1.4</span> Findings</a></li>
  <li><a href="#to-discuss" id="toc-to-discuss" class="nav-link" data-scroll-target="#to-discuss"> <span class="header-section-number">1.1.5</span> To discuss</a></li>
  </ul>
</li>
  <li>
<a href="#activity-3-a-false-dualism" id="toc-activity-3-a-false-dualism" class="nav-link" data-scroll-target="#activity-3-a-false-dualism"> <span class="header-section-number">1.2</span> Activity 3: A false dualism?</a>
  <ul class="collapse">
<li><a href="#discussion-questions" id="toc-discussion-questions" class="nav-link" data-scroll-target="#discussion-questions"> <span class="header-section-number">1.2.1</span> Discussion Questions</a></li>
  </ul>
</li>
  </ul>
</li>
  <li>
<a href="#introduction-to-r" id="toc-introduction-to-r" class="nav-link" data-scroll-target="#introduction-to-r"> <span class="header-section-number">2</span> Introduction to R</a>
  <ul class="collapse">
<li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction"> <span class="header-section-number">2.1</span> Introduction</a></li>
  <li>
<a href="#getting-set-up" id="toc-getting-set-up" class="nav-link" data-scroll-target="#getting-set-up"> <span class="header-section-number">2.2</span> Getting set up</a>
  <ul class="collapse">
<li><a href="#installation-on-your-own-machine" id="toc-installation-on-your-own-machine" class="nav-link" data-scroll-target="#installation-on-your-own-machine"> <span class="header-section-number">2.2.1</span> Installation (on your own machine)</a></li>
  <li><a href="#installation-kcl-restricted-machine" id="toc-installation-kcl-restricted-machine" class="nav-link" data-scroll-target="#installation-kcl-restricted-machine"> <span class="header-section-number">2.2.2</span> Installation (KCL restricted machine)</a></li>
  <li><a href="#sec-packages" id="toc-sec-packages" class="nav-link" data-scroll-target="#sec-packages"> <span class="header-section-number">2.2.3</span> Setting up RStudio and the tidyverse</a></li>
  </ul>
</li>
  <li><a href="#starting-to-code" id="toc-starting-to-code" class="nav-link" data-scroll-target="#starting-to-code"> <span class="header-section-number">2.3</span> Starting to code</a></li>
  <li>
<a href="#your-first-program" id="toc-your-first-program" class="nav-link" data-scroll-target="#your-first-program"> <span class="header-section-number">2.4</span> Your first program</a>
  <ul class="collapse">
<li><a href="#objects-and-instructions" id="toc-objects-and-instructions" class="nav-link" data-scroll-target="#objects-and-instructions"> <span class="header-section-number">2.4.1</span> Objects and instructions</a></li>
  <li><a href="#naming-objects" id="toc-naming-objects" class="nav-link" data-scroll-target="#naming-objects"> <span class="header-section-number">2.4.2</span> Naming objects</a></li>
  <li><a href="#comments" id="toc-comments" class="nav-link" data-scroll-target="#comments"> <span class="header-section-number">2.4.3</span> Comments</a></li>
  </ul>
</li>
  <li>
<a href="#sec-datatypes" id="toc-sec-datatypes" class="nav-link" data-scroll-target="#sec-datatypes"> <span class="header-section-number">2.5</span> Datatypes</a>
  <ul class="collapse">
<li><a href="#sec-vectors" id="toc-sec-vectors" class="nav-link" data-scroll-target="#sec-vectors"> <span class="header-section-number">2.5.1</span> Vectors</a></li>
  <li><a href="#questions-3" id="toc-questions-3" class="nav-link" data-scroll-target="#questions-3"> <span class="header-section-number">2.5.2</span> Questions</a></li>
  <li><a href="#summary-questions" id="toc-summary-questions" class="nav-link" data-scroll-target="#summary-questions"> <span class="header-section-number">2.5.3</span> Summary questions</a></li>
  </ul>
</li>
  <li>
<a href="#packages-and-libraries" id="toc-packages-and-libraries" class="nav-link" data-scroll-target="#packages-and-libraries"> <span class="header-section-number">2.6</span> Packages and libraries</a>
  <ul class="collapse">
<li><a href="#sec-load-run-pckges" id="toc-sec-load-run-pckges" class="nav-link" data-scroll-target="#sec-load-run-pckges"> <span class="header-section-number">2.6.1</span> Installing and loading packages</a></li>
  </ul>
</li>
  <li><a href="#the-tidyverse" id="toc-the-tidyverse" class="nav-link" data-scroll-target="#the-tidyverse"> <span class="header-section-number">2.7</span> The tidyverse</a></li>
  <li>
<a href="#loading-data" id="toc-loading-data" class="nav-link" data-scroll-target="#loading-data"> <span class="header-section-number">2.8</span> Loading data</a>
  <ul class="collapse">
<li><a href="#dataframes" id="toc-dataframes" class="nav-link" data-scroll-target="#dataframes"> <span class="header-section-number">2.8.1</span> Dataframes</a></li>
  <li><a href="#loading-data-from-the-web" id="toc-loading-data-from-the-web" class="nav-link" data-scroll-target="#loading-data-from-the-web"> <span class="header-section-number">2.8.2</span> Loading data from the web</a></li>
  <li><a href="#loading-data-from-your-computer" id="toc-loading-data-from-your-computer" class="nav-link" data-scroll-target="#loading-data-from-your-computer"> <span class="header-section-number">2.8.3</span> Loading data from your computer</a></li>
  <li><a href="#setting-working-directories" id="toc-setting-working-directories" class="nav-link" data-scroll-target="#setting-working-directories"> <span class="header-section-number">2.8.4</span> Setting working directories</a></li>
  <li><a href="#proper-addresses" id="toc-proper-addresses" class="nav-link" data-scroll-target="#proper-addresses"> <span class="header-section-number">2.8.5</span> Proper addresses</a></li>
  <li><a href="#dealing-with-.rds-files" id="toc-dealing-with-.rds-files" class="nav-link" data-scroll-target="#dealing-with-.rds-files"> <span class="header-section-number">2.8.6</span> Dealing with .rds files</a></li>
  <li><a href="#exploring-data" id="toc-exploring-data" class="nav-link" data-scroll-target="#exploring-data"> <span class="header-section-number">2.8.7</span> Exploring data</a></li>
  </ul>
</li>
  <li><a href="#sec-factors" id="toc-sec-factors" class="nav-link" data-scroll-target="#sec-factors"> <span class="header-section-number">2.9</span> Factors and statistical data types</a></li>
  <li>
<a href="#piping" id="toc-piping" class="nav-link" data-scroll-target="#piping"> <span class="header-section-number">2.10</span> Piping</a>
  <ul class="collapse">
<li><a href="#select" id="toc-select" class="nav-link" data-scroll-target="#select"> <span class="header-section-number">2.10.1</span> select</a></li>
  <li><a href="#filter" id="toc-filter" class="nav-link" data-scroll-target="#filter"> <span class="header-section-number">2.10.2</span> filter</a></li>
  <li><a href="#group_by-and-summarise" id="toc-group_by-and-summarise" class="nav-link" data-scroll-target="#group_by-and-summarise"> <span class="header-section-number">2.10.3</span> group_by and summarise</a></li>
  <li><a href="#mutate" id="toc-mutate" class="nav-link" data-scroll-target="#mutate"> <span class="header-section-number">2.10.4</span> mutate</a></li>
  <li><a href="#arrange" id="toc-arrange" class="nav-link" data-scroll-target="#arrange"> <span class="header-section-number">2.10.5</span> arrange</a></li>
  <li><a href="#unique-distinct" id="toc-unique-distinct" class="nav-link" data-scroll-target="#unique-distinct"> <span class="header-section-number">2.10.6</span> unique / distinct</a></li>
  <li><a href="#tasks" id="toc-tasks" class="nav-link" data-scroll-target="#tasks"> <span class="header-section-number">2.10.7</span> tasks</a></li>
  </ul>
</li>
  </ul>
</li>
  <li>
<a href="#performance-of-different-groups-in-stem-education-sampling-and-comparisons" id="toc-performance-of-different-groups-in-stem-education-sampling-and-comparisons" class="nav-link" data-scroll-target="#performance-of-different-groups-in-stem-education-sampling-and-comparisons"> <span class="header-section-number">3</span> Performance of different groups in STEM education: Sampling and comparisons</a>
  <ul class="collapse">
<li><a href="#sec-graphing" id="toc-sec-graphing" class="nav-link" data-scroll-target="#sec-graphing"> <span class="header-section-number">3.1</span> Introduction to graphing in R</a></li>
  <li>
<a href="#geoms" id="toc-geoms" class="nav-link" data-scroll-target="#geoms"> <span class="header-section-number">3.2</span> Geoms</a>
  <ul class="collapse">
<li><a href="#geom_point" id="toc-geom_point" class="nav-link" data-scroll-target="#geom_point"> <span class="header-section-number">3.2.1</span> geom_point</a></li>
  <li><a href="#questions-4" id="toc-questions-4" class="nav-link" data-scroll-target="#questions-4"> <span class="header-section-number">3.2.2</span> Questions</a></li>
  <li><a href="#sec-ifelse" id="toc-sec-ifelse" class="nav-link" data-scroll-target="#sec-ifelse"> <span class="header-section-number">3.2.3</span> Recoding data (ifelse)</a></li>
  <li><a href="#questions-5" id="toc-questions-5" class="nav-link" data-scroll-target="#questions-5"> <span class="header-section-number">3.2.4</span> Questions</a></li>
  <li><a href="#geom_bar" id="toc-geom_bar" class="nav-link" data-scroll-target="#geom_bar"> <span class="header-section-number">3.2.5</span> geom_bar</a></li>
  <li><a href="#questions-6" id="toc-questions-6" class="nav-link" data-scroll-target="#questions-6"> <span class="header-section-number">3.2.6</span> Questions</a></li>
  <li><a href="#geom_text" id="toc-geom_text" class="nav-link" data-scroll-target="#geom_text"> <span class="header-section-number">3.2.7</span> geom_text</a></li>
  </ul>
</li>
  <li><a href="#faceting" id="toc-faceting" class="nav-link" data-scroll-target="#faceting"> <span class="header-section-number">3.3</span> Faceting</a></li>
  <li><a href="#exporting-plots" id="toc-exporting-plots" class="nav-link" data-scroll-target="#exporting-plots"> <span class="header-section-number">3.4</span> Exporting plots</a></li>
  <li><a href="#discussion-activity" id="toc-discussion-activity" class="nav-link" data-scroll-target="#discussion-activity"> <span class="header-section-number">3.5</span> Discussion activity</a></li>
  <li><a href="#statistics" id="toc-statistics" class="nav-link" data-scroll-target="#statistics"> <span class="header-section-number">3.6</span> Statistics</a></li>
  <li><a href="#statistics-1" id="toc-statistics-1" class="nav-link" data-scroll-target="#statistics-1"> <span class="header-section-number">3.7</span> Statistics</a></li>
  <li><a href="#using-r-to-do-descriptive-statistics-and-plot-graphs" id="toc-using-r-to-do-descriptive-statistics-and-plot-graphs" class="nav-link" data-scroll-target="#using-r-to-do-descriptive-statistics-and-plot-graphs"> <span class="header-section-number">3.8</span> Using R to do descriptive statistics and plot graphs</a></li>
  </ul>
</li>
  <li>
<a href="#gender-differences" id="toc-gender-differences" class="nav-link" data-scroll-target="#gender-differences"> <span class="header-section-number">4</span> Gender differences</a>
  <ul class="collapse">
<li><a href="#statistical-analysis" id="toc-statistical-analysis" class="nav-link" data-scroll-target="#statistical-analysis"> <span class="header-section-number">4.1</span> Statistical analysis</a></li>
  </ul>
</li>
  <li>
<a href="#t-tests" id="toc-t-tests" class="nav-link" data-scroll-target="#t-tests"> <span class="header-section-number">5</span> T-tests</a>
  <ul class="collapse">
<li><a href="#task-1-1" id="toc-task-1-1" class="nav-link" data-scroll-target="#task-1-1"> <span class="header-section-number">5.1</span> Task 1</a></li>
  <li><a href="#task-2-1" id="toc-task-2-1" class="nav-link" data-scroll-target="#task-2-1"> <span class="header-section-number">5.2</span> Task 2</a></li>
  <li>
<a href="#task-3" id="toc-task-3" class="nav-link" data-scroll-target="#task-3"> <span class="header-section-number">5.3</span> Task 3</a>
  <ul class="collapse">
<li><a href="#doing-t-tests-in-r" id="toc-doing-t-tests-in-r" class="nav-link" data-scroll-target="#doing-t-tests-in-r"> <span class="header-section-number">5.3.1</span> Doing t-tests in R</a></li>
  </ul>
</li>
  </ul>
</li>
  <li>
<a href="#maths-anxiety" id="toc-maths-anxiety" class="nav-link" data-scroll-target="#maths-anxiety"> <span class="header-section-number">6</span> Maths Anxiety</a>
  <ul class="collapse">
<li><a href="#chi-square-tests" id="toc-chi-square-tests" class="nav-link" data-scroll-target="#chi-square-tests"> <span class="header-section-number">6.1</span> Chi-square tests</a></li>
  <li><a href="#load-the-data" id="toc-load-the-data" class="nav-link" data-scroll-target="#load-the-data"> <span class="header-section-number">6.2</span> Load the data</a></li>
  <li><a href="#wrangling-the-data" id="toc-wrangling-the-data" class="nav-link" data-scroll-target="#wrangling-the-data"> <span class="header-section-number">6.3</span> Wrangling the data</a></li>
  <li><a href="#contingency-tables" id="toc-contingency-tables" class="nav-link" data-scroll-target="#contingency-tables"> <span class="header-section-number">6.4</span> Contingency tables</a></li>
  <li><a href="#plotting-the-chi-square-relationships" id="toc-plotting-the-chi-square-relationships" class="nav-link" data-scroll-target="#plotting-the-chi-square-relationships"> <span class="header-section-number">6.5</span> Plotting the chi-square relationships</a></li>
  <li><a href="#running-chi-square-tests" id="toc-running-chi-square-tests" class="nav-link" data-scroll-target="#running-chi-square-tests"> <span class="header-section-number">6.6</span> Running Chi square tests</a></li>
  <li>
<a href="#seminar-tasks-1" id="toc-seminar-tasks-1" class="nav-link" data-scroll-target="#seminar-tasks-1"> <span class="header-section-number">6.7</span> Seminar Tasks</a>
  <ul class="collapse">
<li><a href="#activity-1--checking-chi-square-test-in-a-research-paper" id="toc-activity-1--checking-chi-square-test-in-a-research-paper" class="nav-link" data-scroll-target="#activity-1--checking-chi-square-test-in-a-research-paper"> <span class="header-section-number">6.7.1</span> Activity 1- Checking chi-square test in a research paper</a></li>
  <li><a href="#activity-2--determine-if-admissions-type-in-las-are-proportionate-to-national-averages" id="toc-activity-2--determine-if-admissions-type-in-las-are-proportionate-to-national-averages" class="nav-link" data-scroll-target="#activity-2--determine-if-admissions-type-in-las-are-proportionate-to-national-averages"> <span class="header-section-number">6.7.2</span> Activity 2- Determine if admissions type in LAs are proportionate to national averages</a></li>
  <li><a href="#activity-3--determine-if-ofsted-rating-and-gender-of-school-are-independent" id="toc-activity-3--determine-if-ofsted-rating-and-gender-of-school-are-independent" class="nav-link" data-scroll-target="#activity-3--determine-if-ofsted-rating-and-gender-of-school-are-independent"> <span class="header-section-number">6.7.3</span> Activity 3- Determine if Ofsted rating and gender of school are independent</a></li>
  <li><a href="#activity-4--create-your-own-problem" id="toc-activity-4--create-your-own-problem" class="nav-link" data-scroll-target="#activity-4--create-your-own-problem"> <span class="header-section-number">6.7.4</span> Activity 4- Create your own problem</a></li>
  <li><a href="#doing-chi-square-tests-in-r" id="toc-doing-chi-square-tests-in-r" class="nav-link" data-scroll-target="#doing-chi-square-tests-in-r"> <span class="header-section-number">6.7.5</span> Doing Chi-Square tests in R</a></li>
  </ul>
</li>
  </ul>
</li>
  <li>
<a href="#inquiry-learning-in-science" id="toc-inquiry-learning-in-science" class="nav-link" data-scroll-target="#inquiry-learning-in-science"> <span class="header-section-number">7</span> Inquiry learning in science</a>
  <ul class="collapse">
<li>
<a href="#running-the-test" id="toc-running-the-test" class="nav-link" data-scroll-target="#running-the-test"> <span class="header-section-number">7.1</span> Running the test</a>
  <ul class="collapse">
<li><a href="#reporting-the-test" id="toc-reporting-the-test" class="nav-link" data-scroll-target="#reporting-the-test"> <span class="header-section-number">7.1.1</span> Reporting the test</a></li>
  <li><a href="#plotting-the-results" id="toc-plotting-the-results" class="nav-link" data-scroll-target="#plotting-the-results"> <span class="header-section-number">7.1.2</span> Plotting the results</a></li>
  <li><a href="#post-tests-function" id="toc-post-tests-function" class="nav-link" data-scroll-target="#post-tests-function"> <span class="header-section-number">7.1.3</span> Post tests function</a></li>
  <li><a href="#eta-squared" id="toc-eta-squared" class="nav-link" data-scroll-target="#eta-squared"> <span class="header-section-number">7.1.4</span> Eta squared</a></li>
  </ul>
</li>
  <li>
<a href="#seminar-tasks-2" id="toc-seminar-tasks-2" class="nav-link" data-scroll-target="#seminar-tasks-2"> <span class="header-section-number">7.2</span> Seminar tasks</a>
  <ul class="collapse">
<li><a href="#activity-1-run-anova-tests-exploring" id="toc-activity-1-run-anova-tests-exploring" class="nav-link" data-scroll-target="#activity-1-run-anova-tests-exploring"> <span class="header-section-number">7.2.1</span> Activity 1: run ANOVA tests exploring…</a></li>
  <li><a href="#activity-2-prepare-for-and-run-tukey-hsd-post-hoc-test-with-summary-and-plot-of-which-contrasts-between-levels-are-statistically-significant" id="toc-activity-2-prepare-for-and-run-tukey-hsd-post-hoc-test-with-summary-and-plot-of-which-contrasts-between-levels-are-statistically-significant" class="nav-link" data-scroll-target="#activity-2-prepare-for-and-run-tukey-hsd-post-hoc-test-with-summary-and-plot-of-which-contrasts-between-levels-are-statistically-significant"> <span class="header-section-number">7.2.2</span> Activity 2: prepare for and run Tukey HSD post hoc test with summary and plot of which contrasts between levels are statistically significant</a></li>
  <li><a href="#activity-3" id="toc-activity-3" class="nav-link" data-scroll-target="#activity-3"> <span class="header-section-number">7.2.3</span> Activity 3</a></li>
  </ul>
</li>
  </ul>
</li>
  <li>
<a href="#science-capital" id="toc-science-capital" class="nav-link" data-scroll-target="#science-capital"> <span class="header-section-number">8</span> Science capital</a>
  <ul class="collapse">
<li>
<a href="#writing-a-quantitative-report" id="toc-writing-a-quantitative-report" class="nav-link" data-scroll-target="#writing-a-quantitative-report"> <span class="header-section-number">8.1</span> Writing a Quantitative Report</a>
  <ul class="collapse">
<li><a href="#activity-1-proposing-a-question" id="toc-activity-1-proposing-a-question" class="nav-link" data-scroll-target="#activity-1-proposing-a-question"> <span class="header-section-number">8.1.1</span> Activity 1: Proposing a question</a></li>
  <li><a href="#activity-2-find-a-data-set-and-check-its-applicability" id="toc-activity-2-find-a-data-set-and-check-its-applicability" class="nav-link" data-scroll-target="#activity-2-find-a-data-set-and-check-its-applicability"> <span class="header-section-number">8.1.2</span> Activity 2: Find a data set and check its applicability</a></li>
  <li><a href="#activity-3-decide-on-approaches-to-analysis" id="toc-activity-3-decide-on-approaches-to-analysis" class="nav-link" data-scroll-target="#activity-3-decide-on-approaches-to-analysis"> <span class="header-section-number">8.1.3</span> Activity 3: Decide on approaches to analysis</a></li>
  <li><a href="#activity-4-sketch-a-research-plan" id="toc-activity-4-sketch-a-research-plan" class="nav-link" data-scroll-target="#activity-4-sketch-a-research-plan"> <span class="header-section-number">8.1.4</span> Activity 4: Sketch a research plan</a></li>
  </ul>
</li>
  </ul>
</li>
  <li>
<a href="#selecting-the-correct-statistical-tool" id="toc-selecting-the-correct-statistical-tool" class="nav-link" data-scroll-target="#selecting-the-correct-statistical-tool"> <span class="header-section-number">9</span> Selecting the correct statistical tool</a>
  <ul class="collapse">
<li><a href="#choosing-appropriate-quantitative-tests" id="toc-choosing-appropriate-quantitative-tests" class="nav-link" data-scroll-target="#choosing-appropriate-quantitative-tests"> <span class="header-section-number">9.1</span> Choosing appropriate quantitative tests</a></li>
  <li>
<a href="#seminar-tasks-3" id="toc-seminar-tasks-3" class="nav-link" data-scroll-target="#seminar-tasks-3"> <span class="header-section-number">9.2</span> Seminar Tasks</a>
  <ul class="collapse">
<li><a href="#task-1-plot-a-graph-of-mean-science-scores-by-country" id="toc-task-1-plot-a-graph-of-mean-science-scores-by-country" class="nav-link" data-scroll-target="#task-1-plot-a-graph-of-mean-science-scores-by-country"> <span class="header-section-number">9.2.1</span> Task 1 Plot a graph of mean science scores by country</a></li>
  <li><a href="#task-2-are-there-differences-in-science-scores-by-gender-for-the-total-data-set" id="toc-task-2-are-there-differences-in-science-scores-by-gender-for-the-total-data-set" class="nav-link" data-scroll-target="#task-2-are-there-differences-in-science-scores-by-gender-for-the-total-data-set"> <span class="header-section-number">9.2.2</span> Task 2 Are there differences in Science scores by gender for the total data set?</a></li>
  <li><a href="#task-3-are-there-differences-in-science-scores-by-gender-for-uk-students" id="toc-task-3-are-there-differences-in-science-scores-by-gender-for-uk-students" class="nav-link" data-scroll-target="#task-3-are-there-differences-in-science-scores-by-gender-for-uk-students"> <span class="header-section-number">9.2.3</span> Task 3 Are there differences in Science scores by gender for UK students?</a></li>
  <li><a href="#task-4-for-the-whole-data-set-is-there-a-correlation-between-students-science-score-and-reading-scores" id="toc-task-4-for-the-whole-data-set-is-there-a-correlation-between-students-science-score-and-reading-scores" class="nav-link" data-scroll-target="#task-4-for-the-whole-data-set-is-there-a-correlation-between-students-science-score-and-reading-scores"> <span class="header-section-number">9.2.4</span> Task 4 For the whole data set, is there a correlation between students’ science score and reading scores?</a></li>
  <li><a href="#task-5-plot-a-representation-of-uk-students-science-score-against-reading-score." id="toc-task-5-plot-a-representation-of-uk-students-science-score-against-reading-score." class="nav-link" data-scroll-target="#task-5-plot-a-representation-of-uk-students-science-score-against-reading-score."> <span class="header-section-number">9.2.5</span> Task 5 Plot a representation of UK students’ science score against reading score.</a></li>
  <li><a href="#task-6-is-there-a-relationship-between-uk-students-gender-and-the-number-of-years-students-spend-in-early-childhood-care-e.g.-kindergarten" id="toc-task-6-is-there-a-relationship-between-uk-students-gender-and-the-number-of-years-students-spend-in-early-childhood-care-e.g.-kindergarten" class="nav-link" data-scroll-target="#task-6-is-there-a-relationship-between-uk-students-gender-and-the-number-of-years-students-spend-in-early-childhood-care-e.g.-kindergarten"> <span class="header-section-number">9.2.6</span> Task 6 Is there a relationship between UK students’ gender and the number of years students spend in early childhood care (e.g.&nbsp;kindergarten)?</a></li>
  </ul>
</li>
  </ul>
</li>
  <li>
<a href="#setting-up-analysis-for-specific-datasets" id="toc-setting-up-analysis-for-specific-datasets" class="nav-link" data-scroll-target="#setting-up-analysis-for-specific-datasets"> <span class="header-section-number">10</span> Setting up analysis for specific datasets</a>
  <ul class="collapse">
<li><a href="#pisa" id="toc-pisa" class="nav-link" data-scroll-target="#pisa"> <span class="header-section-number">10.1</span> PISA</a></li>
  <li><a href="#what-is-pisa" id="toc-what-is-pisa" class="nav-link" data-scroll-target="#what-is-pisa"> <span class="header-section-number">10.2</span> What is PISA</a></li>
  <li><a href="#how-to-use-it" id="toc-how-to-use-it" class="nav-link" data-scroll-target="#how-to-use-it"> <span class="header-section-number">10.3</span> How to use it</a></li>
  <li><a href="#common-issues" id="toc-common-issues" class="nav-link" data-scroll-target="#common-issues"> <span class="header-section-number">10.4</span> Common issues</a></li>
  <li>
<a href="#questions-7" id="toc-questions-7" class="nav-link" data-scroll-target="#questions-7"> <span class="header-section-number">10.5</span> Questions</a>
  <ul class="collapse">
<li><a href="#sec-PV" id="toc-sec-PV" class="nav-link" data-scroll-target="#sec-PV"> <span class="header-section-number">10.5.1</span> What are Plausible Values?</a></li>
  <li><a href="#why-are-some-countries-oecd-countries-and-others-arent" id="toc-why-are-some-countries-oecd-countries-and-others-arent" class="nav-link" data-scroll-target="#why-are-some-countries-oecd-countries-and-others-arent"> <span class="header-section-number">10.5.2</span> Why are some countries OECD countries and others aren’t?</a></li>
  <li><a href="#why-are-the-pv-grades-pivoting-around-the-500-mark" id="toc-why-are-the-pv-grades-pivoting-around-the-500-mark" class="nav-link" data-scroll-target="#why-are-the-pv-grades-pivoting-around-the-500-mark"> <span class="header-section-number">10.5.3</span> Why are the PV grades pivoting around the ~500 mark?</a></li>
  <li><a href="#why-are-the-letters-ta-and-na-used-in-some-field-names" id="toc-why-are-the-letters-ta-and-na-used-in-some-field-names" class="nav-link" data-scroll-target="#why-are-the-letters-ta-and-na-used-in-some-field-names"> <span class="header-section-number">10.5.4</span> Why are the letters TA and NA used in some field names?</a></li>
  </ul>
</li>
  <li><a href="#interesting-papers-and-reading-on-pisa" id="toc-interesting-papers-and-reading-on-pisa" class="nav-link" data-scroll-target="#interesting-papers-and-reading-on-pisa"> <span class="header-section-number">10.6</span> Interesting papers and reading on PISA</a></li>
  <li><a href="#copyright" id="toc-copyright" class="nav-link" data-scroll-target="#copyright"> <span class="header-section-number">10.7</span> Copyright</a></li>
  <li><a href="#english-department-for-education" id="toc-english-department-for-education" class="nav-link" data-scroll-target="#english-department-for-education"> <span class="header-section-number">10.8</span> English Department for Education</a></li>
  <li><a href="#timss" id="toc-timss" class="nav-link" data-scroll-target="#timss"> <span class="header-section-number">10.9</span> TIMSS</a></li>
  <li><a href="#other-datasets" id="toc-other-datasets" class="nav-link" data-scroll-target="#other-datasets"> <span class="header-section-number">10.10</span> Other datasets</a></li>
  </ul>
</li>
  <li>
<a href="#questions-and-answers" id="toc-questions-and-answers" class="nav-link" data-scroll-target="#questions-and-answers"> <span class="header-section-number">11</span> Questions and answers</a>
  <ul class="collapse">
<li><a href="#sec-QANDA" id="toc-sec-QANDA" class="nav-link" data-scroll-target="#sec-QANDA"> <span class="header-section-number">11.1</span> About R</a></li>
  <li><a href="#about-the-coursework" id="toc-about-the-coursework" class="nav-link" data-scroll-target="#about-the-coursework"> <span class="header-section-number">11.2</span> About the coursework</a></li>
  </ul>
</li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references"> <span class="header-section-number">12</span> References</a></li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title">Quantitative methods in the context of STEM education research</h1>
<p class="subtitle lead">MA STEM Education</p>
</div>





<div class="quarto-title-meta">

    
    
  </div>
  

</header><section id="introduction-to-quantitative-methods" class="level1" data-number="1"><h1 data-number="1">
<span class="header-section-number">1</span> Introduction to quantitative methods</h1>
<p>This session will introduce you to the assumptions that underpin quantitative research.</p>
<section id="seminar-tasks" class="level2" data-number="1.1"><h2 data-number="1.1" class="anchored" data-anchor-id="seminar-tasks">
<span class="header-section-number">1.1</span> Seminar Tasks</h2>
<section id="task-1" class="level3" data-number="1.1.1"><h3 data-number="1.1.1" class="anchored" data-anchor-id="task-1">
<span class="header-section-number">1.1.1</span> Task 1</h3>
<p>In the seminar we will consider this paper:</p>
<p><span class="citation" data-cites="pasha-zaidi2016">Pasha-Zaidi and Afari (<a href="#ref-pasha-zaidi2016" role="doc-biblioref">2016</a>)</span></p>
<p>Reflect on:</p>
<ul>
<li>What values are implied by and issues arise from the authors’ construction of quantitative variables of ‘teacher professionalism’ and ‘teacher warmth’?</li>
<li>To what extent does the authors’ survey validly probe the variables of ‘teacher professionalism’ and ‘teacher warmth’?</li>
</ul>
<div class="quarto-figure quarto-figure-left">
<figure class="figure"><p><img src="chapters/images/Intro%20Pasha%20Tool.png" class="img-fluid figure-img"></p>
</figure>
</div>
<ul>
<li>What other critiques of the study can you propose?</li>
</ul></section><section id="task-2" class="level3" data-number="1.1.2"><h3 data-number="1.1.2" class="anchored" data-anchor-id="task-2">
<span class="header-section-number">1.1.2</span> Task 2</h3>
<p>The second task considers this paper: <span class="citation" data-cites="gibson1984">Gibson and Dembo (<a href="#ref-gibson1984" role="doc-biblioref">1984</a>)</span></p>
<p>For the purpose of discussion, teacher efficacy has been defined as “the extent to which the teacher believes he or she has the capacity to affect student performance” <span class="citation" data-cites="berman1977">(<a href="#ref-berman1977" role="doc-biblioref">Berman et al. 1977, 137</a>)</span></p>
</section><section id="tool" class="level3" data-number="1.1.3"><h3 data-number="1.1.3" class="anchored" data-anchor-id="tool">
<span class="header-section-number">1.1.3</span> Tool</h3>
<div class="quarto-figure quarto-figure-left">
<figure class="figure"><p><img src="chapters/images/01%20Gibson%20Dembo%20Tool.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p><span class="citation" data-cites="gibson1984">(<a href="#ref-gibson1984" role="doc-biblioref">Gibson and Dembo 1984, 573</a>)</span></p>
</section><section id="findings" class="level3" data-number="1.1.4"><h3 data-number="1.1.4" class="anchored" data-anchor-id="findings">
<span class="header-section-number">1.1.4</span> Findings</h3>
<p><img src="chapters/images/01%20Intro%20Gibson%20Findings.png" class="img-fluid"></p>
<p><span class="citation" data-cites="gibson1984">(<a href="#ref-gibson1984" role="doc-biblioref">Gibson and Dembo 1984, 577</a>)</span></p>
</section><section id="to-discuss" class="level3" data-number="1.1.5"><h3 data-number="1.1.5" class="anchored" data-anchor-id="to-discuss">
<span class="header-section-number">1.1.5</span> To discuss</h3>
<ul>
<li>Does teacher efficacy measure a discrete aspect of teachers’ beliefs? Does that matter?</li>
<li>Does the construct have validity? I.e., does the questionnaire measure what it claims to?</li>
<li>What issues arises from quantifying teacher efficacy?</li>
<li>What alternatives are there to quantitative measures of teacher efficacy? What are their advantages and limitations?</li>
</ul></section></section><section id="activity-3-a-false-dualism" class="level2" data-number="1.2"><h2 data-number="1.2" class="anchored" data-anchor-id="activity-3-a-false-dualism">
<span class="header-section-number">1.2</span> Activity 3: A false dualism?</h2>
<blockquote class="blockquote">
<p>“‘Quantitative’ and ‘qualitative’ are frequently seen in opposition…. The contrast is drawn between the objective world (out there independently of our thinking about it) and the subjective worlds (in our heads, as it were, and individually constructed); between the public discourse and private meanings; between reality unconstructed by anyone and the ‘multiple realities’ constructed by each individual. The tendency to dichotomise in this way is understandable but misleading.” <span class="citation" data-cites="pring2000">(<a href="#ref-pring2000" role="doc-biblioref">Pring 2000, 248</a>)</span></p>
</blockquote>
<section id="discussion-questions" class="level3" data-number="1.2.1"><h3 data-number="1.2.1" class="anchored" data-anchor-id="discussion-questions">
<span class="header-section-number">1.2.1</span> Discussion Questions</h3>
<ul>
<li>What are the differing assumptions of qualitative and quantitative educational research?</li>
<li>Are the two ‘paradigms’ completely distinct? Is the distinction helpful?</li>
<li>How should a researcher choose what approach to use?</li>
</ul>
<div class="cell">

</div>
</section></section></section><section id="introduction-to-r" class="level1" data-number="2"><h1 data-number="2">
<span class="header-section-number">2</span> Introduction to R</h1>
<section id="introduction" class="level2" data-number="2.1"><h2 data-number="2.1" class="anchored" data-anchor-id="introduction">
<span class="header-section-number">2.1</span> Introduction</h2>
<p>This short course aims to take you through the process of writing your first programs in the <strong>R statistical programming language</strong> to analyse national and international educational datasets. To do this we will be using the <strong>R Studio</strong> integrated development environment (IDE), a desktop application to support you in writing R scripts. R Studio supports your programming by flagging up errors in your code as you write it, and helping you manage your analysis environment by giving you quick access to tables, objects and graphs as you develop them. In addition, we will be looking at data analysis using the <strong>tidyverse</strong> code packages. The tidyverse is a standardised collection of supporting code that helps you read data, tidy it into a usable format, analyse it and present your findings.</p>
<p>The R programming language offers similar functionality to an application based statistical tool such as SPSS, with more of a focus on you writing code to solve your problems, rather than using prebuilt tools. R is open source, meaning that it is free to use and that lots of people have written code in R that they have shared with others. R statistical libraries are some of the most comprehensive in existence. R is popular<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> in academia and industry, being used for everything from sales modelling to cancer detection.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="co"># This example shows how R can pull data directly from the internet</span></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="co"># tidy it and start making graphs. All within 9 lines of code</span></span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-4"><a href="#cb1-4"></a></span>
<span id="cb1-5"><a href="#cb1-5"></a>education <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(</span>
<span id="cb1-6"><a href="#cb1-6"></a>  <span class="st">"https://barrolee.github.io/BarroLeeDataSet/BLData/BL_v3_MF.csv"</span>)</span>
<span id="cb1-7"><a href="#cb1-7"></a></span>
<span id="cb1-8"><a href="#cb1-8"></a>education <span class="sc">%&gt;%</span></span>
<span id="cb1-9"><a href="#cb1-9"></a>  <span class="fu">filter</span>(agefrom <span class="sc">==</span> <span class="dv">15</span>, ageto <span class="sc">==</span> <span class="dv">24</span>,</span>
<span id="cb1-10"><a href="#cb1-10"></a>         country <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Germany"</span>,<span class="st">"France"</span>,<span class="st">"Italy"</span>,<span class="st">"United Kingdom"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1-11"><a href="#cb1-11"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>year, <span class="at">y=</span>yr_sch, <span class="at">colour=</span>country)) <span class="sc">+</span></span>
<span id="cb1-12"><a href="#cb1-12"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb1-13"><a href="#cb1-13"></a>  <span class="fu">geom_line</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Whilst it is possible to use R through menu systems and drop down tools, the focus of this course is for you to write your own R scripts. These are text files that will tell the computer how to go through the process of loading, cleaning, analysing and presenting data. The sequential and modular nature of these files makes it very easy to develop and test each stage separately, reuse code in the future, and share with others.</p>
<p>This booklet is written with the following sections to support you:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="co"># Code examples and questions appear like this</span></span>
<span id="cb2-2"><a href="#cb2-2"></a>a <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<pre><code>[1] Code output appears like this</code></pre>
<p><code>Courier font</code> indicates keyboard presses, column names, column values and function names.</p>
<p><code>&lt;folder&gt;</code> Courier font within brackets describe values that can be passed to functions and that you need to define yourself. I.e. copying and pasting these code chunks verbatim won’t work!</p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>specifies things to note</p>
</div>
</div>
<div class="callout-warning callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>gives warning messages</p>
</div>
</div>
<div class="callout-important callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>highlights issues that might break your code</p>
</div>
</div>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>gives suggestions on how to do things in a better way</p>
</div>
</div>
<div class="question">
<p>Activities and coding tasks look like this</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>what <span class="ot">&lt;-</span> <span class="st">"does this"</span></span>
<span id="cb3-2"><a href="#cb3-2"></a>code <span class="sc">==</span> <span class="st">"do"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section><section id="getting-set-up" class="level2" data-number="2.2"><h2 data-number="2.2" class="anchored" data-anchor-id="getting-set-up">
<span class="header-section-number">2.2</span> Getting set up</h2>
<section id="installation-on-your-own-machine" class="level3" data-number="2.2.1"><h3 data-number="2.2.1" class="anchored" data-anchor-id="installation-on-your-own-machine">
<span class="header-section-number">2.2.1</span> Installation (on your own machine)</h3>
<ol type="1">
<li>
<p>Install R (default settings should be fine)</p>
<ol type="a">
<li>
<strong>Windows</strong> users visit: <a href="https://cran.r-project.org/bin/windows/base/">here</a>
</li>
<li>
<strong>Mac</strong> users visit: <a href="hhttps://cran.r-project.org/bin/macosx/">here</a> and make sure you get the correct version</li>
</ol>
</li>
<li><p>Install <strong>RStudio</strong>, visit <a href="https://rstudio.com/products/rstudio/download/#download">here</a> and it should present you with the version suitable for your operating system.</p></li>
</ol>
<p>(If the above doesn’t work follow the instructions <a href="https://www.rstudio.com/products/rstudio/download/#download">here</a>)</p>
</section><section id="installation-kcl-restricted-machine" class="level3" data-number="2.2.2"><h3 data-number="2.2.2" class="anchored" data-anchor-id="installation-kcl-restricted-machine">
<span class="header-section-number">2.2.2</span> Installation (KCL restricted machine)</h3>
<ol type="1">
<li><p>load the software center</p></li>
<li>
<p>Search for and install <strong>“R Statistics”</strong></p>
<p><img src="chapters/images/software_centre_R.png" class="img-fluid"></p>
</li>
<li>
<p>Search for and install <strong>“RStudio”</strong></p>
<p><img src="chapters/images/software_centre_RStudio.png" class="img-fluid"></p>
</li>
</ol>
<p>You might find this tutorial video helpful:</p>
<p>https://vimeo.com/203516510</p>
</section><section id="sec-packages" class="level3" data-number="2.2.3"><h3 data-number="2.2.3" class="anchored" data-anchor-id="sec-packages">
<span class="header-section-number">2.2.3</span> Setting up RStudio and the tidyverse</h3>
<ol type="1">
<li><p>Open RStudio</p></li>
<li>
<p>On the bottom right-hand side, select <strong>Packages</strong>, then select <strong>Install</strong>, then type <strong>“tidyverse”</strong> into the Packages field of the new window:</p>
<p><img src="chapters/images/tidyverse_install.png" class="img-fluid"></p>
</li>
<li><p>Click Install and you should see things happening in the console (bottom left). Wait for the console activity to finish (it’ll be downloading and checking packages).</p></li>
<li>
<p>Add a new R Script using the <img src="chapters/images/RStudio_new_button.png" class="img-fluid"> button</p>
<p><img src="chapters/images/RStudio_new_button_RScript.png" width="210" height="74"></p>
</li>
<li>
<p>In the new R script, write the following:</p>
<p><img src="chapters/images/code_starwars.png" class="img-fluid" width="514"></p>
</li>
<li>
<p>Select all the lines and press <code>Control</code> or <code>Command</code> and <code>Enter</code> on your keyboard at the same time. Alternatively, press the <img src="chapters/images/RStudio-run.png" class="img-fluid" width="36"> button</p>
<p><img src="chapters/images/code_starwars_select.png" class="img-fluid" width="585"></p>
</li>
<li>
<p>Check that you have the following in the console window:</p>
<p><img src="chapters/images/output_data_starwars.png" class="img-fluid"></p>
</li>
<li><p>That’s it, you should be set up!</p></li>
<li><p>Any issues, please mail <a href="chapters/mailto:peter.kemp@kcl.ac.uk">peter.kemp@kcl.ac.uk</a> and <a href="chapters/mailto:richard.brock@kcl.ac.uk">richard.brock@kcl.ac.uk</a></p></li>
</ol></section></section><section id="starting-to-code" class="level2" data-number="2.3"><h2 data-number="2.3" class="anchored" data-anchor-id="starting-to-code">
<span class="header-section-number">2.3</span> Starting to code</h2>
<p>After adding a new R Script using the button <img src="chapters/images/RStudio_new_button.png" width="27" height="29">, there are four parts to R Studio’s interface. For the moment we are most interested in the Script file section, top left.</p>
<p><img src="chapters/images/RStudio_interface.png" class="img-fluid" width="600"></p>
</section><section id="your-first-program" class="level2" data-number="2.4"><h2 data-number="2.4" class="anchored" data-anchor-id="your-first-program">
<span class="header-section-number">2.4</span> Your first program</h2>
<section id="objects-and-instructions" class="level3" data-number="2.4.1"><h3 data-number="2.4.1" class="anchored" data-anchor-id="objects-and-instructions">
<span class="header-section-number">2.4.1</span> Objects and instructions</h3>
<p>In programming languages we can attach data to a name, this is called assigning a value to an object (you might also call them <em>variables</em>). To do this in R we use the <code>&lt;-</code> arrow command. For example, I want to put the word <code>"Pete"</code> into an object called <code>myname</code> (note that words and sentences such as <code>"Pete"</code> need speech marks):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>myname <span class="ot">&lt;-</span> <span class="st">"Pete"</span></span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="fu">print</span>(myname)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Pete"</code></pre>
</div>
</div>
<p>We can also perform quick calculations and assign them to objects:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>HoursInYear <span class="ot">&lt;-</span> <span class="dv">365</span> <span class="sc">*</span> <span class="dv">24</span></span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="fu">print</span>(HoursInYear) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 8760</code></pre>
</div>
</div>
<div class="question">
<p>Type the two examples above into your RStudio script file and check that they work. Adapt them to say your full name and give the number of <code>MinutesInADay</code></p>
</div>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Remember to select code and press <code>control</code> or <code>command</code> and <code>Enter</code> to run it</p>
</div>
</div>
<p>Objects can form part of calculations, for example, the code below shows how we can use the number <code>HoursInYear</code> to (roughly!) calculate the number of <code>HoursInWeek</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>HoursInYear <span class="ot">&lt;-</span> <span class="dv">365</span> <span class="sc">*</span> <span class="dv">24</span></span>
<span id="cb8-2"><a href="#cb8-2"></a></span>
<span id="cb8-3"><a href="#cb8-3"></a>HoursInWeek <span class="ot">&lt;-</span> HoursInYear <span class="sc">/</span> <span class="dv">52</span></span>
<span id="cb8-4"><a href="#cb8-4"></a><span class="fu">print</span>(HoursInWeek)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 168.4615</code></pre>
</div>
</div>
<p>Notice from the above we can perform the main arithmetic commands using keyboard symbols: <code>+</code> (add); <code>-</code> (minus); <code>*</code> (multiply); <code>/</code> (divide); <code>^</code> (power)</p>
<p>Objects can change values when you run code. For example in the code below:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>a <span class="ot">&lt;-</span> <span class="dv">2000</span></span>
<span id="cb10-2"><a href="#cb10-2"></a>b <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb10-3"><a href="#cb10-3"></a></span>
<span id="cb10-4"><a href="#cb10-4"></a>a <span class="ot">&lt;-</span> b</span>
<span id="cb10-5"><a href="#cb10-5"></a></span>
<span id="cb10-6"><a href="#cb10-6"></a>a <span class="ot">&lt;-</span> a <span class="sc">*</span> b</span>
<span id="cb10-7"><a href="#cb10-7"></a><span class="fu">print</span>(a)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 25</code></pre>
</div>
</div>
<p>What’s going on here?</p>
<ul>
<li>line 1 sets <code>a</code> to equal 2000 (note: don’t use commas in writing numbers <code>a &lt;- 2,000</code> would bring up an error),</li>
<li>line 2 sets <code>b</code> to equal 5,</li>
<li>line 4 overwrites the value of <code>a</code> with the value stored in <code>b</code>, making object <code>a</code> now equal to 5</li>
<li>line six is now <code>5 * 5</code>
</li>
</ul>
<section id="questions" class="level4" data-number="2.4.1.1"><h4 data-number="2.4.1.1" class="anchored" data-anchor-id="questions">
<span class="header-section-number">2.4.1.1</span> Questions</h4>
<div class="question">
<p>what are the outputs of the following code snippets/what do they do? One of the examples might not output anything, why is that? Type the code into your script file to check your answers:</p>
<p>code example 1</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a>rabbits <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb12-2"><a href="#cb12-2"></a>feet <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb12-3"><a href="#cb12-3"></a></span>
<span id="cb12-4"><a href="#cb12-4"></a>totalfeet <span class="ot">&lt;-</span> rabbits <span class="sc">*</span> feet</span>
<span id="cb12-5"><a href="#cb12-5"></a><span class="fu">print</span>(totalfeet)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<details><summary>answer</summary><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="dv">200</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>code example 2</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a>p <span class="ot">&lt;-</span> <span class="fl">3.14</span> <span class="sc">-</span> <span class="fl">0.14</span></span>
<span id="cb14-2"><a href="#cb14-2"></a>r <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb14-3"><a href="#cb14-3"></a></span>
<span id="cb14-4"><a href="#cb14-4"></a><span class="fu">print</span>(p <span class="sc">*</span> r<span class="sc">^</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<details><summary>answer</summary><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="dv">75</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>code example 3</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a>tax <span class="ot">&lt;-</span> <span class="fl">17.5</span></span>
<span id="cb16-2"><a href="#cb16-2"></a>price <span class="ot">&lt;-</span> <span class="fl">4.50</span></span>
<span id="cb16-3"><a href="#cb16-3"></a>sales <span class="ot">&lt;-</span> <span class="dv">128</span></span>
<span id="cb16-4"><a href="#cb16-4"></a>tax <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb16-5"><a href="#cb16-5"></a></span>
<span id="cb16-6"><a href="#cb16-6"></a>income <span class="ot">&lt;-</span> (sales <span class="sc">*</span> price) <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> (tax<span class="sc">/</span><span class="dv">100</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<details><summary>answer</summary><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="co"># prints nothing! there isn't a print statement</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</section></section><section id="naming-objects" class="level3" data-number="2.4.2"><h3 data-number="2.4.2" class="anchored" data-anchor-id="naming-objects">
<span class="header-section-number">2.4.2</span> Naming objects</h3>
<p>Correctly naming objects is very important. You can give an object almost any name, but there are a few rules to follow:</p>
<ul>
<li>Name them something sensible</li>
<li>R is case sensitive, <code>myName</code> is not equal to (<code>!=</code>) <code>myname</code>
</li>
<li>Don’t use spaces in names</li>
<li>Don’t start a name with a number</li>
<li>Keep punctuation in object names to underscore (<code>_</code> and full stop <code>.</code>) e.g.&nbsp;<code>my_name</code>, <code>my.name</code> <a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>.</li>
<li>Stick to a convention for all your objects, it’ll make your code easier to read, e.g.
<ul>
<li>
<code>myName</code>, <code>yourName</code>, <code>ourName</code> (this is <em>camelCase</em> <a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>)</li>
<li>
<code>my_name</code>, <code>your_name</code>, <code>our_name</code>
</li>
</ul>
</li>
</ul>
<div class="callout-important callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>The actual name of an object has no effect on what it does (other than invalid names breaking your program!). For example <code>age &lt;- "Barry"</code> is perfectly valid to R, it’s just a real pain for a human to read.</p>
</div>
</div>
<section id="questions-1" class="level4" data-number="2.4.2.1"><h4 data-number="2.4.2.1" class="anchored" data-anchor-id="questions-1">
<span class="header-section-number">2.4.2.1</span> Questions</h4>
<div class="question">
<p>Which of these are valid R object names:</p>
<ul>
<li><code>my_Number</code></li>
<li><code>my-Number</code></li>
<li><code>myNumber!</code></li>
<li><code>first name</code></li>
<li><code>FIRSTname</code></li>
<li><code>i</code></li>
<li><code>3names</code></li>
<li><code>names3</code></li>
</ul>
<div class="cell">
<details><summary>answers</summary><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a><span class="co"># my_Number  (VALID)</span></span>
<span id="cb18-2"><a href="#cb18-2"></a><span class="co"># my-Number  (VALID)</span></span>
<span id="cb18-3"><a href="#cb18-3"></a><span class="co"># myNumber!  (INVALID due to !)</span></span>
<span id="cb18-4"><a href="#cb18-4"></a><span class="co"># first name (INVALID due to space)</span></span>
<span id="cb18-5"><a href="#cb18-5"></a><span class="co"># FIRSTname  (VALID but don't recommend so many caps)</span></span>
<span id="cb18-6"><a href="#cb18-6"></a><span class="co"># i          (VALID)</span></span>
<span id="cb18-7"><a href="#cb18-7"></a><span class="co"># 3names     (INVALID starts with a 3)</span></span>
<span id="cb18-8"><a href="#cb18-8"></a><span class="co"># names3     (VALID)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>For more information on the R programming style guide, see <a href="https://style.tidyverse.org/">this</a></p>
</div>
</div>
</section></section><section id="comments" class="level3" data-number="2.4.3"><h3 data-number="2.4.3" class="anchored" data-anchor-id="comments">
<span class="header-section-number">2.4.3</span> Comments</h3>
<p>Code can often look confusing and it’s a good idea to add <code># comments</code> to your code to make it more understandable for you and others. The computer ignores comments when running your code:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a><span class="co"># this calculates the average sales per shop</span></span>
<span id="cb19-2"><a href="#cb19-2"></a></span>
<span id="cb19-3"><a href="#cb19-3"></a>income1 <span class="ot">&lt;-</span> <span class="dv">132</span></span>
<span id="cb19-4"><a href="#cb19-4"></a>income2 <span class="ot">&lt;-</span> <span class="dv">665</span></span>
<span id="cb19-5"><a href="#cb19-5"></a>income3 <span class="ot">&lt;-</span> <span class="dv">233</span></span>
<span id="cb19-6"><a href="#cb19-6"></a>income4 <span class="ot">&lt;-</span> <span class="dv">1200</span></span>
<span id="cb19-7"><a href="#cb19-7"></a></span>
<span id="cb19-8"><a href="#cb19-8"></a>shops <span class="ot">&lt;-</span> <span class="dv">4</span> <span class="co"># everything after the hash is a comment</span></span>
<span id="cb19-9"><a href="#cb19-9"></a></span>
<span id="cb19-10"><a href="#cb19-10"></a>avgSales <span class="ot">&lt;-</span> <span class="fu">sum</span>(income1, income2, income3, income4) <span class="sc">/</span> shops  </span>
<span id="cb19-11"><a href="#cb19-11"></a></span>
<span id="cb19-12"><a href="#cb19-12"></a><span class="co"># sometimes you might want to comment out code that</span></span>
<span id="cb19-13"><a href="#cb19-13"></a><span class="co"># is no longer needed, but might be useful later</span></span>
<span id="cb19-14"><a href="#cb19-14"></a><span class="co"># standard_deviation &lt;- sd(c(income1, income2, income3, income4) )</span></span>
<span id="cb19-15"><a href="#cb19-15"></a><span class="co"># the above code isn't run</span></span>
<span id="cb19-16"><a href="#cb19-16"></a></span>
<span id="cb19-17"><a href="#cb19-17"></a><span class="fu">print</span>(avgSales) <span class="co"># but this code is</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 557.5</code></pre>
</div>
</div>
</section></section><section id="sec-datatypes" class="level2" data-number="2.5"><h2 data-number="2.5" class="anchored" data-anchor-id="sec-datatypes">
<span class="header-section-number">2.5</span> Datatypes</h2>
<p>We have already met two different <em>datatypes</em>, the <em>character</em> datatype for words and letters (e.g.&nbsp;<code>"Peter"</code>) and the <em>numeric</em> datatype for numbers (e.g.&nbsp;<code>12</code>). Datatypes tell R how to handle data in certain circumstances. Sometimes data will be of the wrong datatype and you will need to convert between datatypes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a>weeks <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb21-2"><a href="#cb21-2"></a>days_in_week <span class="ot">&lt;-</span> <span class="st">"7"</span></span>
<span id="cb21-3"><a href="#cb21-3"></a></span>
<span id="cb21-4"><a href="#cb21-4"></a><span class="co"># we now attempt to multiply a number by a string</span></span>
<span id="cb21-5"><a href="#cb21-5"></a><span class="co"># but it doesn't work!</span></span>
<span id="cb21-6"><a href="#cb21-6"></a>total_days <span class="ot">&lt;-</span> weeks <span class="sc">*</span> days_in_week </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in weeks * days_in_week: non-numeric argument to binary operator</code></pre>
</div>
</div>
<p>Whilst R will understand what to do when we multiply numbers with numbers, it gets very confused and raises an error when we try to perform an <em>arithmetic</em> operation using <em>words</em> and <em>numbers</em>.</p>
<p>To perform the calculation we will need to convert the <code>days_in_week</code> from a string to a number, using the <code>as.numeric(&lt;text&gt;)</code> command:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a>weeks <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb23-2"><a href="#cb23-2"></a>days_in_week <span class="ot">&lt;-</span> <span class="st">"7"</span></span>
<span id="cb23-3"><a href="#cb23-3"></a></span>
<span id="cb23-4"><a href="#cb23-4"></a><span class="co"># we now attempt to multiply a number by a string</span></span>
<span id="cb23-5"><a href="#cb23-5"></a>total_days <span class="ot">&lt;-</span> weeks <span class="sc">*</span> <span class="fu">as.numeric</span>(days_in_week)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>There is a <em>logical</em> datatype for boolean values of <code>TRUE</code> and <code>FALSE</code>. This will become a lot more useful later.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a>legs_snake <span class="ot">&lt;-</span> <span class="cn">TRUE</span> <span class="co"># you can specify logical values directly</span></span>
<span id="cb24-2"><a href="#cb24-2"></a>dogs_legs <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb24-3"><a href="#cb24-3"></a>legs_dog <span class="ot">&lt;-</span> dogs_legs <span class="sc">&gt;</span> <span class="dv">0</span> <span class="co"># or as part of a calculation</span></span>
<span id="cb24-4"><a href="#cb24-4"></a></span>
<span id="cb24-5"><a href="#cb24-5"></a><span class="co"># Do dog's have legs?</span></span>
<span id="cb24-6"><a href="#cb24-6"></a><span class="fu">print</span>(legs_dog)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
<p>There are actually three datatypes for numbers in R, <code>numeric</code> for most of your work, the rarer <code>integer</code> specifically for whole numbers and the even rarer <code>complex</code> for complex numbers. When you are looking at categorical data, <code>factors</code> are used on top of the underlying datatype to store the different values, for example you might have a field of <code>character</code> to store <code>countries</code>, factors would then list the different countries stored in this character field.</p>
<p>To change from one datatype to another we use the <code>as.____</code> command: <code>as.numeric(&lt;text&gt;)</code>, <code>as.logical(&lt;data&gt;)</code>, <code>as.character(&lt;numeric&gt;)</code>.</p>
<section id="questions-2" class="level4" data-number="2.5.0.1"><h4 data-number="2.5.0.1" class="anchored" data-anchor-id="questions-2">
<span class="header-section-number">2.5.0.1</span> Questions</h4>
<div class="question">
<ol type="1">
<li>Can you spot the error(s) in this code and fix them so it outputs: “July is month 7”?</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r none number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a>month <span class="ot">&lt;-</span> <span class="st">"July"</span></span>
<span id="cb26-2"><a href="#cb26-2"></a>order <span class="ot">&lt;-</span> <span class="dv">7</span></span>
<span id="cb26-3"><a href="#cb26-3"></a>  </span>
<span id="cb26-4"><a href="#cb26-4"></a><span class="fu">print</span>(month)</span>
<span id="cb26-5"><a href="#cb26-5"></a><span class="fu">Print</span>(<span class="st">"is"</span>)</span>
<span id="cb26-6"><a href="#cb26-6"></a><span class="fu">print</span>(month)</span>
<span id="cb26-7"><a href="#cb26-7"></a><span class="fu">print</span>(<span class="st">"order"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<details><summary>answer</summary><div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a>month <span class="ot">&lt;-</span> <span class="st">"July"</span></span>
<span id="cb27-2"><a href="#cb27-2"></a>order <span class="ot">&lt;-</span> <span class="dv">7</span></span>
<span id="cb27-3"><a href="#cb27-3"></a>  </span>
<span id="cb27-4"><a href="#cb27-4"></a><span class="fu">print</span>(month)    </span>
<span id="cb27-5"><a href="#cb27-5"></a><span class="fu">print</span>(<span class="st">"is"</span>)     <span class="co">#1 print needs a lowercase p</span></span>
<span id="cb27-6"><a href="#cb27-6"></a><span class="fu">print</span>(<span class="st">"month"</span>)  <span class="co">#2 month is a character not an object, use speech marks</span></span>
<span id="cb27-7"><a href="#cb27-7"></a><span class="fu">print</span>(order)    <span class="co">#3 order is an object, not a character, so drop the speech marks</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="2" type="1">
<li>Can you spot the error(s) in this code and fix it?</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource r none number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a>a <span class="ot">&lt;-</span> <span class="dv">7</span></span>
<span id="cb28-2"><a href="#cb28-2"></a>b <span class="ot">&lt;-</span> <span class="st">"8"</span></span>
<span id="cb28-3"><a href="#cb28-3"></a>c <span class="sc">&lt;</span> <span class="sc">-</span> <span class="dv">3</span></span>
<span id="cb28-4"><a href="#cb28-4"></a>  </span>
<span id="cb28-5"><a href="#cb28-5"></a><span class="fu">print</span>(a <span class="sc">+</span> b <span class="sc">+</span> c)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<details><summary>answer</summary><div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a>a <span class="ot">&lt;-</span> <span class="dv">7</span></span>
<span id="cb29-2"><a href="#cb29-2"></a>b <span class="ot">&lt;-</span> <span class="dv">8</span> <span class="co">#1 b is numeric so drop the speech marks</span></span>
<span id="cb29-3"><a href="#cb29-3"></a>c <span class="ot">&lt;-</span> <span class="dv">3</span> <span class="co">#2 the arrow needs to be together, remove the space</span></span>
<span id="cb29-4"><a href="#cb29-4"></a>  </span>
<span id="cb29-5"><a href="#cb29-5"></a><span class="fu">print</span>(a <span class="sc">+</span> b <span class="sc">+</span> c)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="3" type="1">
<li>Can you spot the error(s) in this code and fix it?</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource r none number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a>pass mark <span class="ot">&lt;-</span> <span class="dv">50</span> </span>
<span id="cb30-2"><a href="#cb30-2"></a>exam_grade <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb30-3"><a href="#cb30-3"></a></span>
<span id="cb30-4"><a href="#cb30-4"></a><span class="co"># did the student pass?</span></span>
<span id="cb30-5"><a href="#cb30-5"></a><span class="fu">print</span>(exam_grade <span class="sc">&gt;</span> pass_mark)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<details><summary>answer</summary><div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a>pass_mark <span class="ot">&lt;-</span> <span class="dv">50</span> <span class="co">#1 the variable name can't have any spaces</span></span>
<span id="cb31-2"><a href="#cb31-2"></a>exam_grade <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb31-3"><a href="#cb31-3"></a></span>
<span id="cb31-4"><a href="#cb31-4"></a><span class="co"># did the student pass?</span></span>
<span id="cb31-5"><a href="#cb31-5"></a><span class="fu">print</span>(exam_grade <span class="sc">&gt;=</span> pass_mark) <span class="co"># this needs to be &gt;= as they had a passing grade</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>If you want to find out the datatype of an object you can use the structure <code>str</code> command to give you more information about the object. In this instance <code>chr</code> means that <code>month</code> is of character datatype and <code>num</code> means it is of the numeric datatype.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a>month <span class="ot">&lt;-</span> <span class="st">"July"</span></span>
<span id="cb32-2"><a href="#cb32-2"></a><span class="fu">str</span>(month)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> chr "July"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1"></a>month <span class="ot">&lt;-</span> <span class="dv">7</span></span>
<span id="cb34-2"><a href="#cb34-2"></a><span class="fu">str</span>(month)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> num 7</code></pre>
</div>
</div>
</div>
</div>
</section><section id="sec-vectors" class="level3" data-number="2.5.1"><h3 data-number="2.5.1" class="anchored" data-anchor-id="sec-vectors">
<span class="header-section-number">2.5.1</span> Vectors</h3>
<p>So far we have seen how R does simple calculations and prints out the results. Underlying all of this are <em>vectors</em>. Vectors are data structures that bring together one or data elements of the <em>same</em> datatype. E.g. we might have a <code>numeric</code> vector recording the grades of a class, or a <code>character</code> vector storing the gender of a set of students. To define a vector we use <code>c(&lt;item&gt;, &lt;item&gt;, ...)</code>, where <code>c</code> stands for <em>combine</em>. Vectors are very important to R<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a>, even declaring a single object, <code>x &lt;- 6</code>, is creating a vector of size one. Larger vectors look like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1"></a>maths_grade <span class="ot">&lt;-</span>   <span class="fu">c</span>(<span class="dv">5</span>,    <span class="dv">4</span>,    <span class="dv">4</span>,    <span class="dv">1</span>,     <span class="dv">7</span>,     <span class="dv">5</span>,     <span class="dv">8</span>)</span>
<span id="cb36-2"><a href="#cb36-2"></a>english_grade <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">8</span>,    <span class="dv">5</span>,    <span class="dv">3</span>,    <span class="dv">2</span>,     <span class="dv">3</span>,     <span class="dv">6</span>,     <span class="dv">9</span>)</span>
<span id="cb36-3"><a href="#cb36-3"></a>genders <span class="ot">&lt;-</span>      <span class="fu">c</span>(<span class="st">"F"</span>,  <span class="st">"M"</span>,  <span class="st">"M"</span>,  <span class="st">"F"</span>,   <span class="st">"M"</span>,   <span class="st">"F"</span>,   <span class="st">"M"</span>)</span>
<span id="cb36-4"><a href="#cb36-4"></a>students <span class="ot">&lt;-</span>     <span class="fu">c</span>(<span class="st">"Joe"</span>, <span class="st">"Al"</span>, <span class="st">"Mo"</span>, <span class="st">"Flo"</span>, <span class="st">"Olu"</span>, <span class="st">"Sam"</span>, <span class="st">"Jimmy"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You can quickly perform calculations across whole vectors:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1"></a><span class="co"># convert all genders to the lower case form</span></span>
<span id="cb37-2"><a href="#cb37-2"></a><span class="fu">tolower</span>(genders) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "f" "m" "m" "f" "m" "f" "m"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1"></a><span class="co"># raise everyone's maths grade by one(!?)</span></span>
<span id="cb39-2"><a href="#cb39-2"></a>maths_grade <span class="sc">+</span> <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 6 5 5 2 8 6 9</code></pre>
</div>
</div>
<p>We can also perform calculations across vectors, in the example below we can find out which students got a better grade in Maths than in English.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1"></a><span class="co"># this compares each pair of values</span></span>
<span id="cb41-2"><a href="#cb41-2"></a><span class="co"># e.g. the first item in maths_grade (5) with</span></span>
<span id="cb41-3"><a href="#cb41-3"></a><span class="co"># the first item in english_grade (8)</span></span>
<span id="cb41-4"><a href="#cb41-4"></a><span class="co"># and so on</span></span>
<span id="cb41-5"><a href="#cb41-5"></a><span class="co"># This returns a logical vector of TRUE and FALSE</span></span>
<span id="cb41-6"><a href="#cb41-6"></a>maths_grade <span class="sc">&gt;</span> english_grade</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE FALSE  TRUE FALSE  TRUE FALSE FALSE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1"></a><span class="co"># To work out how many students got a better grade </span></span>
<span id="cb43-2"><a href="#cb43-2"></a><span class="co"># in maths than in English we can apply sum()</span></span>
<span id="cb43-3"><a href="#cb43-3"></a><span class="co"># to the logical vector. </span></span>
<span id="cb43-4"><a href="#cb43-4"></a><span class="co"># We know that TRUE == 1, FALSE == 0,</span></span>
<span id="cb43-5"><a href="#cb43-5"></a><span class="co"># so sum() will count all the TRUEs</span></span>
<span id="cb43-6"><a href="#cb43-6"></a><span class="fu">sum</span>(maths_grade <span class="sc">&gt;</span> english_grade)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1"></a><span class="co"># if you want to find out the average grade for</span></span>
<span id="cb45-2"><a href="#cb45-2"></a><span class="co"># each student in maths and english</span></span>
<span id="cb45-3"><a href="#cb45-3"></a><span class="co"># add both vectors together and divide by 2</span></span>
<span id="cb45-4"><a href="#cb45-4"></a>(maths_grade <span class="sc">+</span> english_grade) <span class="sc">/</span> <span class="dv">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 6.5 4.5 3.5 1.5 5.0 5.5 8.5</code></pre>
</div>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1"></a><span class="co"># we can use square brackets to pick a value from a vector</span></span>
<span id="cb47-2"><a href="#cb47-2"></a><span class="co"># vectors start couting from 1, so students[1] would pick Jo</span></span>
<span id="cb47-3"><a href="#cb47-3"></a>students[<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Joe"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1"></a><span class="co"># we can pass a numeric vector to a another vector to create a</span></span>
<span id="cb49-2"><a href="#cb49-2"></a><span class="co"># subset, in the example below we find the 3rd and 5th item</span></span>
<span id="cb49-3"><a href="#cb49-3"></a></span>
<span id="cb49-4"><a href="#cb49-4"></a>students[<span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">5</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Mo"  "Olu"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1"></a><span class="co"># we can also use a vector of TRUE and FALSE to pick items</span></span>
<span id="cb51-2"><a href="#cb51-2"></a><span class="co"># TRUE will pick an item, FALSE will ignore it</span></span>
<span id="cb51-3"><a href="#cb51-3"></a><span class="co"># for each maths_grade &gt; english_grade that is TRUE</span></span>
<span id="cb51-4"><a href="#cb51-4"></a><span class="co"># the name in that position in the student vector will be shown</span></span>
<span id="cb51-5"><a href="#cb51-5"></a>students[maths_grade <span class="sc">&gt;</span> english_grade]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Mo"  "Olu"</code></pre>
</div>
</div>
<p>You should be careful when trying to compare vectors of different lengths. When combining vectors of different lengths, the shorter vector will match the length of the longer vector by wrapping its values around. For example if we try to combine a vector of the numbers 1 ot 10 with a two item logical vector <code>TRUE</code> <code>FALSE</code>, the logical vector will repeat 5 times: <code>c(TRUE, FALSE, TRUE, FALSE, TRUE, FALSE, TRUE, FALSE, TRUE, FALSE)</code>. We can use this vector as a <em>mask</em> to return the odd numbers, TRUE means keep, FALSE means ignore:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1"></a>nums <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>,<span class="dv">10</span>)</span>
<span id="cb53-2"><a href="#cb53-2"></a>mask <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">FALSE</span>) </span>
<span id="cb53-3"><a href="#cb53-3"></a></span>
<span id="cb53-4"><a href="#cb53-4"></a><span class="co"># you can see the repeat of mask by pasting them together</span></span>
<span id="cb53-5"><a href="#cb53-5"></a><span class="fu">paste</span>(nums, mask)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "1 TRUE"   "2 FALSE"  "3 TRUE"   "4 FALSE"  "5 TRUE"   "6 FALSE" 
 [7] "7 TRUE"   "8 FALSE"  "9 TRUE"   "10 FALSE"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1"></a><span class="co"># now to filter out the numbers we don't want</span></span>
<span id="cb55-2"><a href="#cb55-2"></a>nums[mask]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1 3 5 7 9</code></pre>
</div>
</div>
<p>This might not seem very useful, but it comes in very handy when we want to perform a single calculation across a whole vector. For example, we want to find all the students who achieved grade 5 in English, the below code creates a vector of <code>5</code>s the same size as <code>english_grade</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1"></a><span class="co"># this can also be rewritten english_grade &gt;= c(5)</span></span>
<span id="cb57-2"><a href="#cb57-2"></a><span class="co"># note, when we are doing a comparison, we need to use double ==</span></span>
<span id="cb57-3"><a href="#cb57-3"></a>students[english_grade <span class="sc">==</span> <span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Al"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1"></a><span class="co">#which is the same as</span></span>
<span id="cb59-2"><a href="#cb59-2"></a>students[english_grade <span class="sc">==</span> <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">5</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Al"</code></pre>
</div>
</div>
<div class="callout-important callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>When we are doing a comparison, we need to use double <code>==</code> equals sign. Using a single equals sign is the equivalent of an assignment <code>=</code> is the same as <code>&lt;-</code></p>
</div>
</div>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>There are several shortcuts that you can take when creating vectors. Instead of writing a whole sequence of numbers by hand, you can use the <code>seq(&lt;start&gt;, &lt;finish&gt;, &lt;step&gt;)</code> command. For example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1"></a><span class="co"># the step default is 1, so you can miss it from seq(1,10,1)</span></span>
<span id="cb61-2"><a href="#cb61-2"></a><span class="fu">seq</span>(<span class="dv">1</span>,<span class="dv">10</span>)   <span class="sc">==</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>,<span class="dv">10</span>)</span>
<span id="cb61-3"><a href="#cb61-3"></a><span class="fu">seq</span>(<span class="dv">1</span>,<span class="dv">10</span>,<span class="dv">2</span>) <span class="sc">==</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">5</span>,<span class="dv">7</span>,<span class="dv">9</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This allows for some pretty short ways of solving quite complex problems, for example if you wanted to know the sum of all the <a href="https://projecteuler.net/problem=1">multiples of 3 and 5 below 1000</a>, you could write it like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1"></a><span class="co"># the unique() command gives you the unique items in a vector</span></span>
<span id="cb62-2"><a href="#cb62-2"></a><span class="fu">sum</span>(<span class="fu">unique</span>(<span class="fu">c</span>(<span class="fu">seq</span>(<span class="dv">3</span>, <span class="dv">999</span>, <span class="dv">3</span>), <span class="fu">seq</span>(<span class="dv">5</span>, <span class="dv">999</span>, <span class="dv">5</span>))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Another shortcut is writing <code>T</code>, <code>F</code>, or <code>1</code>, <code>0</code> instead of the whole words <code>TRUE</code>, <code>FALSE</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1"></a><span class="fu">c</span>(T, F) <span class="sc">==</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>) <span class="sc">==</span> <span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</section><section id="questions-3" class="level3" data-number="2.5.2"><h3 data-number="2.5.2" class="anchored" data-anchor-id="questions-3">
<span class="header-section-number">2.5.2</span> Questions</h3>
<div class="question">
<ol type="1">
<li>Can you spot the <em>four</em> problems with this code:</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode numberSource r none number-lines code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1"></a>nums <span class="ot">&lt;-</span> <span class="fu">v</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="st">"3"</span>,<span class="dv">4</span>,<span class="dv">7</span>,<span class="dv">2</span>,<span class="dv">2</span>)</span>
<span id="cb64-2"><a href="#cb64-2"></a><span class="fu">sum</span>(nums)</span>
<span id="cb64-3"><a href="#cb64-3"></a><span class="fu">mean</span>(nums)</span>
<span id="cb64-4"><a href="#cb64-4"></a><span class="co"># return a vector of all numbers greater than 2</span></span>
<span id="cb64-5"><a href="#cb64-5"></a><span class="fu">nums</span>(nums <span class="sc">&gt;=</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<details><summary>answer</summary><div class="sourceCode cell-code" id="cb65"><pre class="sourceCode numberSource r none number-lines code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1"></a>nums <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">7</span>,<span class="dv">2</span>,<span class="dv">2</span>) </span>
<span id="cb65-2"><a href="#cb65-2"></a><span class="co">#1 a vector is declared using c(), not v()</span></span>
<span id="cb65-3"><a href="#cb65-3"></a><span class="co">#2 3 should be numeric, so no need for speech marks</span></span>
<span id="cb65-4"><a href="#cb65-4"></a><span class="co"># (though technically R would do this conversion for you!)</span></span>
<span id="cb65-5"><a href="#cb65-5"></a></span>
<span id="cb65-6"><a href="#cb65-6"></a><span class="fu">sum</span>(nums)</span>
<span id="cb65-7"><a href="#cb65-7"></a><span class="fu">mean</span>(nums)</span>
<span id="cb65-8"><a href="#cb65-8"></a><span class="co"># return a vector of all numbers greater than 2</span></span>
<span id="cb65-9"><a href="#cb65-9"></a>nums[nums <span class="sc">&gt;=</span> <span class="dv">2</span>] <span class="co">#3 to pick items from another vector, use square brackets</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="2" type="1">
<li>Create a vector to store the number of glasses of water you have drunk for each day in the last 7 days. Work out:
<ul>
<li>the average number of glasses for the week,</li>
<li>the total number of glasses,</li>
<li>the number of days where you drank less than 2 glasses (feel free to replace water with your own tipple: wine, coffee, tea, coke, etc.)</li>
</ul>
</li>
</ol>
<div class="cell">
<details><summary>answer</summary><div class="sourceCode cell-code" id="cb66"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1"></a>glasses <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">6</span>,<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">0</span>)</span>
<span id="cb66-2"><a href="#cb66-2"></a><span class="fu">mean</span>(glasses)</span>
<span id="cb66-3"><a href="#cb66-3"></a><span class="fu">sum</span>(glasses)</span>
<span id="cb66-4"><a href="#cb66-4"></a><span class="fu">sum</span>(glasses <span class="sc">&lt;</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="3" type="1">
<li>Using the vectors below, create a program that will find out the average grade for females taking English:</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1"></a>english_grade <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">8</span>,<span class="dv">5</span>,<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">6</span>,<span class="dv">9</span>)</span>
<span id="cb67-2"><a href="#cb67-2"></a>genders <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"F"</span>, <span class="st">"M"</span>, <span class="st">"M"</span>, <span class="st">"F"</span>, <span class="st">"M"</span>, <span class="st">"F"</span>, <span class="st">"M"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<details><summary>answer</summary><div class="sourceCode cell-code" id="cb68"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1"></a>english_grade <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">8</span>,<span class="dv">5</span>,<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">6</span>,<span class="dv">9</span>)</span>
<span id="cb68-2"><a href="#cb68-2"></a>genders <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"F"</span>, <span class="st">"M"</span>, <span class="st">"M"</span>, <span class="st">"F"</span>, <span class="st">"M"</span>, <span class="st">"F"</span>, <span class="st">"M"</span>)</span>
<span id="cb68-3"><a href="#cb68-3"></a><span class="fu">mean</span>(english_grade[genders <span class="sc">==</span> <span class="st">"F"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</section><section id="summary-questions" class="level3" data-number="2.5.3"><h3 data-number="2.5.3" class="anchored" data-anchor-id="summary-questions">
<span class="header-section-number">2.5.3</span> Summary questions</h3>
<p>Now you have covered the basics of R, it’s time for some questions to check your understanding. These questions will cover all the material you have read so far and don’t be worried if you need to go back and check something. Exemplar answers are provided, but don’t worry if your solution looks a little different, there are often multiple ways to achieve the same outcome.</p>
<div class="question">
<ol type="1">
<li>Describe three datatypes that you can use in your program?</li>
</ol>
<div class="cell">
<details><summary>answer</summary><div class="sourceCode cell-code" id="cb69"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1"></a><span class="fu">print</span>(<span class="st">"numeric for numbers"</span>)</span>
<span id="cb69-2"><a href="#cb69-2"></a><span class="fu">print</span>(<span class="st">"character for words/strings"</span>)</span>
<span id="cb69-3"><a href="#cb69-3"></a><span class="fu">print</span>(<span class="st">"logical for boolean values"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="2" type="1">
<li>What are two reasons that you might use comments?</li>
</ol>
<div class="cell">
<details><summary>answer</summary><div class="sourceCode cell-code" id="cb70"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1"></a><span class="co"># to make your code more understandable</span></span>
<span id="cb70-2"><a href="#cb70-2"></a><span class="co"># to disable bits of code that you might want to reenable later</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="3" type="1">
<li>
<p>Which object names are valid?</p>
<ul>
<li><code>my_name</code></li>
<li><code>your name</code></li>
<li><code>our-name</code></li>
<li><code>THYname</code></li>
</ul>
</li>
</ol>
<div class="cell">
<details><summary>answer</summary><div class="sourceCode cell-code" id="cb71"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1"></a><span class="co"># my_name - VALID</span></span>
<span id="cb71-2"><a href="#cb71-2"></a><span class="co"># your name - INVALID use of space</span></span>
<span id="cb71-3"><a href="#cb71-3"></a><span class="co"># our-name - INVALID use of hyphen</span></span>
<span id="cb71-4"><a href="#cb71-4"></a><span class="co"># THYname - VALID</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="4" type="1">
<li>Can you spot the <em>four</em> errors in this code:</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode numberSource r none number-lines code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1"></a>stu1 <span class="ot">&lt;-</span> <span class="dv">12</span></span>
<span id="cb72-2"><a href="#cb72-2"></a>2stu <span class="ot">&lt;-</span> <span class="dv">13</span></span>
<span id="cb72-3"><a href="#cb72-3"></a>stu3 <span class="ot">&lt;-</span> <span class="st">"15"</span></span>
<span id="cb72-4"><a href="#cb72-4"></a></span>
<span id="cb72-5"><a href="#cb72-5"></a><span class="co"># now work out the average of the ages</span></span>
<span id="cb72-6"><a href="#cb72-6"></a>avg <span class="sc">&lt;</span> <span class="sc">-</span> (Stu1 <span class="sc">+</span> stu2 <span class="sc">+</span> stu3) <span class="sc">/</span> <span class="dv">3</span></span>
<span id="cb72-7"><a href="#cb72-7"></a><span class="fu">print</span>(avg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<details><summary>answer</summary><div class="sourceCode cell-code" id="cb73"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1"></a>stu1 <span class="ot">&lt;-</span> <span class="dv">12</span></span>
<span id="cb73-2"><a href="#cb73-2"></a>stu2 <span class="ot">&lt;-</span> <span class="dv">13</span> <span class="co">#1 2stu to stu2, cannot start name with a number</span></span>
<span id="cb73-3"><a href="#cb73-3"></a>stu3 <span class="ot">&lt;-</span> <span class="dv">15</span> <span class="co">#2 no need for speech marks on "15"</span></span>
<span id="cb73-4"><a href="#cb73-4"></a></span>
<span id="cb73-5"><a href="#cb73-5"></a><span class="co"># now work out the average of the ages</span></span>
<span id="cb73-6"><a href="#cb73-6"></a>avg <span class="ot">&lt;-</span> (stu1 <span class="sc">+</span> stu2 <span class="sc">+</span> stu3) <span class="sc">/</span> <span class="dv">3</span> <span class="co">#3 broken arrow &lt; - #4 capital letter on Stu1</span></span>
<span id="cb73-7"><a href="#cb73-7"></a><span class="fu">print</span>(avg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="5" type="1">
<li>[Extension] Calculate the number of seconds since 1970.</li>
</ol>
<div class="cell">
<details><summary>answer</summary><div class="sourceCode cell-code" id="cb74"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1"></a>this_year <span class="ot">&lt;-</span> <span class="dv">2022</span></span>
<span id="cb74-2"><a href="#cb74-2"></a>focus_year <span class="ot">&lt;-</span> <span class="dv">1970</span></span>
<span id="cb74-3"><a href="#cb74-3"></a></span>
<span id="cb74-4"><a href="#cb74-4"></a>(this_year <span class="sc">-</span> focus_year) <span class="sc">*</span> <span class="dv">365</span> <span class="sc">*</span> <span class="dv">24</span> <span class="sc">*</span> <span class="dv">60</span> <span class="sc">*</span> <span class="dv">60</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</section></section><section id="packages-and-libraries" class="level2" data-number="2.6"><h2 data-number="2.6" class="anchored" data-anchor-id="packages-and-libraries">
<span class="header-section-number">2.6</span> Packages and libraries</h2>
<p>R comes with some excellent statistical tools, but often you will need to supplement them with packages<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a> . Packages contain functionality that isn’t built into R by default, but you can choose to load or install them to meet the needs of your tasks. For example you have code packages to deal with SPSS data, and other packages to run machine learning algorithms. Nearly all R packages are free to use!</p>
<section id="sec-load-run-pckges" class="level3" data-number="2.6.1"><h3 data-number="2.6.1" class="anchored" data-anchor-id="sec-load-run-pckges">
<span class="header-section-number">2.6.1</span> Installing and loading packages</h3>
<p>To install a package you can use the package tab in the bottom right-hand panel of RStudio and follow the steps from <a href="#sec-packages">Section&nbsp;2.2.3</a>. Alternatively you can install things by typing:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1"></a><span class="fu">install.packages</span>(<span class="st">"tidyverse"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that the instruction is to install package<strong>s</strong>, you can pass a vector of package names to install multiple packages at the same time:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1"></a><span class="fu">install.packages</span>(<span class="fu">c</span>(<span class="st">"tidyverse"</span>,<span class="st">"readxl"</span>,<span class="st">"haven"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Once a package is installed it doesn’t mean that you can use it, yet. You will need to <em>load</em> the package. To do this you need to use the <code>library(&lt;package_name&gt;)</code> command, for example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout-important callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>Some packages might use the same function names as other packages, for example <code>select</code> might do different things depending on which package you loaded last. As a rule of thumb, when you start RStudio afresh, make sure that you load the <code>tidyverse</code> package after you have loaded all your other packages. To read more about this problem see <a href="#sec-QANDA">Section&nbsp;11.1</a></p>
</div>
</div>
</section></section><section id="the-tidyverse" class="level2" data-number="2.7"><h2 data-number="2.7" class="anchored" data-anchor-id="the-tidyverse">
<span class="header-section-number">2.7</span> The tidyverse</h2>
<p>This course focuses on using the <em>tidyverse</em>; a free collection of programming <em>packages</em> that will allow you to write code that imports data, tidys it, transforms it into useful datasets, visualises findings, creates statistical models and communicates findings to others data using a standardised set of commands.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="chapters/images/data-science-workflow.png" class="img-fluid figure-img"></p>
<p></p><figcaption aria-hidden="true" class="figure-caption">Data science workflow - RStudio</figcaption><p></p>
</figure>
</div>
<p>For many people the tidyverse is the main reason that they use R. The tidyverse is used widely in government, academia, NGOs and industry, notable examples include the <a href="https://johnburnmurdoch.github.io/slides/r-ggplot/#/">Financial Times</a> and the <a href="https://bbc.github.io/rcookbook/">BBC</a>. Code in the tidyverse can be (relatively) easily understood by others and <em>you</em>, when you come back to a project after several months.</p>
<div class="cell">

</div>
<div class="cell" data-quiet="true">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1"></a><span class="co"># load the tidyverse packages</span></span>
<span id="cb78-2"><a href="#cb78-2"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb78-3"><a href="#cb78-3"></a></span>
<span id="cb78-4"><a href="#cb78-4"></a><span class="co"># download Covid data from website</span></span>
<span id="cb78-5"><a href="#cb78-5"></a>deaths <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"https://raw.githubusercontent.com/owid/covid-19-data/master/public/data/excess_mortality/excess_mortality.csv"</span>)</span>
<span id="cb78-6"><a href="#cb78-6"></a></span>
<span id="cb78-7"><a href="#cb78-7"></a>deaths <span class="ot">&lt;-</span> deaths <span class="sc">%&gt;%</span> </span>
<span id="cb78-8"><a href="#cb78-8"></a>     <span class="fu">filter</span>(location <span class="sc">%in%</span> </span>
<span id="cb78-9"><a href="#cb78-9"></a>              <span class="fu">c</span>(<span class="st">"United States"</span>, <span class="st">"United Kingdom"</span>, </span>
<span id="cb78-10"><a href="#cb78-10"></a>                <span class="st">"Sweden"</span>, <span class="st">"Germany"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb78-11"><a href="#cb78-11"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">as.Date</span>(date))</span>
<span id="cb78-12"><a href="#cb78-12"></a></span>
<span id="cb78-13"><a href="#cb78-13"></a><span class="fu">ggplot</span>(<span class="at">data=</span>deaths) <span class="sc">+</span></span>
<span id="cb78-14"><a href="#cb78-14"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> date, </span>
<span id="cb78-15"><a href="#cb78-15"></a>                <span class="at">y =</span> excess_per_million_proj_all_ages, </span>
<span id="cb78-16"><a href="#cb78-16"></a>                <span class="at">colour=</span>location)) <span class="sc">+</span></span>
<span id="cb78-17"><a href="#cb78-17"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"bottom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-41-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Try this out
</div>
</div>
<div class="callout-body-container callout-body">
<p>The code above transforms data and converts it into a graph. It doesn’t have any comments, but you should hopefully be able to understand what a lot of the code does by just reading it. Can you guess what each line does? Try running the code by selecting parts of it and pressing <code>control</code> | <code>command</code> and <code>Enter</code></p>
</div>
</div>
</section><section id="loading-data" class="level2" data-number="2.8"><h2 data-number="2.8" class="anchored" data-anchor-id="loading-data">
<span class="header-section-number">2.8</span> Loading data</h2>
<p>We can’t do much with R without loading data from elsewhere. Data will come in many formats and R should be able to deal with all of them. Some of the datasets you access will be a few rows and columns; others, like the ones we are going to use on this course, might run into hundreds of thousands or even millions of rows and hundreds or thousands of columns. Depending on the format you are using, you might need to use specific packages. A few of the data file types you might meet are described below:</p>
<table class="table">
<colgroup>
<col style="width: 27%">
<col style="width: 72%">
</colgroup>
<thead><tr class="header">
<th>File type</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Comma separated values [.csv]</td>
<td>As it says in the name, <code>.csv</code> files store data by separating data items with commas. They are a common way of transferring data and can be easily created and read by Excel, Google spreadsheets and text editors (in addition to R). CSVs aren’t compressed so will generally be larger than other file types. They don’t store information on the types of data stored in the file so you might find yourself having to specify that a date column is a date, rather than a string of text. You can read and write csv files without the need to load any packages, but if you do use <code>readr</code> you might find things go much faster.</td>
</tr>
<tr class="even">
<td>Excel [.xls | .xlsx | .xlsxm]</td>
<td>Excel files store data in a compressed custom format. This means files will generally be smaller than CSVs and will also contain information on the types of data stored in different columns. R can read and write these files using the <code>openxlsx</code> package, but you can also use the tidyverse’s <code>readxl</code> for reading, and <code>writexl</code> for writing for excel formats.</td>
</tr>
<tr class="odd">
<td>R Data [.rds]</td>
<td>R has it’s own data format, <code>.rds</code>. Saving to this format means that you will make perfect copies of your R data, including data types and factors. When you load rds files they will look exactly the same as when you saved them. Data can be highly compressed and it’s one of the fastest formats for getting data into R. You can read and write rds files without the need to load any packages, but using the functions in <code>readr</code> might speed things up a bit. You won’t be able to look at .rds files in other programs such as excel</td>
</tr>
<tr class="even">
<td>SPSS [.sav]</td>
<td>SPSS is a common analysis tool in the world of social science. The native format for SPSS data is <code>.sav</code>. These files are compressed and include information on column labels and column datatypes. You will need either the <code>haven</code> or <code>foreign</code> packages to read data into R. Once you have loaded the .sav you will probably want to convert the data into a format that is more suitable for R, normally this will involve converting columns into factors. We cover <em>factors</em> in more detail below.</td>
</tr>
<tr class="odd">
<td>Stata [.dta]</td>
<td>
<code>haven</code> or <code>foreign</code> packages to read data into R</td>
</tr>
<tr class="even">
<td>SAS [.sas]</td>
<td>
<code>haven</code> or <code>foreign</code> packages to read data into R</td>
</tr>
<tr class="odd">
<td>Structured Query Language [.sql]</td>
<td>a common format for data stored in large databases. Normally SQL code would be used to query these, you can use the tidyverse to help construct SQL this through the package <code>dbplyr</code> which will convert your tidyverse pipe code into SQL. R can be set up to communicate directly with databases using the <code>DBI</code> package.</td>
</tr>
<tr class="even">
<td>JSON</td>
<td>A popular format for sharing data on the web. You can use <code>jsonlite</code> and <code>rjson</code> to access this type of data</td>
</tr>
</tbody>
</table>
<p>For this course we will be looking at <code>.csv</code>, <code>excel</code> and <code>.rds</code> files.</p>
<section id="dataframes" class="level3" data-number="2.8.1"><h3 data-number="2.8.1" class="anchored" data-anchor-id="dataframes">
<span class="header-section-number">2.8.1</span> Dataframes</h3>
<p>Loading datasets into R will normally store them as <em>dataframes</em> (also known as <em>tibbles</em> when using the tidyverse). Dataframes are the equivalent of tables in a spreadsheet, with rows, columns and datatypes. First we need to get some data into R so we can start analysing them.</p>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Core to the <em>tidyverse</em> is the idea of <em>tidy data</em>, a rule of thumb for creating datasets that can be easily manipulated, modeled and presented. <em>Tidy data</em> are datasets where each variable is a column and each observation a row.</p>
<p>This data isn’t tidy data as each row has contains multiple exam results (observations):</p>
<table class="table">
<thead><tr class="header">
<th>ID</th>
<th>Exam 1</th>
<th>Grade 1</th>
<th>Exam 2</th>
<th>Grade 2</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>R2341</td>
<td>English</td>
<td>4</td>
<td>Maths</td>
<td>5</td>
</tr>
<tr class="even">
<td>R8842</td>
<td>English</td>
<td>5</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>This dataframe is tidy data as each student has one entry for each exam:</p>
<table class="table">
<thead><tr class="header">
<th>ID</th>
<th>Exam</th>
<th>Grade</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>R2341</td>
<td>English</td>
<td>4</td>
</tr>
<tr class="even">
<td>R2341</td>
<td>Maths</td>
<td>5</td>
</tr>
<tr class="odd">
<td>R8842</td>
<td>English</td>
<td>5</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">

</div>
<p>We can load large datatables into R by either providing the online web address, or by loading it from a local file directory on your hard drive. Both methods are covered below:</p>
</section><section id="loading-data-from-the-web" class="level3" data-number="2.8.2"><h3 data-number="2.8.2" class="anchored" data-anchor-id="loading-data-from-the-web">
<span class="header-section-number">2.8.2</span> Loading data from the web</h3>
<p>To download files from the web we need another package, <code>openxlsx</code>, which you need to <em>install</em> before you load it (see: <a href="#sec-packages">Section&nbsp;2.2.3</a>, or use line 1 below). The code shown will download the files from an online Google drive directly into objects in R using <code>read.xlsx(&lt;file_web_address&gt;, &lt;sheet_name&gt;)</code>:</p>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>To convert data on your google drive into a link that works in R, you can use the following website: <a href="https://sites.google.com/site/gdocs2direct/" class="uri">https://sites.google.com/site/gdocs2direct/</a>. Note that not all read/load commands in R will work with web addresses and some will require you have to copies of the datasets on your disk drive. Additionally, downloading large datasets from the web directly into R can be very slow, loading the dataset from your harddrive will nearly always be <em>much</em> faster.</p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1"></a><span class="fu">install.packages</span>(<span class="st">"openxlsx"</span>)</span>
<span id="cb79-2"><a href="#cb79-2"></a><span class="fu">library</span>(openxlsx)</span>
<span id="cb79-3"><a href="#cb79-3"></a></span>
<span id="cb79-4"><a href="#cb79-4"></a>results <span class="ot">&lt;-</span> <span class="fu">read.xlsx</span>(<span class="st">"https://drive.google.com/uc?export=download&amp;id=1tp9xe3dS__eg7RrXf0T_oMxcrz_TbMdM"</span>,</span>
<span id="cb79-5"><a href="#cb79-5"></a>                      <span class="at">sheet=</span><span class="st">"Results"</span>)</span>
<span id="cb79-6"><a href="#cb79-6"></a>schools <span class="ot">&lt;-</span> <span class="fu">read.xlsx</span>(<span class="st">"https://drive.google.com/uc?export=download&amp;id=1tp9xe3dS__eg7RrXf0T_oMxcrz_TbMdM"</span>,</span>
<span id="cb79-7"><a href="#cb79-7"></a>                      <span class="at">sheet=</span><span class="st">"Schools"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="loading-data-from-your-computer" class="level3" data-number="2.8.3"><h3 data-number="2.8.3" class="anchored" data-anchor-id="loading-data-from-your-computer">
<span class="header-section-number">2.8.3</span> Loading data from your computer</h3>
<p>Downloading files directly from web addresses can be slow and you might want to prefer to use files saved to your computer’s hard drive. You can do this by following the steps below:</p>
<p>Download the <code>PISA_student_2018.rds</code> file from <a href="https://drive.google.com/file/d/1tp9xe3dS__eg7RrXf0T_oMxcrz_TbMdM/view">here</a> and save it to your computer where your R code file is.</p>
<p>Copy the location of the file (see next step for help)</p>
<ul>
<li>
<p>To find the location of a file in <strong><em>Windows</em></strong> do the following:</p>
<ol type="1">
<li>
<p>Navigate to the location of the file in <em>Windows Explorer</em>:</p>
<p><img src="chapters/images/navigate_file_location.png" class="img-fluid"></p>
</li>
<li>
<p>Click on the address bar</p>
<p><img src="chapters/images/select_file_location.png" class="img-fluid"></p>
</li>
<li><p>Copy the location</p></li>
</ol>
</li>
<li>
<p>To find the location of a file in <strong><em>Mac OSX</em></strong> do the following:</p>
<ol type="1">
<li><p>Open <em>Finder</em></p></li>
<li><p>Navigate to the folder where you saved the Excel file</p></li>
<li>
<p>Right click on the folder where the file is stored and click to open the menu. Then press the option button and select <code>Copy &lt;name of file&gt; as Pathname</code></p>
<p><img src="chapters/images/mac_pathnames.jpg" class="img-fluid"></p>
</li>
<li><p>Alternatively, follow <a href="https://support.apple.com/en-gb/guide/mac-help/mchlp1774/mac">this</a></p></li>
</ol>
</li>
</ul>
<p>To load the data into R we need to use the <code>read_excel(&lt;file_location&gt;, &lt;sheet_name&gt;)</code> command, specifying the location and name of the file we are loading, and as we are reading an Excel file, we need to specify the sheet name within the Excel file. See the following code:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1"></a><span class="co"># load the basic tidyverse libraries and readxl</span></span>
<span id="cb80-2"><a href="#cb80-2"></a><span class="co"># readxl is for reading and writing Excel files </span></span>
<span id="cb80-3"><a href="#cb80-3"></a><span class="co"># and not loaded by the tidyverse by default</span></span>
<span id="cb80-4"><a href="#cb80-4"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb80-5"><a href="#cb80-5"></a><span class="fu">library</span>(readxl)</span>
<span id="cb80-6"><a href="#cb80-6"></a></span>
<span id="cb80-7"><a href="#cb80-7"></a><span class="co"># note that we need to add /dfe_data.xlsx to the end of the file location</span></span>
<span id="cb80-8"><a href="#cb80-8"></a>results <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"c:/Users/Peter/Google Drive/Kings/R intro/code/dfe_data.xlsx"</span>, <span class="st">"Results"</span>)</span>
<span id="cb80-9"><a href="#cb80-9"></a>schools <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"c:/Users/Peter/Google Drive/Kings/R intro/code/dfe_data.xlsx"</span>, <span class="st">"Schools"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="setting-working-directories" class="level3" data-number="2.8.4"><h3 data-number="2.8.4" class="anchored" data-anchor-id="setting-working-directories">
<span class="header-section-number">2.8.4</span> Setting working directories</h3>
<p>Using the <code>setwd(&lt;location&gt;)</code> you can specify where R will look by default for any datasets. In the example below, the <code>dfe_data.xlsx</code> will have been downloaded and stored in <code>C:/Users/Peter/code</code>. By running <code>setwd("C:/Users/Peter/code")</code> R will always look in that location when trying to load files, meaning that <code>read_excel("dfe_data.xlsx", "Results")</code> is actually the same as <code>read_excel("C:/Users/Peter/code/dfe_data.xlsx", "Results")</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1"></a><span class="co"># context: setup</span></span>
<span id="cb81-2"><a href="#cb81-2"></a></span>
<span id="cb81-3"><a href="#cb81-3"></a><span class="co"># load the basic tidyverse libraries and readxl</span></span>
<span id="cb81-4"><a href="#cb81-4"></a><span class="co"># readxl is for reading and writing Excel files </span></span>
<span id="cb81-5"><a href="#cb81-5"></a><span class="co"># and not loaded by the tidyverse by default</span></span>
<span id="cb81-6"><a href="#cb81-6"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb81-7"><a href="#cb81-7"></a><span class="fu">library</span>(readxl)</span>
<span id="cb81-8"><a href="#cb81-8"></a></span>
<span id="cb81-9"><a href="#cb81-9"></a><span class="co"># set the working directory to be where your data is stored</span></span>
<span id="cb81-10"><a href="#cb81-10"></a><span class="co"># note that you need to convert the backslashes \ in the address to forwardslashes /</span></span>
<span id="cb81-11"><a href="#cb81-11"></a><span class="fu">setwd</span>(<span class="st">"C:/Users/Peter/code"</span>)</span>
<span id="cb81-12"><a href="#cb81-12"></a></span>
<span id="cb81-13"><a href="#cb81-13"></a><span class="co"># then load the Results and Schools sheets from dfe_data.xlsx</span></span>
<span id="cb81-14"><a href="#cb81-14"></a>results <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"dfe_data.xlsx"</span>, <span class="st">"Results"</span>)</span>
<span id="cb81-15"><a href="#cb81-15"></a>schools <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"dfe_data.xlsx"</span>, <span class="st">"Schools"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To work out what your current working directory is, you can use <code><a href="https://rdrr.io/r/base/getwd.html">getwd()</a></code>.</p>
</section><section id="proper-addresses" class="level3" data-number="2.8.5"><h3 data-number="2.8.5" class="anchored" data-anchor-id="proper-addresses">
<span class="header-section-number">2.8.5</span> Proper addresses</h3>
<p>You might have found that you get an error if you don’t convert your backslashes <code>\</code> into forwardslashes <code>/</code>. It’s common mistake and very annoying. In most programming languages a backslash signifies the start of a special command, for example <code>\n</code> signifies a <code>newline</code>.</p>
<p>With R there are three ways to get around the problem of backslashes in file locations, for the location:<code>"C:\myfolder\"</code> we could:</p>
<ul>
<li>replace them with forwardslashes (as shown above):<code>"C:/myfolder/"</code>
</li>
<li>replace them with double backslashes (the special character specified by two backslashes is one backslash!):<code>"C:\\myfolder\\"</code>
</li>
<li>use the inbuilt R command to deal with filenames: <code>r"[C:\myfolder\]"</code>
</li>
</ul></section><section id="dealing-with-.rds-files" class="level3" data-number="2.8.6"><h3 data-number="2.8.6" class="anchored" data-anchor-id="dealing-with-.rds-files">
<span class="header-section-number">2.8.6</span> Dealing with .rds files</h3>
<p>For the majority of this workbook you will be using a cutdown version of the <code>PISA_2018</code> student table. This dataset is huge and we have loaded it into R, selected fields we think are useful, converted column types to work with R and saved in the standard R format. <code>.rds</code> files are quick to load and small in size. To load an <code>.rds</code> file you can use the <code>read_rds(&lt;location&gt;)</code> command from the tidyverse.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb82-2"><a href="#cb82-2"></a>PISA_2018 <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"&lt;yourfolder&gt;/pisa_student_2018.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If you want to save out any of your findings, you can use <code>write_rds(&lt;object&gt;, &lt;location&gt;, &lt;compression&gt;)</code>, where object is the table you are working on, location is where you want to save it, and compression is specifying whether you want to save space by making it smaller on your hard disk, but slower to load. Compression can be the value: “none” for no compression and “bz2” for compression.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb83-2"><a href="#cb83-2"></a>PISA_2018 <span class="ot">&lt;-</span> <span class="fu">write_rds</span>(PISA_2018 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(CNT<span class="sc">==</span><span class="st">"France"</span>),</span>
<span id="cb83-3"><a href="#cb83-3"></a>                      <span class="st">"&lt;yourfolder&gt;/pisa_france_2018.rds"</span>,</span>
<span id="cb83-4"><a href="#cb83-4"></a>                      <span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="exploring-data" class="level3" data-number="2.8.7"><h3 data-number="2.8.7" class="anchored" data-anchor-id="exploring-data">
<span class="header-section-number">2.8.7</span> Exploring data</h3>
<p>Now that we have loaded the <code>PISA_2018</code> dataset we can start to explore it.</p>
<p>You can check that the tables have loaded correctly by typing the object name and ‘<em>running</em>’ the line (<code>control</code>|<code>command</code> and <code>Enter</code>)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1"></a>PISA_2018</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 612,004 × 204
   CNT     OECD  ISCEDL   ISCEDD ISCEDO PROGN WVARS…¹ COBN_F COBN_M COBN_S GRADE
   &lt;fct&gt;   &lt;fct&gt; &lt;fct&gt;    &lt;fct&gt;  &lt;fct&gt;  &lt;fct&gt;   &lt;dbl&gt; &lt;fct&gt;  &lt;fct&gt;  &lt;fct&gt;  &lt;fct&gt;
 1 Albania No    ISCED l… C      Vocat… Alba…       3 Alban… Alban… Alban… 0    
 2 Albania No    ISCED l… C      Vocat… Alba…       3 Alban… Alban… Alban… 0    
 3 Albania No    ISCED l… C      Vocat… Alba…       3 Alban… Alban… Alban… 0    
 4 Albania No    ISCED l… C      Vocat… Alba…       3 Alban… Alban… Alban… 0    
 5 Albania No    ISCED l… C      Vocat… Alba…       3 Alban… Alban… Alban… 0    
 6 Albania No    ISCED l… C      Vocat… Alba…       3 Alban… Alban… Alban… 0    
 7 Albania No    ISCED l… C      Vocat… Alba…       3 Missi… Missi… Missi… 0    
 8 Albania No    ISCED l… C      Vocat… Alba…       3 Alban… Alban… Alban… 0    
 9 Albania No    ISCED l… C      Vocat… Alba…       3 Alban… Alban… Alban… 0    
10 Albania No    ISCED l… C      Vocat… Alba…       3 Missi… Missi… Missi… 0    
# … with 611,994 more rows, 193 more variables: SUBNATIO &lt;fct&gt;, STRATUM &lt;fct&gt;,
#   ESCS &lt;dbl&gt;, LANGN &lt;fct&gt;, LMINS &lt;fct&gt;, OCOD1 &lt;fct&gt;, OCOD2 &lt;fct&gt;,
#   REPEAT &lt;fct&gt;, CNTRYID &lt;fct&gt;, CNTSCHID &lt;dbl&gt;, CNTSTUID &lt;dbl&gt;, NatCen &lt;fct&gt;,
#   ADMINMODE &lt;fct&gt;, LANGTEST_QQQ &lt;fct&gt;, LANGTEST_COG &lt;fct&gt;, BOOKID &lt;fct&gt;,
#   ST001D01T &lt;fct&gt;, ST003D02T &lt;fct&gt;, ST003D03T &lt;fct&gt;, ST004D01T &lt;fct&gt;,
#   ST005Q01TA &lt;fct&gt;, ST007Q01TA &lt;fct&gt;, ST011Q01TA &lt;fct&gt;, ST011Q02TA &lt;fct&gt;,
#   ST011Q03TA &lt;fct&gt;, ST011Q04TA &lt;fct&gt;, ST011Q05TA &lt;fct&gt;, ST011Q06TA &lt;fct&gt;, …</code></pre>
</div>
</div>
<p>We can see from this that the <code>tibble</code> (another word for <em>dataframe</em>, basically a spreadsheet table) is 612004 rows, with 204 columns <a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a>. This is data for all the students from around the world that took part in PISA 2018. The actual PISA dataset has many more columns than this, but for the examples here we have selected 204 of the more interesting data variables. The column names might seem rather confusing and you might want to refer to the <a href="https://webfs.oecd.org/pisa2018/PISA2018_CODEBOOK.xlsx">PISA 2018 code book</a> to find out what everything means.</p>
<p>The data shown in the console window is only the top few rows and first few columns. To see the whole table click on the <code>Environment panel</code> and the table icon <img src="chapters/images/icon_table.png" class="img-fluid"> to explore each table:</p>
<p>TODO: insert images here</p>
<p>Alternatively, you can also hold down <code>command</code>|<code>control</code> and click on the table name in your R Script to view the table. You can also type <code>view(&lt;table_name&gt;)</code>.</p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>To learn more about loading data from in other formats, e.g.&nbsp;SPSS and STATA, look at the tidyverse documentation for <a href="https://haven.tidyverse.org/">haven</a>.</p>
</div>
</div>
<p>The <code>PISA_2018</code> dataframe is made up of multiple columns, with each column acting like a <em>vector</em>, which means each column stores values of only one datatype. If we look at the first four columns of the schools table, you can see the <code>CNTSTUID</code>, <code>ESCS</code> and <code>PV1MATH</code> columns are <code>&lt;dbl&gt;</code> (<code>numeric</code>) and the other three columns are of <code>&lt;fctr&gt;</code> (<code>factor</code>), a special datatype in R that helps store categorical and ordinal variables, see <a href="#sec-factors">Section&nbsp;2.9</a> for more information on how factors work.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 5
  CNTSTUID ST004D01T CNT       ESCS PV1MATH
     &lt;dbl&gt; &lt;fct&gt;     &lt;fct&gt;    &lt;dbl&gt;   &lt;dbl&gt;
1   800251 Male      Albania  0.675    490.
2   800402 Male      Albania -0.757    462.
3   801902 Female    Albania -2.51     407.
4   803546 Male      Albania -3.18     483.
5   804776 Male      Albania -1.76     460.</code></pre>
</div>
</div>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Vectors are data structures that bring together one or more data elements of the same datatype. E.g. we might have a numeric vector recording the grades of a class, or a character vector storing the gender of a set of students. To define a vector we use <code>c(item, item, ...)</code>, where <code>c</code> stands for combine. Vectors are very important to R, even declaring a single object, <code>x &lt;- 6</code>, is creating a vector of size one. To find out more about vectors see: <a href="#sec-vectors">Section&nbsp;2.5.1</a></p>
</div>
</div>
<p>We can find out some general information about the table we have loaded. <code>nrow</code> and <code>ncol</code> tell you about the dimensions of the table</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1"></a><span class="fu">nrow</span>(PISA_2018)  <span class="co"># how many rows are in the results table</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 612004</code></pre>
</div>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1"></a><span class="fu">ncol</span>(PISA_2018)  <span class="co"># how many columns are in the results table</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 204</code></pre>
</div>
</div>
<p>If we want to know the names of the columns we can use the <code><a href="https://rdrr.io/r/base/names.html">names()</a></code> command that returns a vector. This can be a little confusing as it’ll return the names used in the dataframe, which can be hard to interpret, e.g.&nbsp;<code>ST004D01T</code> is PISA’s way of encoding gender. You might find the labels in the view of the table available through <code>view(PISA_2018)</code> and the <em>Environment</em> panel easier to navigate:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1"></a><span class="fu">names</span>(PISA_2018) <span class="co"># the column names of a table</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "CNT"          "OECD"         "ISCEDL"       "ISCEDD"       "ISCEDO"      
 [6] "PROGN"        "WVARSTRR"     "COBN_F"       "COBN_M"       "COBN_S"      
[11] "GRADE"        "SUBNATIO"     "STRATUM"      "ESCS"         "LANGN"       
[16] "LMINS"        "OCOD1"        "OCOD2"        "REPEAT"       "CNTRYID"     
[21] "CNTSCHID"     "CNTSTUID"     "NatCen"       "ADMINMODE"    "LANGTEST_QQQ"
[26] "LANGTEST_COG" "BOOKID"       "ST001D01T"    "ST003D02T"    "ST003D03T"   
[31] "ST004D01T"    "ST005Q01TA"   "ST007Q01TA"   "ST011Q01TA"   "ST011Q02TA"  
[36] "ST011Q03TA"   "ST011Q04TA"   "ST011Q05TA"   "ST011Q06TA"   "ST011Q07TA"  
 [ reached getOption("max.print") -- omitted 164 entries ]</code></pre>
</div>
</div>
<p>As mentioned, the columns in the tables are very much like a collection of <em>vectors</em>, to access these columns we can put a <code>$</code> [dollar sign] after the name of a table. This allows us to see all the columns that table has, using the up and down arrows to select, press the <code>Tab</code> key to complete:</p>
<p><img src="chapters/images/dollar_fields.png" class="img-fluid"></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1"></a>PISA_2018<span class="sc">$</span>ST004D01T</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] Male   Male   Female Male   Male   Female Female Male   Female Female
[11] Female Female Female Female Male   Female Male   Male   Male   Male  
[21] Male   Male   Female Male   Male   Female Male   Female Male   Male  
[31] Female Female Female Female Female Male   Male   Male   Male   Female
 [ reached getOption("max.print") -- omitted 611964 entries ]
attr(,"label")
[1] Student (Standardized) Gender
Levels: Female Male Valid Skip Not Applicable Invalid No Response</code></pre>
</div>
</div>
<div class="cell">

</div>
<p>We can apply functions to the returned column/vector, for example: <code>sum</code>, <code>mean</code>, <code>median</code>, <code>max</code>, <code>min</code>, <code>sd</code>, <code>round</code>, <code>unique</code>, <code>summary</code>, <code>length</code>. To find all the different/unique values contained in a column we can write:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1"></a><span class="fu">unique</span>(PISA_2018<span class="sc">$</span>CNT) <span class="co"># the unique values in this column</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] Albania                United Arab Emirates   Argentina             
 [4] Australia              Austria                Belgium               
 [7] Bulgaria               Bosnia and Herzegovina Belarus               
[10] Brazil                 Brunei Darussalam      Canada                
[13] Switzerland            Chile                  Colombia              
[16] Costa Rica             Czech Republic         Germany               
[19] Denmark                Dominican Republic     Spain                 
[22] Estonia                Finland                France                
[25] United Kingdom         Georgia                Greece                
[28] Hong Kong              Croatia                Hungary               
[31] Indonesia              Ireland                Iceland               
[34] Israel                 Italy                  Jordan                
[37] Japan                  Kazakhstan             Korea                 
[40] Kosovo                
 [ reached getOption("max.print") -- omitted 40 entries ]
82 Levels: Albania United Arab Emirates Argentina Australia Austria ... Vietnam</code></pre>
</div>
</div>
<p>We can also combine commands, with <code>length(&lt;vector&gt;)</code> telling you how many items are in the <code>unique(PISA_2018$CNT)</code> command</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1"></a><span class="fu">length</span>(<span class="fu">unique</span>(PISA_2018<span class="sc">$</span>CNT)) <span class="co"># tells you the number of countries in PISA 2018</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 80</code></pre>
</div>
</div>
<p>You might meet errors when you try and run some of the commands because a field has missing data, recorded as <code>NA</code>. In the case below it doesn’t know what to do with the <code>NA</code> values in <code>PV1MATH</code>, so it gives up and returns <code>NA</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1"></a><span class="fu">max</span>(PISA_2018<span class="sc">$</span>ESCS) <span class="co"># max poverty value for all students</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] NA</code></pre>
</div>
</div>
<p>You can see the <code>NA</code>s by just loking at this column:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1"></a>PISA_2018<span class="sc">$</span>ESCS <span class="co"># NAs present in data</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1]  0.6747 -0.7566 -2.5112 -3.1843 -1.7557 -1.4855      NA -3.2481 -1.7174
[10]      NA -1.5617 -1.9952 -1.6790 -1.1337      NA      NA -1.0919 -1.2391
[19] -0.1641 -0.4510 -0.9622 -0.8303 -1.8772 -1.2963 -1.4784 -2.3759 -0.8440
[28] -1.2251      NA -2.4655 -1.2018 -0.4426 -1.4634 -2.1813 -1.9087 -1.7194
[37] -2.7486 -2.0457 -1.8321 -1.8647
 [ reached getOption("max.print") -- omitted 611964 entries ]
attr(,"label")
[1] "Index of economic, social and cultural status"</code></pre>
</div>
</div>
<p>To get around this you can tell R to remove/ignore the <code>NA</code> values when performing maths calculations:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1"></a><span class="fu">max</span>(PISA_2018<span class="sc">$</span>ESCS, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="co"># max maths grade for all students</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4.2051</code></pre>
</div>
</div>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>R’s inbuilt <code>mode</code> function doesn’t calculate the mathematical <em>mode</em>, instead it tells you what type of data you are dealing with. You can work out the mode of data by using the <code>modeest</code> package:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1"></a><span class="fu">library</span>(modeest)</span>
<span id="cb105-2"><a href="#cb105-2"></a><span class="fu">mlv</span>(PISA_2018<span class="sc">$</span>PV1MATH, <span class="at">method =</span> <span class="st">"mfv"</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 455.767</code></pre>
</div>
</div>
<p>there is more discussion on how to use modes in R <a href="https://stackoverflow.com/questions/2547402/how-to-find-the-statistical-mode">here</a></p>
</div>
</div>
<p>Calculations might also be upset when you try to perform maths on a column that is stored as another datatype. For example if you wanted to work out the mean common number of minutes spent learning the language that the PISA test was sat in, e.g.&nbsp;number of hours of weekly English lessons in England:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1"></a><span class="fu">mean</span>(PISA_2018<span class="sc">$</span>LMINS)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in mean.default(PISA_2018$LMINS): argument is not numeric or logical:
returning NA</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] NA</code></pre>
</div>
</div>
<p>Looking at the structure of this column, we can see it is stored as a <code>factor</code>, not as a <code>numeric</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1"></a><span class="fu">str</span>(PISA_2018<span class="sc">$</span>LMINS)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Factor w/ 336 levels "0","10","15",..: 38 81 38 38 150 66 NA NA 81 NA ...
 - attr(*, "label")= chr "Learning time (minutes per week) - &lt;test language&gt;"</code></pre>
</div>
</div>
<p>So we need to change the type of the column to make it work with the <code>mean</code> command, changing it to <code>as.numeric(&lt;column&gt;)</code> for the calculation, for more details on datatypes, see <a href="#sec-datatypes">Section&nbsp;2.5</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1"></a><span class="co"># this isn't ideal for proper analysis as you will need to remove all the "No Response" data</span></span>
<span id="cb112-2"><a href="#cb112-2"></a><span class="fu">mean</span>(<span class="fu">as.numeric</span>(PISA_2018<span class="sc">$</span>LMINS), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 91.22474</code></pre>
</div>
</div>
<div class="cell">

</div>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>To get a good overview of what a table contains, you can use the <code>str(&lt;table_name&gt;)</code> and <code>summary(&lt;table_name&gt;)</code> commands.</p>
</div>
</div>
</section></section><section id="sec-factors" class="level2" data-number="2.9"><h2 data-number="2.9" class="anchored" data-anchor-id="sec-factors">
<span class="header-section-number">2.9</span> Factors and statistical data types</h2>
<p>The types of variable will heavily influence what statistical analysis you can perform. R is there to help by assigning datatypes to each field. We have different sorts of data that can be stored:</p>
<!-- https://www150.statcan.gc.ca/n1/edu/power-pouvoir/ch8/5214817-eng.htm -->
<ul>
<li>
<strong>Categorical</strong> - data that can be divided into groups or categories
<ul>
<li>
<strong>Nominal</strong> - categorical data where the order isn’t important, e.g.&nbsp;gender, or colours</li>
<li>
<strong>Ordinal</strong> - categorical data that may have order or ranking, e.g.&nbsp;exam grades (A, B, C, D) or lickert scales (strongly agree, agree, disgaree, strongly disagree)</li>
</ul>
</li>
<li>
<strong>Numeric</strong> - data that consists of numbers
<ul>
<li>
<strong>Continuous</strong> - numeric data that can take any value within a given range, e.g.&nbsp;height (178cm, 134.54cm)</li>
<li>
<strong>Discrete</strong> - numeric data that can take only certain values within a range, e.g.&nbsp;number of children in a family (0,1,2,3,4,5)</li>
</ul>
</li>
</ul>
<p>R can support these by changing the datatype as we saw earlier to a numeric type:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1"></a>PISA_2018 <span class="sc">%&gt;%</span> </span>
<span id="cb114-2"><a href="#cb114-2"></a>  <span class="fu">summarise</span>(<span class="at">lmins_mean =</span> <span class="fu">mean</span>(<span class="fu">as.numeric</span>(LMINS), <span class="at">na.rm=</span><span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
  lmins_mean
       &lt;dbl&gt;
1       91.2</code></pre>
</div>
</div>
<p>But here we are going to look at how R handles <code>factors</code>. Factors have two parts, <code>levels</code> and <code>codes</code>. levels are what you see when you view a table column, codes are an underlying order to the data. Factors allow you to store data that has a known set of values taht you might want to display in an order other than alphabetical. For example, if we look at the month field <code>ST003D02T</code> using the <code>levels(&lt;field&gt;)</code> command:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1"></a><span class="fu">levels</span>(PISA_2018<span class="sc">$</span>ST003D02T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "January"        "February"       "March"          "April"         
 [5] "May"            "June"           "July"           "August"        
 [9] "September"      "October"        "November"       "December"      
[13] "Valid Skip"     "Not Applicable" "Invalid"        "No Response"   </code></pre>
</div>
</div>
<p>We can see that the months of the year are there along with other possible <code>levels</code>.</p>
<p><code>Codes</code> are the underlying numbers/order for each level, in this case <code>1 = January</code>, <code>2 = February</code>, etc.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1"></a><span class="fu">as.numeric</span>(PISA_2018<span class="sc">$</span>ST003D02T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1]  2  7  4  4  3  2  7  8  3  7 12  1 12  6  3 12  3  6  8 12  7  8  8  9 10
[26] 11  6  4  9  4  1  2  9  5 12  5  1  2 10  9
 [ reached getOption("max.print") -- omitted 611964 entries ]</code></pre>
</div>
</div>
<p>How can this be useful? A good example is how plots are made, they will use the <code>codes</code> to give an order to the display of columns, in the plot below, <code>February</code> (<code>2</code>) comes before <code>March</code> (<code>3</code>), even though there were more students born in <code>March</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1"></a>grph_data <span class="ot">&lt;-</span> PISA_2018 <span class="sc">%&gt;%</span> </span>
<span id="cb120-2"><a href="#cb120-2"></a>         <span class="fu">group_by</span>(ST003D02T) <span class="sc">%&gt;%</span> </span>
<span id="cb120-3"><a href="#cb120-3"></a>         <span class="fu">summarise</span>(<span class="at">n=</span><span class="fu">n</span>())</span>
<span id="cb120-4"><a href="#cb120-4"></a></span>
<span id="cb120-5"><a href="#cb120-5"></a><span class="fu">ggplot</span>(<span class="at">data=</span>grph_data, <span class="fu">aes</span>(<span class="at">x=</span>ST003D02T, <span class="at">y=</span>n)) <span class="sc">+</span> </span>
<span id="cb120-6"><a href="#cb120-6"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-67-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>To re-order the columns to match the number of students, we can either try to do this manually, which is rather cumbersome:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1"></a>my_levels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"July"</span>, <span class="st">"September"</span>, <span class="st">"January"</span>, <span class="st">"March"</span>, <span class="st">"February"</span>,<span class="st">"April"</span>, <span class="st">"May"</span>, <span class="st">"June"</span>, <span class="st">"August"</span>, <span class="st">"October"</span>, <span class="st">"November"</span>, <span class="st">"December"</span>, <span class="st">"Valid Skip"</span>, <span class="st">"Not Applicable"</span>, <span class="st">"Invalid"</span>, <span class="st">"No Response"</span>)</span>
<span id="cb121-2"><a href="#cb121-2"></a></span>
<span id="cb121-3"><a href="#cb121-3"></a>grph_data<span class="sc">$</span>ST003D02T <span class="ot">&lt;-</span> <span class="fu">factor</span>(grph_data<span class="sc">$</span>ST003D02T, <span class="at">levels=</span>my_levels)</span>
<span id="cb121-4"><a href="#cb121-4"></a></span>
<span id="cb121-5"><a href="#cb121-5"></a><span class="fu">ggplot</span>(<span class="at">data=</span>grph_data, <span class="fu">aes</span>(<span class="at">x=</span>ST003D02T, <span class="at">y=</span>n)) <span class="sc">+</span> </span>
<span id="cb121-6"><a href="#cb121-6"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-68-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Or get R to do this for us:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1"></a><span class="co"># get the levels in order and pull/create a vector of them</span></span>
<span id="cb122-2"><a href="#cb122-2"></a>my_levels <span class="ot">&lt;-</span> grph_data <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(n)) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(ST003D02T)</span>
<span id="cb122-3"><a href="#cb122-3"></a></span>
<span id="cb122-4"><a href="#cb122-4"></a><span class="co"># reassign the re-ordered levels to the dataframe column</span></span>
<span id="cb122-5"><a href="#cb122-5"></a>grph_data<span class="sc">$</span>ST003D02T <span class="ot">&lt;-</span> <span class="fu">factor</span>(grph_data<span class="sc">$</span>ST003D02T, <span class="at">levels=</span>my_levels)</span>
<span id="cb122-6"><a href="#cb122-6"></a></span>
<span id="cb122-7"><a href="#cb122-7"></a><span class="fu">ggplot</span>(<span class="at">data=</span>grph_data, <span class="fu">aes</span>(<span class="at">x=</span>ST003D02T, <span class="at">y=</span>n)) <span class="sc">+</span> </span>
<span id="cb122-8"><a href="#cb122-8"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-69-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>To learn a lot more about factors, see <a href="https://r4ds.had.co.nz/factors.html">Hadleys chapter</a></p>
</section><section id="piping" class="level2" data-number="2.10"><h2 data-number="2.10" class="anchored" data-anchor-id="piping">
<span class="header-section-number">2.10</span> Piping</h2>
<p>Piping allows us to break down complex tasks into manageable chunks that can be written and tested one after another. There are several powerful commands in the tidyverse as part of the <em>dplyr</em> package that can help us <code>group</code>, <code>filter</code>, <code>select</code>, <code>mutate</code> and <code>summarise</code> datasets. With this small set of commands we can use piping to convert massive datasets into simple and useful results.</p>
<p>Using the pipe <code>%&gt;%</code> command, we can feed the results from one command into the next command making for reusable and easy to read code.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="chapters/images/pipe_drawing.svg" class="img-fluid figure-img"></p>
<p></p><figcaption aria-hidden="true" class="figure-caption">how piping works</figcaption><p></p>
</figure>
</div>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The pipe command we are using <code>%&gt;%</code> is from the <em>magrittr</em> package which is installed alongside the tidyverse. Recently <em>R</em> introduced another pipe <code>|&gt;</code> which offers very similar functionality and tutorials online might use either. The examples below use the <code>%&gt;%</code> pipe.</p>
</div>
</div>
<p>Let’s look at an example of using the pipe on the <code>PISA_2018</code> table to calculate the best performing OECD countries for maths by gender:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1"></a>PISA_2018 <span class="sc">%&gt;%</span> </span>
<span id="cb123-2"><a href="#cb123-2"></a>  <span class="fu">filter</span>(OECD <span class="sc">==</span> <span class="st">"Yes"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb123-3"><a href="#cb123-3"></a>  <span class="fu">group_by</span>(CNT, ST004D01T) <span class="sc">%&gt;%</span> </span>
<span id="cb123-4"><a href="#cb123-4"></a>  <span class="fu">summarise</span>(<span class="at">mean_maths =</span> <span class="fu">mean</span>(PV1MATH, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb123-5"><a href="#cb123-5"></a>            <span class="at">sd_maths =</span> <span class="fu">sd</span>(PV1MATH, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb123-6"><a href="#cb123-6"></a>            <span class="at">students =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb123-7"><a href="#cb123-7"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(ST004D01T)) <span class="sc">%&gt;%</span></span>
<span id="cb123-8"><a href="#cb123-8"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(mean_maths))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'CNT'. You can override using the `.groups`
argument.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 74 × 5
# Groups:   CNT [37]
   CNT            ST004D01T mean_maths sd_maths students
   &lt;fct&gt;          &lt;fct&gt;          &lt;dbl&gt;    &lt;dbl&gt;    &lt;int&gt;
 1 Japan          Male            533.     90.5     2989
 2 Korea          Male            530.    102.      3459
 3 Estonia        Male            528.     85.0     2665
 4 Japan          Female          523.     82.2     3120
 5 Korea          Female          523.     96.0     3191
 6 Switzerland    Male            520.     92.7     3033
 7 Estonia        Female          519.     76.0     2651
 8 Czech Republic Male            518.     98.0     3501
 9 Belgium        Male            518.     95.9     4204
10 Poland         Male            517.     91.8     2768
# … with 64 more rows</code></pre>
</div>
</div>
<ul>
<li>line 1 passes the whole <code>PISA_2018</code> dataset and pipes it into the next line <code>%&gt;%</code>
</li>
<li>line 2 <code>filters</code> out any results that are from non-OECD countries by finding all the rows where <code>OECD</code> equals <code>==</code> “Yes”, this is then piped to the next line</li>
<li>line 3 groups the data by country <code>CNT</code> and by student gender <code>ST004D01T</code>, this is then piped to the next line</li>
<li>line 4-6 the <code>summarise</code> command performs a calculation on the country and gender groupings returning three new columns, each command on a new line and separated by a comma: the mean value for maths <code>mean_maths</code>, the standard deviation <code>sd_maths</code> and a column telling us how many students were in each grouping using the <code>n()</code> which returns the number of rows in a group. These new columns and the grouping columns are then piped to the next line</li>
<li>line 7 filters out any gender <code>ST004D01T</code> that is <code>NA</code>. First is finds all the students that have <code>NA</code> as their gender by using <code>is.na(ST004D01T)</code>, then is <em>NOTs</em>/flips the result using the exclamation mark <code>!</code>, giving those students who don’t have their gender set to <code>NA</code>. The filtered data is then piped to the next line</li>
<li>line 8, finally we <code>arrange</code> / sort the results in <code>desc</code>ending order by the <code>mean_maths</code> column. The default for arrange is <em>ascending</em> order, leave out the <code>desc(  )</code> for the numbers to be ordered in the opposite way.</li>
</ul>
<p>Males get a slightly better maths score than Females for this <code>PV1MATH</code> score, other scores are available, please read <a href="#sec-PV">Section&nbsp;10.5.1</a> to find out more about the limitations of using this value.</p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>we met the assignment command earlier <code>&lt;-</code>. Within the tidyverse commands we use the equals sign instead <code>=</code>.</p>
</div>
</div>
<p>The commands we have just used come from a package within the <code>tidyverse</code> called <code>dplyr</code>, let’s take a look at what they do:</p>
<table class="table">
<colgroup>
<col style="width: 33%">
<col style="width: 33%">
<col style="width: 33%">
</colgroup>
<thead><tr class="header">
<th>command</th>
<th>purpose</th>
<th>example</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>select</td>
<td>reduce the dataframe to the fields that you specify (and any other grouping fields you might be using)</td>
<td><code>select(&lt;field&gt;, &lt;field&gt;, &lt;field&gt;)</code></td>
</tr>
<tr class="even">
<td>filter</td>
<td>get rid of rows that don’t meet one or more comparisons</td>
<td><code>filter(&lt;field&gt; &lt;comparison&gt;)</code></td>
</tr>
<tr class="odd">
<td>group</td>
<td></td>
<td><code>group_by(&lt;field&gt;, &lt;field&gt;))</code></td>
</tr>
<tr class="even">
<td>mutate</td>
<td>add new fields or change current value in current fields</td>
<td><code>mutate(&lt;new_field&gt; = &lt;field&gt; / 2)</code></td>
</tr>
<tr class="odd">
<td>summarise</td>
<td></td>
<td><code>summarise(&lt;new_field&gt; = max(&lt;field&gt;))</code></td>
</tr>
<tr class="even">
<td>arrange</td>
<td></td>
<td><code>arrange(desc(&lt;field&gt;))</code></td>
</tr>
</tbody>
</table>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>If you want to explore more of the functions of <code>dplyr</code>, take a look at the <a href="https://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf">helpsheet</a></p>
</div>
</div>
<div class="question">
<p>Adjust the code above to find out the lowest performing countries for reading <code>PV1READ</code> by gender that are not in the OECD</p>
<div class="cell">
<details><summary>answer</summary><div class="sourceCode cell-code" id="cb126"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1"></a>PISA_2018 <span class="sc">%&gt;%</span> </span>
<span id="cb126-2"><a href="#cb126-2"></a>  <span class="fu">filter</span>(OECD <span class="sc">==</span> <span class="st">"No"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb126-3"><a href="#cb126-3"></a>  <span class="fu">group_by</span>(CNT, ST004D01T) <span class="sc">%&gt;%</span> </span>
<span id="cb126-4"><a href="#cb126-4"></a>  <span class="fu">summarise</span>(<span class="at">mean_read =</span> <span class="fu">mean</span>(PV1READ, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb126-5"><a href="#cb126-5"></a>            <span class="at">sd_read =</span> <span class="fu">sd</span>(PV1READ, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb126-6"><a href="#cb126-6"></a>            <span class="at">students =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb126-7"><a href="#cb126-7"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(ST004D01T)) <span class="sc">%&gt;%</span></span>
<span id="cb126-8"><a href="#cb126-8"></a>  <span class="fu">arrange</span>(mean_read)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<section id="select" class="level3" data-number="2.10.1"><h3 data-number="2.10.1" class="anchored" data-anchor-id="select">
<span class="header-section-number">2.10.1</span> select</h3>
<p>The <code>PISA_2018</code> dataset has far too many fields, to reduce the number of fields to focus on just a few of them we can use <code>select</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1"></a>PISA_2018 <span class="sc">%&gt;%</span> <span class="fu">select</span>(CNT,ESCS, ST004D01T, ST003D02T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 612,004 × 4
   CNT       ESCS ST004D01T ST003D02T
   &lt;fct&gt;    &lt;dbl&gt; &lt;fct&gt;     &lt;fct&gt;    
 1 Albania  0.675 Male      February 
 2 Albania -0.757 Male      July     
 3 Albania -2.51  Female    April    
 4 Albania -3.18  Male      April    
 5 Albania -1.76  Male      March    
 6 Albania -1.49  Female    February 
 7 Albania NA     Female    July     
 8 Albania -3.25  Male      August   
 9 Albania -1.72  Female    March    
10 Albania NA     Female    July     
# … with 611,994 more rows</code></pre>
</div>
</div>
<p>You might also be in the situation where you want to select everything but one or two fields, you can do this with the negative signal <code>-</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1"></a>PISA_2018 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>CNT, <span class="sc">-</span>OECD)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 612,004 × 202
   ISCEDL ISCEDD ISCEDO PROGN WVARS…¹ COBN_F COBN_M COBN_S GRADE SUBNA…² STRATUM
   &lt;fct&gt;  &lt;fct&gt;  &lt;fct&gt;  &lt;fct&gt;   &lt;dbl&gt; &lt;fct&gt;  &lt;fct&gt;  &lt;fct&gt;  &lt;fct&gt; &lt;fct&gt;   &lt;fct&gt;  
 1 ISCED… C      Vocat… Alba…       3 Alban… Alban… Alban… 0     Albania ALB - …
 2 ISCED… C      Vocat… Alba…       3 Alban… Alban… Alban… 0     Albania ALB - …
 3 ISCED… C      Vocat… Alba…       3 Alban… Alban… Alban… 0     Albania ALB - …
 4 ISCED… C      Vocat… Alba…       3 Alban… Alban… Alban… 0     Albania ALB - …
 5 ISCED… C      Vocat… Alba…       3 Alban… Alban… Alban… 0     Albania ALB - …
 6 ISCED… C      Vocat… Alba…       3 Alban… Alban… Alban… 0     Albania ALB - …
 7 ISCED… C      Vocat… Alba…       3 Missi… Missi… Missi… 0     Albania ALB - …
 8 ISCED… C      Vocat… Alba…       3 Alban… Alban… Alban… 0     Albania ALB - …
 9 ISCED… C      Vocat… Alba…       3 Alban… Alban… Alban… 0     Albania ALB - …
10 ISCED… C      Vocat… Alba…       3 Missi… Missi… Missi… 0     Albania ALB - …
# … with 611,994 more rows, 191 more variables: ESCS &lt;dbl&gt;, LANGN &lt;fct&gt;,
#   LMINS &lt;fct&gt;, OCOD1 &lt;fct&gt;, OCOD2 &lt;fct&gt;, REPEAT &lt;fct&gt;, CNTRYID &lt;fct&gt;,
#   CNTSCHID &lt;dbl&gt;, CNTSTUID &lt;dbl&gt;, NatCen &lt;fct&gt;, ADMINMODE &lt;fct&gt;,
#   LANGTEST_QQQ &lt;fct&gt;, LANGTEST_COG &lt;fct&gt;, BOOKID &lt;fct&gt;, ST001D01T &lt;fct&gt;,
#   ST003D02T &lt;fct&gt;, ST003D03T &lt;fct&gt;, ST004D01T &lt;fct&gt;, ST005Q01TA &lt;fct&gt;,
#   ST007Q01TA &lt;fct&gt;, ST011Q01TA &lt;fct&gt;, ST011Q02TA &lt;fct&gt;, ST011Q03TA &lt;fct&gt;,
#   ST011Q04TA &lt;fct&gt;, ST011Q05TA &lt;fct&gt;, ST011Q06TA &lt;fct&gt;, ST011Q07TA &lt;fct&gt;, …</code></pre>
</div>
</div>
<p>You might find that you have a vector of column names that you want to select, to do this, we can use the <code>any_of</code> command:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1"></a>my_fields <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"CNTSTUID"</span>, <span class="st">"CNTSCHID"</span>, <span class="st">"ST004D01T"</span>)</span>
<span id="cb131-2"><a href="#cb131-2"></a>PISA_2018 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">any_of</span>(my_fields))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 612,004 × 3
   CNTSTUID CNTSCHID ST004D01T
      &lt;dbl&gt;    &lt;dbl&gt; &lt;fct&gt;    
 1   800251   800002 Male     
 2   800402   800002 Male     
 3   801902   800002 Female   
 4   803546   800002 Male     
 5   804776   800002 Male     
 6   804825   800002 Female   
 7   804983   800002 Female   
 8   805287   800002 Male     
 9   805601   800002 Female   
10   806295   800002 Female   
# … with 611,994 more rows</code></pre>
</div>
</div>
<p>With hundreds of fields, you might want to focus on fields whose names match a certain pattern, to do this you can use <code>starts_with</code>, <code>ends_with</code>, <code>contains</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1"></a>PISA_2018 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">ends_with</span>(<span class="st">"NA"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 612,004 × 19
   ST011Q16NA ST012Q05NA ST012…¹ ST012…² ST125…³ ST060…⁴ ST061…⁵ IC009…⁶ IC009…⁷
   &lt;fct&gt;      &lt;fct&gt;      &lt;fct&gt;   &lt;fct&gt;   &lt;fct&gt;     &lt;dbl&gt; &lt;fct&gt;   &lt;fct&gt;   &lt;fct&gt;  
 1 Yes        &lt;NA&gt;       One     One     6 year…      31 45      Yes, a… No     
 2 Yes        Three or … One     None    4 years      37 45      No      Yes, b…
 3 No         One        None    None    4 years      NA 45      Yes, a… Yes, a…
 4 No         &lt;NA&gt;       None    One     1 year…      31 45      Yes, a… No     
 5 No         One        One     None    3 years      80 100     Yes, a… Yes, a…
 6 No         Three or … One     None    6 year…      24 25      Yes, a… Yes, a…
 7 &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;    &lt;NA&gt;    &lt;NA&gt;         NA &lt;NA&gt;    &lt;NA&gt;    &lt;NA&gt;   
 8 No         None       None    None    1 year…      NA 45      &lt;NA&gt;    &lt;NA&gt;   
 9 Yes        Three or … One     One     4 years      36 45      Yes, a… Yes, a…
10 &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;    &lt;NA&gt;    &lt;NA&gt;         NA &lt;NA&gt;    &lt;NA&gt;    &lt;NA&gt;   
# … with 611,994 more rows, 10 more variables: IC009Q07NA &lt;fct&gt;,
#   IC009Q10NA &lt;fct&gt;, IC009Q11NA &lt;fct&gt;, IC008Q07NA &lt;fct&gt;, IC008Q13NA &lt;fct&gt;,
#   IC010Q02NA &lt;fct&gt;, IC010Q05NA &lt;fct&gt;, IC010Q06NA &lt;fct&gt;, IC010Q09NA &lt;fct&gt;,
#   IC010Q10NA &lt;fct&gt;, and abbreviated variable names ¹​ST012Q06NA, ²​ST012Q09NA,
#   ³​ST125Q01NA, ⁴​ST060Q01NA, ⁵​ST061Q01NA, ⁶​IC009Q05NA, ⁷​IC009Q06NA</code></pre>
</div>
</div>
<div class="question">
<ol type="1">
<li>Spot the three errors with the following <code>select</code> statement</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1"></a>PISA_2018 </span>
<span id="cb135-2"><a href="#cb135-2"></a>  <span class="fu">select</span>(CNT BELONG) <span class="sc">%&gt;%</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<details><summary>answer</summary><div class="sourceCode cell-code" id="cb136"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1"></a>PISA_2018 <span class="sc">%&gt;%</span>  <span class="co">#1 missing pipe</span></span>
<span id="cb136-2"><a href="#cb136-2"></a>  <span class="fu">select</span>(CNT BELONG) <span class="co">#2 no comma between column names, #3 stray pipe on end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="2" type="1">
<li>Write a <code>select</code> statement to display the month and year of birth and the gender of each student.</li>
</ol>
<div class="cell">
<details><summary>answer</summary><div class="sourceCode cell-code" id="cb137"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1"></a>PISA_2018 <span class="sc">%&gt;%</span> </span>
<span id="cb137-2"><a href="#cb137-2"></a>  <span class="fu">select</span>(ST003D02T, ST003D03T, ST004D01T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="3" type="1">
<li>Write a <code>select</code> statement to show all the fields that are to do with digital skills, e.g.&nbsp;<code>IC150Q01HA</code>
</li>
</ol>
<div class="cell">
<details><summary>answer</summary><div class="sourceCode cell-code" id="cb138"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1"></a>PISA_2018 <span class="sc">%&gt;%</span> </span>
<span id="cb138-2"><a href="#cb138-2"></a>  <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"IC15"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="4" type="1">
<li>[EXTENSION] Adjust the answer to Q3 so that you select the gender and the ID of each student</li>
</ol>
<div class="cell">
<details><summary>answer</summary><div class="sourceCode cell-code" id="cb139"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1"></a>PISA_2018 <span class="sc">%&gt;%</span> </span>
<span id="cb139-2"><a href="#cb139-2"></a>  <span class="fu">select</span>(<span class="st">"CNTSTUID"</span>,<span class="st">"ST004D01T"</span>, <span class="fu">starts_with</span>(<span class="st">"IC15"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</section><section id="filter" class="level3" data-number="2.10.2"><h3 data-number="2.10.2" class="anchored" data-anchor-id="filter">
<span class="header-section-number">2.10.2</span> filter</h3>
<p>Not only does the <code>PISA_2018</code> dataset have a huge number of columns, it has hundred of thousands of rows. We want to <code>filter</code> this down to the students that we are interested in, i.e.&nbsp;filter out data that isn’t useful for our analysis. If we only wanted the results that were boys, we could do the following:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1"></a>PISA_2018 <span class="sc">%&gt;%</span> </span>
<span id="cb140-2"><a href="#cb140-2"></a>  <span class="fu">select</span>(CNT,ESCS, ST004D01T, ST003D02T, PV1MATH) <span class="sc">%&gt;%</span></span>
<span id="cb140-3"><a href="#cb140-3"></a>  <span class="fu">filter</span>(ST004D01T <span class="sc">==</span> <span class="st">"Male"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 307,044 × 5
   CNT       ESCS ST004D01T ST003D02T PV1MATH
   &lt;fct&gt;    &lt;dbl&gt; &lt;fct&gt;     &lt;fct&gt;       &lt;dbl&gt;
 1 Albania  0.675 Male      February     490.
 2 Albania -0.757 Male      July         462.
 3 Albania -3.18  Male      April        483.
 4 Albania -1.76  Male      March        460.
 5 Albania -3.25  Male      August       441.
 6 Albania NA     Male      March        280.
 7 Albania -1.09  Male      March        523.
 8 Albania -1.24  Male      June         314.
 9 Albania -0.164 Male      August       428.
10 Albania -0.451 Male      December     369.
# … with 307,034 more rows</code></pre>
</div>
</div>
<p>We can combine filter commands to look for <code>Males</code> born in <code>September</code> and where the <code>PV1MATH</code> figure is greater than <code>750</code>. We can list multiple criteria in the filter by separating the criteria with commas, using commas mean that all of these criteria need to be true for a row to be returned. A comma in a filter is the equivalent of an <code>AND</code>, :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1"></a>PISA_2018 <span class="sc">%&gt;%</span> </span>
<span id="cb142-2"><a href="#cb142-2"></a>  <span class="fu">select</span>(CNT,ESCS, ST004D01T, ST003D02T, PV1MATH) <span class="sc">%&gt;%</span></span>
<span id="cb142-3"><a href="#cb142-3"></a>  <span class="fu">filter</span>(ST004D01T <span class="sc">==</span> <span class="st">"Male"</span>,</span>
<span id="cb142-4"><a href="#cb142-4"></a>         ST003D02T <span class="sc">==</span> <span class="st">"September"</span>,</span>
<span id="cb142-5"><a href="#cb142-5"></a>         PV1MATH <span class="sc">&gt;</span> <span class="dv">750</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 56 × 5
   CNT                    ESCS ST004D01T ST003D02T PV1MATH
   &lt;fct&gt;                 &lt;dbl&gt; &lt;fct&gt;     &lt;fct&gt;       &lt;dbl&gt;
 1 United Arab Emirates  0.861 Male      September    760.
 2 Belgium               0.887 Male      September    751.
 3 Bulgaria             -0.160 Male      September    752.
 4 Canada                1.38  Male      September    751.
 5 Canada                1.16  Male      September    760.
 6 Canada                0.760 Male      September    770.
 7 Switzerland           0.814 Male      September    783.
 8 Germany               0.740 Male      September    762.
 9 Spain                 1.46  Male      September    787.
10 Estonia               0.897 Male      September    752.
# … with 46 more rows</code></pre>
</div>
</div>
<p>you can also write it as an ampersand <code>&amp;</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1"></a>PISA_2018 <span class="sc">%&gt;%</span> </span>
<span id="cb144-2"><a href="#cb144-2"></a>  <span class="fu">select</span>(CNT,ESCS, ST004D01T, ST003D02T, PV1MATH) <span class="sc">%&gt;%</span></span>
<span id="cb144-3"><a href="#cb144-3"></a>  <span class="fu">filter</span>(ST004D01T <span class="sc">==</span> <span class="st">"Male"</span> <span class="sc">&amp;</span></span>
<span id="cb144-4"><a href="#cb144-4"></a>         ST003D02T <span class="sc">==</span> <span class="st">"September"</span> <span class="sc">&amp;</span></span>
<span id="cb144-5"><a href="#cb144-5"></a>         PV1MATH <span class="sc">&gt;</span> <span class="dv">750</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout-important callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>Remember to include the <code>==</code> sign when looking to filter on equality; <code>!=</code>, <code>&gt;=</code>, <code>&lt;</code> etc also work.</p>
<p>Remember matching is case sensitive, “june” <code>!=</code> “June”</p>
</div>
</div>
<p>Rather than just looking at September born students, we want to find all the students born in the Autumn term. But if we add a couple more criteria on <code>ST003D02T</code> nothing is returned! The reason is R is looking for inidividual students born in September <code>AND</code> October <code>AND</code> November <code>AND</code> December. As a student can only have one birth month there are no students that meet this criteria. We need to use <code>OR</code> :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1"></a>PISA_2018 <span class="sc">%&gt;%</span> </span>
<span id="cb145-2"><a href="#cb145-2"></a>  <span class="fu">select</span>(CNT,ESCS, ST004D01T, ST003D02T, PV1MATH) <span class="sc">%&gt;%</span></span>
<span id="cb145-3"><a href="#cb145-3"></a>  <span class="fu">filter</span>(ST004D01T <span class="sc">==</span> <span class="st">"Male"</span>,</span>
<span id="cb145-4"><a href="#cb145-4"></a>         ST003D02T <span class="sc">==</span> <span class="st">"September"</span>,</span>
<span id="cb145-5"><a href="#cb145-5"></a>         ST003D02T <span class="sc">==</span> <span class="st">"October"</span>,</span>
<span id="cb145-6"><a href="#cb145-6"></a>         ST003D02T <span class="sc">==</span> <span class="st">"November"</span>,</span>
<span id="cb145-7"><a href="#cb145-7"></a>         ST003D02T <span class="sc">==</span> <span class="st">"December"</span>,</span>
<span id="cb145-8"><a href="#cb145-8"></a>         PV1MATH <span class="sc">&gt;</span> <span class="dv">750</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 0 × 5
# … with 5 variables: CNT &lt;fct&gt;, ESCS &lt;dbl&gt;, ST004D01T &lt;fct&gt;, ST003D02T &lt;fct&gt;,
#   PV1MATH &lt;dbl&gt;</code></pre>
</div>
</div>
<p>To create an <code>OR</code> in a filter we use the bar <code>|</code> command, the below looks for all students who are “Male” <code>AND</code> were born in “September” <code>OR</code> “October” <code>OR</code> “November” <code>OR</code> “December”, <code>AND</code> have a <code>PV1MATH</code> &gt; 750.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1"></a>PISA_2018 <span class="sc">%&gt;%</span> </span>
<span id="cb147-2"><a href="#cb147-2"></a>  <span class="fu">select</span>(CNT,ESCS, ST004D01T, ST003D02T, PV1MATH) <span class="sc">%&gt;%</span></span>
<span id="cb147-3"><a href="#cb147-3"></a>  <span class="fu">filter</span>(ST004D01T <span class="sc">==</span> <span class="st">"Male"</span>,</span>
<span id="cb147-4"><a href="#cb147-4"></a>         (ST003D02T <span class="sc">==</span> <span class="st">"September"</span> <span class="sc">|</span> ST003D02T <span class="sc">==</span> <span class="st">"October"</span> <span class="sc">|</span> ST003D02T <span class="sc">==</span> <span class="st">"November"</span> <span class="sc">|</span> ST003D02T <span class="sc">==</span> <span class="st">"December"</span>),</span>
<span id="cb147-5"><a href="#cb147-5"></a>         PV1MATH <span class="sc">&gt;</span> <span class="dv">750</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 175 × 5
   CNT                     ESCS ST004D01T ST003D02T PV1MATH
   &lt;fct&gt;                  &lt;dbl&gt; &lt;fct&gt;     &lt;fct&gt;       &lt;dbl&gt;
 1 Albania               0.539  Male      October      789.
 2 United Arab Emirates  0.861  Male      September    760.
 3 United Arab Emirates  0.813  Male      October      753.
 4 United Arab Emirates  0.953  Male      November     766.
 5 United Arab Emirates  0.930  Male      November     773.
 6 United Arab Emirates  1.44   Male      October      752.
 7 Australia             1.73   Male      December     756.
 8 Australia            -0.0537 Male      October      827.
 9 Australia             1.18   Male      November     758.
10 Australia             1.13   Male      October      757.
# … with 165 more rows</code></pre>
</div>
</div>
<p>It’s neater, maybe, to use the <code>%in%</code> command, which checks to see if the value in a column is present in a vector, this can mimic the <code>OR</code> command:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1"></a>PISA_2018 <span class="sc">%&gt;%</span> </span>
<span id="cb149-2"><a href="#cb149-2"></a>  <span class="fu">select</span>(CNT, ESCS, ST004D01T, ST003D02T, PV1MATH) <span class="sc">%&gt;%</span></span>
<span id="cb149-3"><a href="#cb149-3"></a>  <span class="fu">filter</span>(ST004D01T <span class="sc">==</span> <span class="st">"Male"</span>,</span>
<span id="cb149-4"><a href="#cb149-4"></a>         ST003D02T <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"September"</span>, <span class="st">"October"</span>, <span class="st">"November"</span>, <span class="st">"December"</span>),</span>
<span id="cb149-5"><a href="#cb149-5"></a>         PV1MATH <span class="sc">&gt;</span> <span class="dv">750</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="question">
<ol type="1">
<li>Spot the <strong>three</strong> errors with the following <code>select</code> statement</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1"></a>PISA_2018 <span class="sc">%&gt;%</span> </span>
<span id="cb150-2"><a href="#cb150-2"></a>  <span class="fu">select</span>(CNT) <span class="sc">%&gt;%</span></span>
<span id="cb150-3"><a href="#cb150-3"></a>  <span class="fu">filter</span>(CNT <span class="cf">in</span> <span class="fu">c</span>(<span class="st">"France"</span>, <span class="st">"belgium"</span>)</span>
<span id="cb150-4"><a href="#cb150-4"></a>         ESCS <span class="sc">&lt;</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<details><summary>answer</summary><div class="sourceCode cell-code" id="cb151"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1"></a>PISA_2018 <span class="sc">%&gt;%</span> </span>
<span id="cb151-2"><a href="#cb151-2"></a>  <span class="fu">select</span>(CNT, ESCS) <span class="sc">%&gt;%</span> <span class="co">#1 you have ESCS in the filter, it needs to be in the select as well</span></span>
<span id="cb151-3"><a href="#cb151-3"></a>  <span class="fu">filter</span>(CNT <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"France"</span>, <span class="st">"belgium"</span>), <span class="co">#2 Belgium needs a capital letter</span></span>
<span id="cb151-4"><a href="#cb151-4"></a>                                          <span class="co">#3 the %in% command needs percentages</span></span>
<span id="cb151-5"><a href="#cb151-5"></a>                                          <span class="co">#4 you need a comma (or &amp;) at the end of the line</span></span>
<span id="cb151-6"><a href="#cb151-6"></a>         ESCS <span class="sc">&lt;</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="2" type="1">
<li>Write a <code>filter</code> to create a dataframe for the number of <code>Female</code> students with reading <code>PV1READ</code> scores lower than 400 in the “United Kingdom”, store the result as <code>read_low_female</code>, repeat but for <code>Male</code> students and store as <code>read_low_male</code>. Use <code><a href="https://rdrr.io/r/base/nrow.html">nrow()</a></code> to work out if there are more males or females with a low reading score in the UK</li>
</ol>
<div class="cell">
<details><summary>answer</summary><div class="sourceCode cell-code" id="cb152"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1"></a>read_low_female <span class="ot">&lt;-</span> PISA_2018 <span class="sc">%&gt;%</span> </span>
<span id="cb152-2"><a href="#cb152-2"></a>  <span class="fu">filter</span>(CNT <span class="sc">==</span> <span class="st">"United Kingdom"</span>,</span>
<span id="cb152-3"><a href="#cb152-3"></a>         PV1READ <span class="sc">&lt;</span> <span class="dv">400</span>,</span>
<span id="cb152-4"><a href="#cb152-4"></a>         ST004D01T <span class="sc">==</span> <span class="st">"Female"</span>)</span>
<span id="cb152-5"><a href="#cb152-5"></a></span>
<span id="cb152-6"><a href="#cb152-6"></a>read_low_male <span class="ot">&lt;-</span> PISA_2018 <span class="sc">%&gt;%</span> </span>
<span id="cb152-7"><a href="#cb152-7"></a>  <span class="fu">filter</span>(CNT <span class="sc">==</span> <span class="st">"United Kingdom"</span>,</span>
<span id="cb152-8"><a href="#cb152-8"></a>         PV1READ <span class="sc">&lt;</span> <span class="dv">400</span>,</span>
<span id="cb152-9"><a href="#cb152-9"></a>         ST004D01T <span class="sc">==</span> <span class="st">"Male"</span>)</span>
<span id="cb152-10"><a href="#cb152-10"></a></span>
<span id="cb152-11"><a href="#cb152-11"></a><span class="fu">nrow</span>(read_low_female)</span>
<span id="cb152-12"><a href="#cb152-12"></a><span class="fu">nrow</span>(read_low_male)</span>
<span id="cb152-13"><a href="#cb152-13"></a></span>
<span id="cb152-14"><a href="#cb152-14"></a><span class="co"># You could also pipe the whole dataframe into nrow()</span></span>
<span id="cb152-15"><a href="#cb152-15"></a>PISA_2018 <span class="sc">%&gt;%</span> </span>
<span id="cb152-16"><a href="#cb152-16"></a>  <span class="fu">filter</span>(CNT <span class="sc">==</span> <span class="st">"United Kingdom"</span>,</span>
<span id="cb152-17"><a href="#cb152-17"></a>         PV1READ <span class="sc">&lt;</span> <span class="dv">400</span>,</span>
<span id="cb152-18"><a href="#cb152-18"></a>         ST004D01T <span class="sc">==</span> <span class="st">"Female"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb152-19"><a href="#cb152-19"></a>  <span class="fu">nrow</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="3" type="1">
<li>How many students in the United Kingdom had no television <code>ST012Q01TA</code> <em>OR</em> no connection to the internet <code>ST011Q06TA</code>.</li>
</ol>
<div class="cell">
<details><summary>answer</summary><div class="sourceCode cell-code" id="cb153"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1"></a>PISA_2018 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(CNT <span class="sc">==</span> <span class="st">"United Kingdom"</span>, </span>
<span id="cb153-2"><a href="#cb153-2"></a>                     ST011Q06TA <span class="sc">==</span> <span class="st">"No"</span> <span class="sc">|</span></span>
<span id="cb153-3"><a href="#cb153-3"></a>                     ST012Q01TA <span class="sc">==</span> <span class="st">"None"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="4" type="1">
<li>use of NA?</li>
</ol>
<div class="cell">
<details><summary>answer</summary><div class="sourceCode cell-code" id="cb154"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb154-1"><a href="#cb154-1"></a>PISA_2018 <span class="sc">%&gt;%</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</section><section id="group_by-and-summarise" class="level3" data-number="2.10.3"><h3 data-number="2.10.3" class="anchored" data-anchor-id="group_by-and-summarise">
<span class="header-section-number">2.10.3</span> group_by and summarise</h3>
<p>max, min, mean, mode na.rm = TRUE</p>
</section><section id="mutate" class="level3" data-number="2.10.4"><h3 data-number="2.10.4" class="anchored" data-anchor-id="mutate">
<span class="header-section-number">2.10.4</span> mutate</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb155"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb155-1"><a href="#cb155-1"></a>PISA_2018 <span class="sc">%&gt;%</span></span>
<span id="cb155-2"><a href="#cb155-2"></a>  <span class="fu">mutate</span>(<span class="at">PV1_total =</span> PV1MATH <span class="sc">+</span> PV1SCIE <span class="sc">+</span> PV1READ) <span class="sc">%&gt;%</span></span>
<span id="cb155-3"><a href="#cb155-3"></a>  <span class="fu">select</span>(CNT, ESCS, PV1_total) <span class="sc">%&gt;%</span></span>
<span id="cb155-4"><a href="#cb155-4"></a>  <span class="fu">mutate</span>(<span class="at">PV1_mean =</span> PV1_total<span class="sc">/</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 612,004 × 4
   CNT       ESCS PV1_total PV1_mean
   &lt;fct&gt;    &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
 1 Albania  0.675     1311.     437.
 2 Albania -0.757     1319.     440.
 3 Albania -2.51      1158.     386.
 4 Albania -3.18      1424.     475.
 5 Albania -1.76      1094.     365.
 6 Albania -1.49      1004.     335.
 7 Albania NA         1311.     437.
 8 Albania -3.25      1104.     368.
 9 Albania -1.72      1268.     423.
10 Albania NA         1213.     404.
# … with 611,994 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1"></a>PISA_2018 <span class="sc">%&gt;%</span></span>
<span id="cb157-2"><a href="#cb157-2"></a>  <span class="fu">mutate</span>(<span class="at">PV1READ_high =</span> <span class="fu">ifelse</span>(PV1READ <span class="sc">&gt;</span> <span class="dv">600</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb157-3"><a href="#cb157-3"></a>  <span class="fu">select</span>(CNT, ESCS, PV1READ, PV1READ_high)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 612,004 × 4
   CNT       ESCS PV1READ PV1READ_high
   &lt;fct&gt;    &lt;dbl&gt;   &lt;dbl&gt; &lt;lgl&gt;       
 1 Albania  0.675    376. FALSE       
 2 Albania -0.757    434. FALSE       
 3 Albania -2.51     359. FALSE       
 4 Albania -3.18     425. FALSE       
 5 Albania -1.76     306. FALSE       
 6 Albania -1.49     352. FALSE       
 7 Albania NA        413. FALSE       
 8 Albania -3.25     271. FALSE       
 9 Albania -1.72     373. FALSE       
10 Albania NA        412. FALSE       
# … with 611,994 more rows</code></pre>
</div>
</div>
<p>REPEAT - repeat a grade</p>
<p>paste ifelse</p>
</section><section id="arrange" class="level3" data-number="2.10.5"><h3 data-number="2.10.5" class="anchored" data-anchor-id="arrange">
<span class="header-section-number">2.10.5</span> arrange</h3>
</section><section id="unique-distinct" class="level3" data-number="2.10.6"><h3 data-number="2.10.6" class="anchored" data-anchor-id="unique-distinct">
<span class="header-section-number">2.10.6</span> unique / distinct</h3>
</section><section id="tasks" class="level3" data-number="2.10.7"><h3 data-number="2.10.7" class="anchored" data-anchor-id="tasks">
<span class="header-section-number">2.10.7</span> tasks</h3>
</section></section></section><section id="performance-of-different-groups-in-stem-education-sampling-and-comparisons" class="level1" data-number="3"><h1 data-number="3">
<span class="header-section-number">3</span> Performance of different groups in STEM education: Sampling and comparisons</h1>
<div class="cell">

</div>
<section id="sec-graphing" class="level2" data-number="3.1"><h2 data-number="3.1" class="anchored" data-anchor-id="sec-graphing">
<span class="header-section-number">3.1</span> Introduction to graphing in R</h2>
<p>The tidyverse includes the incredibly powerful <code>ggplot2</code> package. This package is pretty much the industry standard for making graphs for publication. <code>ggplot2</code> is built on the <em>grammar of graphics</em> where you build graphs by specifying underlying attributes and layering geometric objects on top of each other. In the diagram below you can see how a graph is built from <em>geometric objects</em> (the things that are plotted such as points and bars) a <em>scale</em>, and <em>plot annotations</em> (e.g.&nbsp;a key, title etc). You can then apply <em>faceting</em> to the graph to automatically split one graph into multiple plots, allowing you to easily compare different groupings.</p>
<div id="fig-anonymous-1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><a href="http://vita.had.co.nz/papers/layered-grammar.pdf"><img src="chapters/images/grammarofgraphics.svg" class="img-fluid figure-img"></a></p>
<p></p><figcaption aria-hidden="true" class="figure-caption">adapted from A Layered Grammar of Graphics, Wickham, 2010</figcaption><p></p>
</figure>
</div>
<p>The basic structure of <code>ggplot</code> code is to combine different graphing elements through the use of the <code>+</code> operator. To demonstrate this, let’s look at the relationship between the percentage of males in a school and the percentage of the school taking <code>computer science</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb159-1"><a href="#cb159-1"></a><span class="co"># wrangle our data</span></span>
<span id="cb159-2"><a href="#cb159-2"></a>graph_data <span class="ot">&lt;-</span> PISA_2018 <span class="sc">%&gt;%</span> </span>
<span id="cb159-3"><a href="#cb159-3"></a>  <span class="fu">filter</span>(CNT <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"France"</span>, <span class="st">"United Kingdom"</span>))</span>
<span id="cb159-4"><a href="#cb159-4"></a></span>
<span id="cb159-5"><a href="#cb159-5"></a><span class="co"># display a graph of the results</span></span>
<span id="cb159-6"><a href="#cb159-6"></a><span class="fu">ggplot</span>(<span class="at">data=</span>graph_data, </span>
<span id="cb159-7"><a href="#cb159-7"></a>       <span class="fu">aes</span>(<span class="at">x=</span>ESCS, <span class="at">y=</span>PV1MATH, <span class="at">colour=</span>ST004D01T)) <span class="sc">+</span></span>
<span id="cb159-8"><a href="#cb159-8"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb159-9"><a href="#cb159-9"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">'lm'</span>) <span class="sc">+</span></span>
<span id="cb159-10"><a href="#cb159-10"></a>  <span class="fu">facet_wrap</span>(. <span class="sc">~</span> CNT) <span class="sc">+</span></span>
<span id="cb159-11"><a href="#cb159-11"></a>  <span class="fu">ggtitle</span>(<span class="st">"Comparison of poverty and Maths result, by gender and country"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-95-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Hopefully you can work out what lines 1-3 do from the previous chapter, let’s focus on the <code>ggplot</code> commands:</p>
<ul>
<li>6-7 these lines set up the <code>ggplot</code> giving it the table object <code>graph_data</code> as its data input and setting up the aesthetics for the rest of the graph elements using columns from <code>graph_data</code>. The <code>aes(&lt;attribute&gt;, &lt;attribute&gt;, ...)</code> command allows us to specify aesthetic elements of the graph that will change dependent on the dataset we use. <code>x=ESCS</code> and <code>y=PV1MATH</code> define the x and y coordinates, defining <code>aes()</code> inside <code>ggplot()</code> means we will pass down these values to subsequent geometric objects so we don’t have to define these <code>x</code> and <code>y</code> axis items again and again.</li>
<li>8 using the data and <code>aes</code> values defined on lines 6-7, <code>geom_point</code> uses the <code>x</code> and <code>y</code> values defined on line 19 to draw a point for each school in our dataset. There are lots of different parameters we could give <code>geom_point</code> e.g.&nbsp;specifying size and shape, but here we are content with using the defaults.</li>
<li>9 we add another geometric object on top of the points, this time we add a line of best fit <code>geom_smooth</code>, again this geometric object uses the values specified on lines 6-7, and we define the <code>method</code> as <code>lm</code>, to calculate a <em>linear model</em> line of best fit.</li>
<li>10 next we use <code>facet_wrap(. ~ CNT)</code> to create a graph for each group of <code>CNT</code> in the dataset, i.e.&nbsp;a graph for each country defined on line 3.</li>
<li>11 finally we customise the title of the graph, <code>ggtitle</code>, ready for display.</li>
</ul></section><section id="geoms" class="level2" data-number="3.2"><h2 data-number="3.2" class="anchored" data-anchor-id="geoms">
<span class="header-section-number">3.2</span> Geoms</h2>
<p>There are about 40 different geometric objects in ggplot, allowing you to create almost any sort of graph. We will be exploring a few of them in detail, but if you want to explore others, please follow some of the links below:</p>
<ul>
<li>
<a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a> for creating bar charts and histograms</li>
<li>
<a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a> for plotting single points</li>
<li>
<a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a> for connecting points together and showing trends</li>
<li>
<a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a> for adding text labels to data points</li>
<li>
<a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a> for representing the range of data</li>
<li>
<a href="https://ggplot2.tidyverse.org/reference/geom_hex.html">geom_hex</a> for creating heat maps</li>
<li>
<a href="https://ggplot2.tidyverse.org/reference/geom_map.html">geom_map</a> for adding geographic maps</li>
<li>
<a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a> for adding lines of best fit</li>
</ul>
<section id="geom_point" class="level3" data-number="3.2.1"><h3 data-number="3.2.1" class="anchored" data-anchor-id="geom_point">
<span class="header-section-number">3.2.1</span> geom_point</h3>
<p>Rather unsurprisingly, <code>geom_point</code> allows us to plot a layer of <em>points</em> using x and y coordinates. The below example shows how we can specify within the <code>ggplot</code> function <code>data=school_plot_data</code>. We then define the <code>aes</code>thetic attributes of the graph, passing the x <code>x=NumberOfBoys</code> and y <code>y=NumberOfGirls</code> values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb160"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb160-1"><a href="#cb160-1"></a><span class="co"># to make things a little faster we are going to focus on open secondary schools</span></span>
<span id="cb160-2"><a href="#cb160-2"></a><span class="co"># plotting 40k+ data points can be slow</span></span>
<span id="cb160-3"><a href="#cb160-3"></a>school_plot_data <span class="ot">&lt;-</span> PISA_2018 <span class="sc">%&gt;%</span> </span>
<span id="cb160-4"><a href="#cb160-4"></a>  <span class="fu">group_by</span>(OECD, CNT) <span class="sc">%&gt;%</span></span>
<span id="cb160-5"><a href="#cb160-5"></a>  <span class="fu">summarise</span>(<span class="at">mean_maths =</span> <span class="fu">mean</span>(PV1MATH),</span>
<span id="cb160-6"><a href="#cb160-6"></a>            <span class="at">mean_read =</span> <span class="fu">mean</span>(PV1READ),</span>
<span id="cb160-7"><a href="#cb160-7"></a>            <span class="at">sz =</span> <span class="fu">n</span>())</span>
<span id="cb160-8"><a href="#cb160-8"></a></span>
<span id="cb160-9"><a href="#cb160-9"></a><span class="fu">ggplot</span>(<span class="at">data=</span>school_plot_data, </span>
<span id="cb160-10"><a href="#cb160-10"></a>       <span class="fu">aes</span>(<span class="at">x=</span>mean_maths, <span class="at">y=</span>mean_read)) <span class="sc">+</span></span>
<span id="cb160-11"><a href="#cb160-11"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">size=</span>sz, <span class="at">colour=</span>OECD), <span class="at">alpha =</span> <span class="fl">0.6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-96-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>TODO: describe the code above</p>
<div class="callout-important callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>Switching between the pipes and ggplot can get rather confusing. A very common mistake in using ggplot is to try and link together the <code>geom_</code> elements with a pipe command <code>%&gt;%</code> rather than the <code>+</code>.</p>
</div>
</div>
</section><section id="questions-4" class="level3" data-number="3.2.2"><h3 data-number="3.2.2" class="anchored" data-anchor-id="questions-4">
<span class="header-section-number">3.2.2</span> Questions</h3>
<div class="question">
<ol type="1">
<li>Spot the three errors in this graph code</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb161"><pre class="sourceCode numberSource r none number-lines code-with-copy"><code class="sourceCode r"><span id="cb161-1"><a href="#cb161-1"></a><span class="fu">ggplot</span>(<span class="at">adta=</span>diamonds, <span class="at">x=</span>depth, <span class="at">y=</span>price) <span class="sc">+</span></span>
<span id="cb161-2"><a href="#cb161-2"></a>  <span class="fu">geom_point</span>()</span>
<span id="cb161-3"><a href="#cb161-3"></a>  <span class="fu">ggtitle</span>(<span class="st">"diamond graph"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<details><summary>answer</summary><div class="sourceCode cell-code" id="cb162"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb162-1"><a href="#cb162-1"></a><span class="co"># 1-data not adta, 2-x and y need to be inside aes</span></span>
<span id="cb162-2"><a href="#cb162-2"></a><span class="fu">ggplot</span>(<span class="at">data=</span>diamonds, <span class="fu">aes</span>(<span class="at">x=</span>depth, <span class="at">y=</span>price)) <span class="sc">+</span></span>
<span id="cb162-3"><a href="#cb162-3"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="co">#3 missing +</span></span>
<span id="cb162-4"><a href="#cb162-4"></a>  <span class="fu">ggtitle</span>(<span class="st">"diamond graph"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="2" type="1">
<li>Using the <code>PISA_2018</code> dataset, plot a graph for students from Norway to help you work out whether there is a relationship between <em>poverty</em> <code>ESCS</code> and <em>maths grade</em> <code>PV1MATH</code>. Colour each point with the gender of the student. Give the graph sensible x and y labels (e.g.&nbsp;<code>xlab</code>).</li>
</ol>
<div class="cell">
<details><summary>answer</summary><div class="sourceCode cell-code" id="cb163"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb163-1"><a href="#cb163-1"></a>graph_data <span class="ot">&lt;-</span> PISA_2018 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(CNT <span class="sc">==</span> <span class="st">"Norway"</span>)</span>
<span id="cb163-2"><a href="#cb163-2"></a></span>
<span id="cb163-3"><a href="#cb163-3"></a><span class="fu">ggplot</span>(graph_data,</span>
<span id="cb163-4"><a href="#cb163-4"></a>       <span class="fu">aes</span>(<span class="at">x=</span>ESCS,</span>
<span id="cb163-5"><a href="#cb163-5"></a>           <span class="at">y=</span>PV1MATH)) <span class="sc">+</span></span>
<span id="cb163-6"><a href="#cb163-6"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">colour=</span>ST004D01T)) <span class="sc">+</span></span>
<span id="cb163-7"><a href="#cb163-7"></a>  <span class="fu">xlab</span>(<span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb163-8"><a href="#cb163-8"></a>  <span class="fu">ylab</span>(<span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-99-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<ol start="3" type="1">
<li>Using the <code>PISA_2018</code> dataset for each country <code>CNT</code>, create a graph to explore how the <code>median</code> of the sense of school belonging <code>BELONG</code> relates to the <code>median</code> of the disciplinary climate in the school <code>DISCLIMA</code>, adjust the colour of each point to reflect the <code>mean</code> wealth of students in each country <code>ESCS</code>.</li>
</ol>
<p><strong>HINT:</strong> You’ll need create a new dataframe with <code>summarise</code>d variables for <code>median_belong</code>, <code>median_discipline</code> and <code>mean_wealth</code>.</p>
<div class="cell">
<details><summary>answer dataframe</summary><div class="sourceCode cell-code" id="cb164"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb164-1"><a href="#cb164-1"></a>graph_data <span class="ot">&lt;-</span> PISA_2018 <span class="sc">%&gt;%</span></span>
<span id="cb164-2"><a href="#cb164-2"></a>  <span class="fu">group_by</span>(OECD, CNT) <span class="sc">%&gt;%</span></span>
<span id="cb164-3"><a href="#cb164-3"></a>  <span class="fu">summarise</span>(<span class="at">median_belong =</span> <span class="fu">median</span>(BELONG, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb164-4"><a href="#cb164-4"></a>            <span class="at">median_discipline =</span> <span class="fu">median</span>(DISCLIMA, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb164-5"><a href="#cb164-5"></a>            <span class="at">mean_wealth =</span> <span class="fu">mean</span>(ESCS, <span class="at">na.rm=</span><span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><strong>HINT:</strong> To make your colours stand out more, add <code>+ scale_color_gradientn(colours = rainbow(3))</code> to the end of your plot.</p>
<div class="cell">
<details><summary>answer graph</summary><div class="sourceCode cell-code" id="cb165"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb165-1"><a href="#cb165-1"></a><span class="co"># display a graph of the results</span></span>
<span id="cb165-2"><a href="#cb165-2"></a><span class="fu">ggplot</span>(<span class="at">data=</span>graph_data, </span>
<span id="cb165-3"><a href="#cb165-3"></a>       <span class="fu">aes</span>(<span class="at">x=</span>median_belong, </span>
<span id="cb165-4"><a href="#cb165-4"></a>           <span class="at">y=</span>median_discipline)) <span class="sc">+</span></span>
<span id="cb165-5"><a href="#cb165-5"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">colour =</span> mean_wealth)) <span class="sc">+</span> </span>
<span id="cb165-6"><a href="#cb165-6"></a>  <span class="fu">scale_color_gradientn</span>(<span class="at">colours =</span> <span class="fu">rainbow</span>(<span class="dv">3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-101-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
</section><section id="sec-ifelse" class="level3" data-number="3.2.3"><h3 data-number="3.2.3" class="anchored" data-anchor-id="sec-ifelse">
<span class="header-section-number">3.2.3</span> Recoding data (ifelse)</h3>
<p>Often we want to plot values in groupings that don’t yet exist, for example might want to give all schools over a certain size a different <em>colour</em> from others schools. To do this we need to look at how we can <em>recode</em> values. A common way to recode values is through an if statement:</p>
<blockquote class="blockquote">
<p><code>ifelse(&lt;statement(s)&gt;, &lt;value_if_true&gt;, &lt;value_if_false&gt;)</code></p>
</blockquote>
<p><code>ifelse</code> allow us to <em>recode</em> the data. In the example below, we are going to add a new column to the schools table (using <code>mutate</code>) noting whether a school is a <em>grammar</em> school or not. A school is a grammar school <em>if</em> it is not an <em>Independent</em> school <em>and</em> it is <em>selective</em> in its admissions policy, either of these two criteria being false will mean that the school is not a grammar school.</p>
<p>You can see how the above logic is is implemented in an R <code>ifelse</code> statement on lines 4-8.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb166"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb166-1"><a href="#cb166-1"></a>plot_data <span class="ot">&lt;-</span> schools <span class="sc">%&gt;%</span> </span>
<span id="cb166-2"><a href="#cb166-2"></a>  <span class="fu">filter</span>(Open<span class="sc">==</span><span class="st">"Open"</span>, </span>
<span id="cb166-3"><a href="#cb166-3"></a>         Phase<span class="sc">==</span><span class="st">"Secondary"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb166-4"><a href="#cb166-4"></a>  <span class="fu">mutate</span>(<span class="at">sch_type =</span> </span>
<span id="cb166-5"><a href="#cb166-5"></a>           <span class="fu">ifelse</span>(EstablishmentGroup <span class="sc">!=</span> <span class="st">"Independent schools"</span> <span class="sc">&amp;</span> </span>
<span id="cb166-6"><a href="#cb166-6"></a>                    AdmissionsPolicy<span class="sc">==</span><span class="st">"Selective"</span>,</span>
<span id="cb166-7"><a href="#cb166-7"></a>                  <span class="st">"GRAMMAR"</span>,</span>
<span id="cb166-8"><a href="#cb166-8"></a>                  <span class="st">"NOT GRAMMAR"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb166-9"><a href="#cb166-9"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(sch_type))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>4 uses mutate to create a new column in the schools table called <code>sch_type</code>, this will be given the value of the <code>ifelse</code> statement calculation for each line.</li>
<li>5 - 6 the <code>if</code> statement to be evaluated as either <code>true</code> or <code>false</code> has two parts, separated by the ampersand symbol <code>&amp;</code> instead of the word <em>and</em> (as we have seen above, <em>or</em> is implemented using a bar <code>|</code>).</li>
<li>7 “GRAMMAR” will be returned <code>if</code> the statements on line 5 and 6 are both <em>TRUE</em>
</li>
<li>8 “NOT GRAMMAR” will be returned if the combined statements on line 5 and 6 are <em>FALSE</em>, i.e.&nbsp;<em>else</em> the values on line 5 and 6 are true</li>
</ul>
<p>Additionally, on line 9 we arrange the results, which means you can explore the details of the 163 grammar schools using the Environment panel, how you use arrange also changes the order in which the points will be plotted, allowing you to plot the grammar schools on top of other school types to make them stand out.</p>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>It’s possible to nest our <code>ifelse</code> statements, for example we might want to give a little more information on the school type:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb167"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb167-1"><a href="#cb167-1"></a>plot_data <span class="ot">&lt;-</span> schools <span class="sc">%&gt;%</span> </span>
<span id="cb167-2"><a href="#cb167-2"></a>  <span class="fu">filter</span>(Open<span class="sc">==</span><span class="st">"Open"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb167-3"><a href="#cb167-3"></a>  <span class="fu">mutate</span>(<span class="at">sch_type =</span> </span>
<span id="cb167-4"><a href="#cb167-4"></a>           <span class="fu">ifelse</span>(<span class="fu">grepl</span>(<span class="st">"Special"</span>, EstablishmentGroup), <span class="st">"Special"</span>,</span>
<span id="cb167-5"><a href="#cb167-5"></a>                  <span class="fu">ifelse</span>(EstablishmentGroup <span class="sc">==</span> <span class="st">"Independent schools"</span>, <span class="st">"Independent"</span>,</span>
<span id="cb167-6"><a href="#cb167-6"></a>                         <span class="fu">ifelse</span>(AdmissionsPolicy<span class="sc">==</span><span class="st">"Selective"</span>, </span>
<span id="cb167-7"><a href="#cb167-7"></a>                                <span class="st">"Grammar"</span>, <span class="st">"Comprehensive"</span>))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<p>Now we have <em>recoded</em> the data to display whether a school is a grammar school or not, we can plot this dataset onto the graph:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb168"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb168-1"><a href="#cb168-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>plot_data) <span class="sc">+</span></span>
<span id="cb168-2"><a href="#cb168-2"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>Easting, <span class="at">y=</span>Northing, </span>
<span id="cb168-3"><a href="#cb168-3"></a>                 <span class="at">size =</span> NumberOfBoys<span class="sc">+</span>NumberOfGirls,</span>
<span id="cb168-4"><a href="#cb168-4"></a>                 <span class="at">colour=</span>sch_type),</span>
<span id="cb168-5"><a href="#cb168-5"></a>                 <span class="at">alpha=</span><span class="fl">0.4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>1 we pass the custom table <code>plot_data</code> to the ggplot command, this means this data will be available in subsequent <code>geom_</code>
</li>
<li>2 we define the <code>x</code> and <code>y</code> <code>aes</code>theic values here for the <code>geom_point</code>s, we could have done this on line one, but this shows that this can be done separately for each <code>geom_</code>
</li>
<li>3 <code>size</code> is also inside <code>aes()</code> and takes the <code>NumberOfBoys+NumberOfGirls</code> as a parameter, i.e.&nbsp;the population of the school will change the size of the points on the graph</li>
<li>4 <code>colour</code> is also inside <code>aes()</code> and takes the newly coded <code>sch_type</code> values, this means that grammar schools will be a different colour from non-grammar schools</li>
<li>5 to stop the schools blotting each other out, we set the <code>alpha</code> (transparency) of each point to <code>0.4</code>. This is done outside the <code>aes</code> as we want all points to have the same transparency.</li>
</ul>
<div class="callout-important callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>If you define the <code>colour</code>, <code>size</code> and <code>alpha</code> attributes <em>outside</em> the <code>aes()</code> function, you will hard code the values and they won’t change when your dataset changes. Placing these attributes inside <code>aes</code> allows them to be dynamically changed by your dataset values</p>
</div>
</div>
</section><section id="questions-5" class="level3" data-number="3.2.4"><h3 data-number="3.2.4" class="anchored" data-anchor-id="questions-5">
<span class="header-section-number">3.2.4</span> Questions</h3>
<div class="question">
<ol type="1">
<li>Using the TIMSS dataset, and only using schools from England, Finland and USA, plot to see how the <em>number of computers</em> <code>BCBG07</code> is related to the <em>Instruction Affected Resource Shortage (Mathematics)</em> <code>BCBGMRS</code>. <code>colour</code> the points in using the country <code>CNTRY</code>.</li>
</ol>
<div class="cell">

</div>
<ol start="2" type="1">
<li>Using <code>ifelse</code>, add a column to TIMSS called <code>region</code>, recode “NOR”, “SWE” and “FIN” to be “Nordic” and everyone else “RestOfWorld”.</li>
</ol>
<div class="cell">

</div>
<ol start="3" type="1">
<li>Using the dataset from Q2, Count the number of schools in each of the two regions and the median number of taught hours <code>BCDGTIHY</code>.</li>
</ol>
<div class="cell">

</div>
<ol start="4" type="1">
<li>Using the data from Q2 (take a look at the <a href="chapters/CRESTEMR-answers.html#sec-ifelse-questions">answers</a> if you couldn’t work it out), plot a graph of:
<ul>
<li>school’s teaching time per year <code>BCDGTIHY</code> against the behavioural issues that they have <code>BCBGDAS</code>.</li>
<li>
<code>colour</code> the points to show the difference between “Nordic” and “RestOfWorld” schools.</li>
<li>Provide sensible labels for the <code>x</code> and <code>y</code> axis</li>
<li>change the <code>alpha</code> of each point so schools don’t blot each other out</li>
<li>add a line of best fit to see how the two axis are related</li>
</ul>
</li>
</ol>
<div class="cell">

</div>
</div>
</section><section id="geom_bar" class="level3" data-number="3.2.5"><h3 data-number="3.2.5" class="anchored" data-anchor-id="geom_bar">
<span class="header-section-number">3.2.5</span> geom_bar</h3>
<p>The <code>geom_bar</code> function is versatile, allowing the creation of bar, multiple bar, stacked bar charts and histograms. This first example shows how we can use bar charts to represent the quality ratings given by the Office of Standards in Education (Ofsted) to schools in different parts of the country:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb169"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb169-1"><a href="#cb169-1"></a>plot_schools <span class="ot">&lt;-</span> schools <span class="sc">%&gt;%</span> </span>
<span id="cb169-2"><a href="#cb169-2"></a>  <span class="fu">filter</span>(Open <span class="sc">==</span> <span class="st">"Open"</span>,</span>
<span id="cb169-3"><a href="#cb169-3"></a>         Region <span class="sc">!=</span> <span class="st">"Not Applicable"</span>,</span>
<span id="cb169-4"><a href="#cb169-4"></a>         OfstedRating <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Outstanding"</span>, <span class="st">"Good"</span>, <span class="st">"Requires improvement"</span>, <span class="st">"Inadequate"</span>))</span>
<span id="cb169-5"><a href="#cb169-5"></a></span>
<span id="cb169-6"><a href="#cb169-6"></a><span class="fu">ggplot</span>(<span class="at">data =</span> plot_schools, </span>
<span id="cb169-7"><a href="#cb169-7"></a>       <span class="fu">aes</span>(<span class="at">x=</span>Region)) <span class="sc">+</span> </span>
<span id="cb169-8"><a href="#cb169-8"></a>  <span class="fu">geom_bar</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<!--the `is.na(OfstedRating)` command selects only those rows from _OfstedRating_ that have an `NA` value. By putting the `!` mark in front of this we `NOT` or reverse the result. In this case `!is.na(OfstedRating)` returns all the rows that don't contain `NA` in OfstedRating.-->
<ul>
<li>1 to 3 gets the schools dataset and filters it to only include schools that are <em>Open</em>, which are in recognised <em>Region</em>.</li>
<li>4 filters only those rows containing the <em>OfstedRating</em> listed, removing any <code>NA</code> or other values.</li>
<li>6 to 7 we pass the <code>plot_schools</code> dataset created on lines 1 to 4 to ggplot and set the <code>x</code> axis to the be the <em>Region</em>. Note, we don’t set the <code>y</code> axis, as geom_bar will calculate this for us</li>
<li>8 we pass the <code>plot_schools</code> and <code>x=Region</code> to <code>geom_bar</code>, which counts the number of rows (schools) in each Region and creates a bar of that height.</li>
</ul>
<p>The graph above gives us a feel for the data, but it doesn’t tell us the Ofsted ratings for each Region and the a axis labels are a mess. We need to add a <code>fill</code> to the <code>geom_bar</code> and adjust the <code>theme</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb170"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb170-1"><a href="#cb170-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> plot_schools, </span>
<span id="cb170-2"><a href="#cb170-2"></a>       <span class="fu">aes</span>(<span class="at">x=</span>Region)) <span class="sc">+</span> </span>
<span id="cb170-3"><a href="#cb170-3"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">fill=</span>OfstedRating)) <span class="sc">+</span> </span>
<span id="cb170-4"><a href="#cb170-4"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>, <span class="at">hjust=</span><span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>3 using the <code>fill</code> attribute <code>aes(fill=OfstedRating)</code> will create a stacked and coloured bar to show the number of schools gaining each <em>OftstedRating</em> in each <em>Region</em>
</li>
<li>4 the <code>theme</code> function and <code>axis.text.x</code> adjust the x axis labels, rotating them 90 degrees</li>
</ul>
<p>We can now make rough comparisons between the different number of each Ofsted rating. But it remains hard to compare the percentage split. For example the number of <em>Good</em> and <em>Outstanding</em> schools in London is hard to compare with the North East, as the total number of schools in the North East is much smaller than the number of schools in London. Additionally, the order of the bars seems random, we want to have <em>Outstanding</em> at the top and <em>Inadequate</em> at the bottom, not next to each other:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb171"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb171-1"><a href="#cb171-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> plot_schools, </span>
<span id="cb171-2"><a href="#cb171-2"></a>       <span class="fu">aes</span>(<span class="at">x=</span>Region)) <span class="sc">+</span> </span>
<span id="cb171-3"><a href="#cb171-3"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">fill=</span><span class="fu">factor</span>(OfstedRating, </span>
<span id="cb171-4"><a href="#cb171-4"></a>                           <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Outstanding"</span>, <span class="st">"Good"</span>, <span class="st">"Requires improvement"</span>, <span class="st">"Inadequate"</span>))),</span>
<span id="cb171-5"><a href="#cb171-5"></a>           <span class="at">position=</span><span class="st">"fill"</span>) <span class="sc">+</span> </span>
<span id="cb171-6"><a href="#cb171-6"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>, <span class="at">hjust=</span><span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb171-7"><a href="#cb171-7"></a>  <span class="fu">scale_fill_discrete</span>(<span class="at">name =</span> <span class="st">"Ofsted Ratings"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>3 to 4 converts <em>OfstedRating</em> from the <em>character</em> datatype to a <em>factor</em>. Factors allow us to categorise the data we store, limiting the number of values a column can hold, in this case we are limiting it to the <em>levels</em> specified, with the order given to levels specifying the order that this column’s data will be displayed in graphs.</li>
<li>5 <code>position</code> tells ggplot what to do when a bar on the x axis is made up of multiple elements, in this case <code>position="fill"</code> will take each x axis bar grouping and work out the fractional value of each Ofsted rating for each Region.</li>
<li>7 when we created the factor on lines 3-4 to pass to the fill command, it also created a really inconvenient title for the graph legend: <em>factor(OfstedRating, levels = c(“Outstanding”, “Good”, “Requires improvement”, “Inadequate”))</em>. <code>scale_fill_discrete</code> let’s us provide a more sensible title for the key.</li>
</ul>
<p>We might also want to look at this graph on a Region by Region basis, at the moment it’s very hard to tell if the East Midlands have more schools that are <em>Outstanding</em>, or more schools that <em>Require improvement</em>. To do compare the bars in each x axis group we can use the position command, setting it to <code>position="dodge"</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb172"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb172-1"><a href="#cb172-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> plot_schools, </span>
<span id="cb172-2"><a href="#cb172-2"></a>       <span class="fu">aes</span>(<span class="at">x=</span>Region)) <span class="sc">+</span> </span>
<span id="cb172-3"><a href="#cb172-3"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">fill=</span><span class="fu">factor</span>(OfstedRating, </span>
<span id="cb172-4"><a href="#cb172-4"></a>                           <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Outstanding"</span>, <span class="st">"Good"</span>, <span class="st">"Requires improvement"</span>, <span class="st">"Inadequate"</span>))),</span>
<span id="cb172-5"><a href="#cb172-5"></a>           <span class="at">position=</span><span class="st">"dodge"</span>) <span class="sc">+</span> </span>
<span id="cb172-6"><a href="#cb172-6"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>, <span class="at">hjust=</span><span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb172-7"><a href="#cb172-7"></a>  <span class="fu">scale_fill_discrete</span>(<span class="at">name =</span> <span class="st">"Ofsted Ratings"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="raising-the-bars-yourself" class="level4" data-number="3.2.5.1"><h4 data-number="3.2.5.1" class="anchored" data-anchor-id="raising-the-bars-yourself">
<span class="header-section-number">3.2.5.1</span> Raising the bars yourself</h4>
<p><code>ggplot</code> can do a lot of the hard work when putting together bar charts, but there might also be times when you want to use pipes to calculate summary values that you then want plot. That is, you want to specify the heights of the bars yourself. To do this we <em>will</em> specify the y axis in the <code>aes</code> and use <code>stat="indentity"</code> to tell ggplot that’s what we’re doing. Take the example where you want to find the overall percentages of each grade given to the <em>four</em> single sciences in one year (can we say one is harder than another?):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb173"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb173-1"><a href="#cb173-1"></a>plot_data <span class="ot">&lt;-</span> results <span class="sc">%&gt;%</span></span>
<span id="cb173-2"><a href="#cb173-2"></a>  <span class="fu">filter</span>(Description <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Physics"</span>, <span class="st">"Biology"</span>, <span class="st">"Chemistry"</span>, <span class="st">"Computer Studies/Computing"</span>),</span>
<span id="cb173-3"><a href="#cb173-3"></a>         Qualification <span class="sc">==</span> <span class="st">"GCSE (9-1) Full Course"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb173-4"><a href="#cb173-4"></a>  <span class="fu">group_by</span>(Description, Grade) <span class="sc">%&gt;%</span></span>
<span id="cb173-5"><a href="#cb173-5"></a>  <span class="fu">summarise</span>(<span class="at">total_grade =</span> <span class="fu">sum</span>(Entries, <span class="at">na.rm=</span><span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb173-6"><a href="#cb173-6"></a>  <span class="fu">mutate</span>(<span class="at">total_entries =</span> <span class="fu">max</span>(total_grade, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb173-7"><a href="#cb173-7"></a>         <span class="at">per_entries =</span> total_grade<span class="sc">/</span>total_entries) <span class="sc">%&gt;%</span></span>
<span id="cb173-8"><a href="#cb173-8"></a>  <span class="fu">filter</span>(Grade <span class="sc">!=</span> <span class="st">"Total number entered"</span>)</span>
<span id="cb173-9"><a href="#cb173-9"></a></span>
<span id="cb173-10"><a href="#cb173-10"></a><span class="fu">ggplot</span>(<span class="at">data=</span>plot_data, <span class="fu">aes</span>(<span class="at">x=</span>Grade, <span class="at">y=</span>per_entries)) <span class="sc">+</span></span>
<span id="cb173-11"><a href="#cb173-11"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">fill=</span>Description), </span>
<span id="cb173-12"><a href="#cb173-12"></a>           <span class="at">position=</span><span class="st">"dodge"</span>,</span>
<span id="cb173-13"><a href="#cb173-13"></a>           <span class="at">stat=</span><span class="st">"identity"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>1 to 8 creates a dataframe <code>plot_data</code> that calculates the percentage of entries for each science subject achieving each grade, this is called <code>per_entries</code>
</li>
<li>10 as we are setting the heights of the bars ourselves, we need to give the ggplot aes command a y value, in this case <code>y=per_entries</code>
</li>
<li>11 the geom_bar is given a fill value of <code>Description</code>, this will allow us to see the plots of different subjects</li>
<li>12 we use <code>position="dodge"</code> as we want the perctange grades of each subject to be next to each other so we can look for differences in heights</li>
<li>13 <code>stat="identity"</code> tells <code>geom_bar</code> that you have defined your own bar heights in the <code>y</code> attribute and not to count the number of rows.</li>
</ul></section></section><section id="questions-6" class="level3" data-number="3.2.6"><h3 data-number="3.2.6" class="anchored" data-anchor-id="questions-6">
<span class="header-section-number">3.2.6</span> Questions</h3>
<div class="question">
<ol type="1">
<li>Can you spot the 4 errors in this code.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb174"><pre class="sourceCode numberSource r none number-lines code-with-copy"><code class="sourceCode r"><span id="cb174-1"><a href="#cb174-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>schools <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Phase <span class="sc">==</span> <span class="st">"Secondary"</span>), </span>
<span id="cb174-2"><a href="#cb174-2"></a>       <span class="at">x=</span>Region <span class="sc">+</span></span>
<span id="cb174-3"><a href="#cb174-3"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">fill=</span>Gender) <span class="at">position=</span><span class="st">"full"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">

</div>
<ol start="2" type="1">
<li>Create a bar chart showing the total number of open Independent schools for each Gender</li>
</ol>
<div class="cell">

</div>
<ol start="3" type="1">
<li>Using the TIMSS dataset:
<ul>
<li>
<code>filter</code> to only look at the USA and ENG</li>
<li>make a graph to show the overall picture of <em>Parental expectations for student achievement</em> (<code>BCBG14G</code>).</li>
<li>Make the <code>x</code> axis a <code>factor</code> so the graph makes sense</li>
<li>
<code>fill</code> the bars in to show how many schools each bar came from each country</li>
<li>
<code>position</code> bars so they aren’t stacked on top of each other</li>
</ul>
</li>
</ol>
<div class="cell">

</div>
<ol start="4" type="1">
<li>Repeat Q3, but this time work out the percentage of responses for each option in <code>BCBG14G</code> by country. Display a graph showing this “indentity”.</li>
</ol>
<div class="cell">

</div>
<ol start="5" type="1">
<li>[Extension] Explore other patterns in: “Teachers’ ability to inspire students” <code>BCBG14D</code> and “Parental expectations for student achievement” <code>BCBG14G</code>
</li>
</ol>
</div>
</section><section id="geom_text" class="level3" data-number="3.2.7"><h3 data-number="3.2.7" class="anchored" data-anchor-id="geom_text">
<span class="header-section-number">3.2.7</span> geom_text</h3>
<p>TODO: if time</p>
</section></section><section id="faceting" class="level2" data-number="3.3"><h2 data-number="3.3" class="anchored" data-anchor-id="faceting">
<span class="header-section-number">3.3</span> Faceting</h2>
<p>Faceting allows you to easily create multiple graphs from one dataset and one graph definition by splitting the data on different factors. By defining</p>
<p><code>facet_wrap(&lt;factor_to_split&gt; ~ .)</code></p>
<p>Let’s return to grammar school dataset from <a href="#sec-ifelse">Section&nbsp;3.2.3</a>, we can easily plot this to show the relationship between poverty and school size, showing that grammar schools tend to serve quite affluent cohorts and that larger secondary schools tend to serve poorer cohorts:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb175"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb175-1"><a href="#cb175-1"></a>plot_data <span class="ot">&lt;-</span> schools <span class="sc">%&gt;%</span> </span>
<span id="cb175-2"><a href="#cb175-2"></a>  <span class="fu">filter</span>(Open<span class="sc">==</span><span class="st">"Open"</span>, </span>
<span id="cb175-3"><a href="#cb175-3"></a>         Phase<span class="sc">==</span><span class="st">"Secondary"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb175-4"><a href="#cb175-4"></a>  <span class="fu">mutate</span>(<span class="at">sch_type =</span> </span>
<span id="cb175-5"><a href="#cb175-5"></a>           <span class="fu">ifelse</span>(EstablishmentGroup <span class="sc">!=</span> <span class="st">"Independent schools"</span> <span class="sc">&amp;</span> </span>
<span id="cb175-6"><a href="#cb175-6"></a>                    AdmissionsPolicy<span class="sc">==</span><span class="st">"Selective"</span>,</span>
<span id="cb175-7"><a href="#cb175-7"></a>                  <span class="st">"GRAMMAR"</span>,</span>
<span id="cb175-8"><a href="#cb175-8"></a>                  <span class="st">"NOT GRAMMAR"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb175-9"><a href="#cb175-9"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(sch_type))</span>
<span id="cb175-10"><a href="#cb175-10"></a></span>
<span id="cb175-11"><a href="#cb175-11"></a><span class="fu">ggplot</span>(<span class="at">data=</span>plot_data, <span class="fu">aes</span>(<span class="at">x=</span>FSM, <span class="at">y=</span>NumberOfBoys <span class="sc">+</span> NumberOfGirls)) <span class="sc">+</span> </span>
<span id="cb175-12"><a href="#cb175-12"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">colour=</span>sch_type)) <span class="sc">+</span></span>
<span id="cb175-13"><a href="#cb175-13"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span><span class="st">"lm"</span>) <span class="sc">+</span></span>
<span id="cb175-14"><a href="#cb175-14"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"bottom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>What isn’t clear about the above is how this changes on a regional basis. We might be tempted to filter on each region and create separate charts for each regional name. But this would take a considerable amount of time and effort. Another way to do this is using <code>facet_wrap(Region ~ .)</code>. The below example uses the <code>Region</code> column to create the same chart for each Region, only using the data that is recorded as being in that region:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb176"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb176-1"><a href="#cb176-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>plot_data, <span class="fu">aes</span>(<span class="at">x=</span>FSM, <span class="at">y=</span>NumberOfBoys <span class="sc">+</span> NumberOfGirls)) <span class="sc">+</span> </span>
<span id="cb176-2"><a href="#cb176-2"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">colour=</span>sch_type)) <span class="sc">+</span></span>
<span id="cb176-3"><a href="#cb176-3"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span><span class="st">"lm"</span>) <span class="sc">+</span></span>
<span id="cb176-4"><a href="#cb176-4"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"bottom"</span>) <span class="sc">+</span></span>
<span id="cb176-5"><a href="#cb176-5"></a>  <span class="fu">facet_wrap</span>(Region <span class="sc">~</span> .)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="exporting-plots" class="level2" data-number="3.4"><h2 data-number="3.4" class="anchored" data-anchor-id="exporting-plots">
<span class="header-section-number">3.4</span> Exporting plots</h2>
<p>ggplot can export data in a variety of formats suitable for printing, publication and the web. Once you have created a graph and stored it in an object, the command to save the graph to your hard drive is:</p>
<p><code>ggsave(&lt;file_name_and_extension&gt;, &lt;object_name&gt;)</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb177"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb177-1"><a href="#cb177-1"></a><span class="fu">ggsave</span>(<span class="st">"poverty_size.pdf"</span>, graph_poverty_size)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If you want to change the output format, just change the extension of the file you are saving:</p>
<ul>
<li>“poverty_size.pdf” perfect for publication and printing, large size</li>
<li>“poverty_size.svg” the same as pdf, also suitable for putting on webpages</li>
<li>“poverty_size.png” smaller file size, suitable for websites and presentations</li>
<li>“poverty_size.jpg” same as the png</li>
</ul></section><section id="discussion-activity" class="level2" data-number="3.5"><h2 data-number="3.5" class="anchored" data-anchor-id="discussion-activity">
<span class="header-section-number">3.5</span> Discussion activity</h2>
<p>Based on <span class="citation" data-cites="davis2013introduction">Davis (<a href="#ref-davis2013introduction" role="doc-biblioref">2013</a>)</span> <a href="https://ieas-szeged.hu/downtherabbithole/wp-content/uploads/2018/02/Lennard-J.-Davis-ed.-The-Disability-Studies-Reader-Routledge-2014.pdf#page=15">Link to chapter</a></p>
<p><img src="chapters/images/03%20Normal%20Curve-01.jpg" class="img-fluid"></p>
<p>Consider how and why we think of things as being ‘normal’ (or not). Some suggested questions are: What were your immediate thoughts on reading this paper?</p>
<p>In what ways have you yourself been aware of being compared to norms or ideals? How do you feel about that? As an education professional, have you made comparisons between individual students and expected norms or averages? Between groups of students? When and how was this useful? When and how was this problematic?</p>
</section><section id="statistics" class="level2" data-number="3.6"><h2 data-number="3.6" class="anchored" data-anchor-id="statistics">
<span class="header-section-number">3.6</span> Statistics</h2>
<p>Using the following <code>.csv</code> data set and the <code>read.csv</code> command: <a href="https://content.explore-education-statistics.service.gov.uk/api/releases/daf8d64d-ce21-4f21-c28c-08da3ee963bf/files/4cba1d1f-7ee8-4731-96fe-08da47b59ff3">DfE_SEN_School_Level</a></p>
<div class="cell">
<details><summary>Loading the data</summary><div class="sourceCode cell-code" id="cb178"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb178-1"><a href="#cb178-1"></a><span class="co"># Descriptive Statistics using the DfE SEN School Level Data</span></span>
<span id="cb178-2"><a href="#cb178-2"></a></span>
<span id="cb178-3"><a href="#cb178-3"></a><span class="fu">library</span>(<span class="st">"tidyverse"</span>)</span>
<span id="cb178-4"><a href="#cb178-4"></a>loc<span class="ot">&lt;-</span><span class="st">"&lt;your drive&gt;/sen_school_level_underlying_data.csv"</span></span>
<span id="cb178-5"><a href="#cb178-5"></a>DfE_SEN_data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(loc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><strong>Individually</strong>:</p>
<ul>
<li>Select a single local authority (LA) or region, and copy-paste the data to a new sheet.</li>
<li>Calculate the total number of pupils in the LA, the total number listed as receiving SEN support, and the total number with an EHC plan.</li>
<li>Calculate the percentages of pupils in the SEN support and EHC plan categories.</li>
<li>Find the <code>mean</code>, <code>median</code>, <code>max</code>imum and <code>min</code>imum percentages of students with SEN support and EHC plans.</li>
</ul>
<p><strong>As a class</strong>: Compare results for the different areas, and also to England as a whole. How much variation is there?</p>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode cell-code" id="cb179"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb179-1"><a href="#cb179-1"></a><span class="co"># Descriptive Statistics using the DfE SEN School Level Data</span></span>
<span id="cb179-2"><a href="#cb179-2"></a></span>
<span id="cb179-3"><a href="#cb179-3"></a><span class="co"># Counting total SEN supported students in regions</span></span>
<span id="cb179-4"><a href="#cb179-4"></a>DfE_SEN_data <span class="sc">%&gt;%</span></span>
<span id="cb179-5"><a href="#cb179-5"></a>  <span class="fu">group_by</span>(district_administrative_name) <span class="sc">%&gt;%</span></span>
<span id="cb179-6"><a href="#cb179-6"></a>  <span class="fu">summarise</span>(<span class="at">SEN_support=</span><span class="fu">sum</span>(SEN.support), </span>
<span id="cb179-7"><a href="#cb179-7"></a>            <span class="at">EHCplan=</span><span class="fu">sum</span>(EHC.plan), </span>
<span id="cb179-8"><a href="#cb179-8"></a>            <span class="at">Total=</span><span class="fu">sum</span>(Total.pupils))</span>
<span id="cb179-9"><a href="#cb179-9"></a></span>
<span id="cb179-10"><a href="#cb179-10"></a><span class="co"># Calculating Percentages of students and finding means and modes</span></span>
<span id="cb179-11"><a href="#cb179-11"></a>DfE_SEN_data  <span class="sc">%&gt;%</span> </span>
<span id="cb179-12"><a href="#cb179-12"></a>  <span class="fu">group_by</span>(district_administrative_name) <span class="sc">%&gt;%</span></span>
<span id="cb179-13"><a href="#cb179-13"></a>  <span class="fu">summarise</span>(<span class="at">SEN_support=</span><span class="fu">sum</span>(SEN.support), </span>
<span id="cb179-14"><a href="#cb179-14"></a>            <span class="at">EHCplan=</span><span class="fu">sum</span>(EHC.plan), </span>
<span id="cb179-15"><a href="#cb179-15"></a>            <span class="at">Total=</span><span class="fu">sum</span>(Total.pupils)) <span class="sc">%&gt;%</span></span>
<span id="cb179-16"><a href="#cb179-16"></a>  <span class="fu">mutate</span>(<span class="at">percentageEHCplan =</span> (EHCplan<span class="sc">/</span>Total)<span class="sc">*</span><span class="dv">100</span>, </span>
<span id="cb179-17"><a href="#cb179-17"></a>         <span class="at">percentagesupport =</span> (SEN_support<span class="sc">/</span>Total)<span class="sc">*</span><span class="dv">100</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="statistics-1" class="level2" data-number="3.7"><h2 data-number="3.7" class="anchored" data-anchor-id="statistics-1">
<span class="header-section-number">3.7</span> Statistics</h2>
<p>Using the same data set: <a href="https://content.explore-education-statistics.service.gov.uk/api/releases/daf8d64d-ce21-4f21-c28c-08da3ee963bf/files/4cba1d1f-7ee8-4731-96fe-08da47b59ff3">DfE_SEN_School_Level</a></p>
<p>Practice:</p>
<ul>
<li>Filtering and reorganizing data</li>
<li>Calculating averages and ranges (and, optionally, quartiles, percentiles, standard deviations, etc.)</li>
<li>Displaying data in different types of chart</li>
<li>Comparing subsets of the data on variables that interest you (e.g.&nbsp;state-funded vs independent, religious denomination, girls’ vs boys’ vs mixed schools, etc.) Why might single sex schools have smaller numbers of EHC plans?</li>
</ul>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode cell-code" id="cb180"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb180-1"><a href="#cb180-1"></a><span class="co"># Presenting % on EHC by gender of school</span></span>
<span id="cb180-2"><a href="#cb180-2"></a>genderplot <span class="ot">&lt;-</span> DfE_SEN_data <span class="sc">%&gt;%</span></span>
<span id="cb180-3"><a href="#cb180-3"></a>  <span class="fu">group_by</span>(sex_of_school_description) <span class="sc">%&gt;%</span></span>
<span id="cb180-4"><a href="#cb180-4"></a>  <span class="fu">summarise</span>(<span class="at">SEN_support=</span><span class="fu">sum</span>(SEN.support), </span>
<span id="cb180-5"><a href="#cb180-5"></a>            <span class="at">EHCplan=</span><span class="fu">sum</span>(EHC.plan), </span>
<span id="cb180-6"><a href="#cb180-6"></a>            <span class="at">Total=</span><span class="fu">sum</span>(Total.pupils)) <span class="sc">%&gt;%</span></span>
<span id="cb180-7"><a href="#cb180-7"></a>  <span class="fu">mutate</span>(<span class="at">percentageEHCplan =</span> (EHCplan<span class="sc">/</span>Total)<span class="sc">*</span><span class="dv">100</span>, </span>
<span id="cb180-8"><a href="#cb180-8"></a>         <span class="at">percentagesupport =</span> (SEN_support<span class="sc">/</span>Total)<span class="sc">*</span><span class="dv">100</span>)</span>
<span id="cb180-9"><a href="#cb180-9"></a></span>
<span id="cb180-10"><a href="#cb180-10"></a><span class="co"># using the genderplot data create a graph</span></span>
<span id="cb180-11"><a href="#cb180-11"></a><span class="fu">ggplot</span>(<span class="at">data=</span>genderplot,</span>
<span id="cb180-12"><a href="#cb180-12"></a>       <span class="fu">aes</span>(<span class="at">x=</span>sex_of_school_description,</span>
<span id="cb180-13"><a href="#cb180-13"></a>           <span class="at">y=</span>percentageEHCplan)) <span class="sc">+</span></span>
<span id="cb180-14"><a href="#cb180-14"></a>  <span class="fu">geom_col</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="using-r-to-do-descriptive-statistics-and-plot-graphs" class="level2" data-number="3.8"><h2 data-number="3.8" class="anchored" data-anchor-id="using-r-to-do-descriptive-statistics-and-plot-graphs">
<span class="header-section-number">3.8</span> Using R to do descriptive statistics and plot graphs</h2>
<iframe width="560" height="315" src="https://www.youtube.com/embed/J6yN0y1sm5g?start=2" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="">
</iframe>
<p>You can find the code used in the video below:</p>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode cell-code" id="cb181"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb181-1"><a href="#cb181-1"></a><span class="co"># Introduction to plotting graphs</span></span>
<span id="cb181-2"><a href="#cb181-2"></a><span class="co">#</span></span>
<span id="cb181-3"><a href="#cb181-3"></a><span class="co"># Download data from /Users/k1765032/Library/CloudStorage/GoogleDrive-richardandrewbrock@gmail.com/.shortcut-targets-by-id/1c3CkaEBOICzepArDfjQUP34W2BYhFjM4/PISR/Data/PISA/subset/Students_2018_RBDP_none_levels.rds</span></span>
<span id="cb181-4"><a href="#cb181-4"></a><span class="co"># You want the file: Students_2018_RBDP_none_levels.rds</span></span>
<span id="cb181-5"><a href="#cb181-5"></a><span class="co"># and place in your own file system</span></span>
<span id="cb181-6"><a href="#cb181-6"></a><span class="co"># change loc to load the data directly. Loading into R might take a few minutes</span></span>
<span id="cb181-7"><a href="#cb181-7"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb181-8"><a href="#cb181-8"></a>loc <span class="ot">&lt;-</span> <span class="st">"/Users/k1765032/Library/CloudStorage/GoogleDrive-richardandrewbrock@gmail.com/.shortcut-targets-by-id/1c3CkaEBOICzepArDfjQUP34W2BYhFjM4/PISR/Data/PISA/subset/Students_2018_RBDP_none_levels.rds"</span></span>
<span id="cb181-9"><a href="#cb181-9"></a>PISA_2018 <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(loc)</span>
<span id="cb181-10"><a href="#cb181-10"></a></span>
<span id="cb181-11"><a href="#cb181-11"></a><span class="co"># Calculating means of groups</span></span>
<span id="cb181-12"><a href="#cb181-12"></a><span class="co"># The PISA_2018 dataframe is piped to a new dataframe MeanPISA</span></span>
<span id="cb181-13"><a href="#cb181-13"></a><span class="co"># The data are grouped by the country variable (CNT)</span></span>
<span id="cb181-14"><a href="#cb181-14"></a><span class="co"># The countries of interest are chosen (UK, France, Germany and the US)</span></span>
<span id="cb181-15"><a href="#cb181-15"></a><span class="co"># The summarise function is used to output the mean and standard deviation score for each country</span></span>
<span id="cb181-16"><a href="#cb181-16"></a><span class="co"># on the Science Plausible Value (PV1SCIE) and NAs are ignored na.rm=TRUE</span></span>
<span id="cb181-17"><a href="#cb181-17"></a></span>
<span id="cb181-18"><a href="#cb181-18"></a>MeanPISA <span class="ot">&lt;-</span> PISA_2018 <span class="sc">%&gt;%</span></span>
<span id="cb181-19"><a href="#cb181-19"></a>  <span class="fu">group_by</span>(CNT)  <span class="sc">%&gt;%</span></span>
<span id="cb181-20"><a href="#cb181-20"></a>  <span class="fu">filter</span>(CNT<span class="sc">==</span><span class="st">"United Kingdom"</span> <span class="sc">|</span> CNT<span class="sc">==</span> <span class="st">"France"</span> <span class="sc">|</span> CNT<span class="sc">==</span> <span class="st">"Germany"</span> <span class="sc">|</span> CNT<span class="sc">==</span><span class="st">"United States"</span>)  <span class="sc">%&gt;%</span></span>
<span id="cb181-21"><a href="#cb181-21"></a>  <span class="fu">summarise</span>(<span class="at">mean_sci =</span> <span class="fu">mean</span>(PV1SCIE, <span class="at">na.rm=</span><span class="cn">TRUE</span>), <span class="at">sd_sci=</span> <span class="fu">sd</span>(PV1SCIE, <span class="at">na.rm=</span><span class="cn">TRUE</span>)) </span>
<span id="cb181-22"><a href="#cb181-22"></a><span class="fu">print</span>(MeanPISA)</span>
<span id="cb181-23"><a href="#cb181-23"></a></span>
<span id="cb181-24"><a href="#cb181-24"></a></span>
<span id="cb181-25"><a href="#cb181-25"></a><span class="co"># To plot data we can use the ggplot function. </span></span>
<span id="cb181-26"><a href="#cb181-26"></a><span class="co"># We will start by plotting a column graph use geom_col</span></span>
<span id="cb181-27"><a href="#cb181-27"></a><span class="co"># We specify the data set for ggplot to use (MeanPisa) and then </span></span>
<span id="cb181-28"><a href="#cb181-28"></a><span class="co"># define the x and y variables:</span></span>
<span id="cb181-29"><a href="#cb181-29"></a><span class="co"># ggplot(MeanPISA,</span></span>
<span id="cb181-30"><a href="#cb181-30"></a><span class="co">#       aes(x=CNT, y=mean_sci))</span></span>
<span id="cb181-31"><a href="#cb181-31"></a><span class="co"># geom_col() (Note the plus is on the line before) plots the graph and the fill colour is set to red</span></span>
<span id="cb181-32"><a href="#cb181-32"></a><span class="co"># The next three lines set the formatting of the axis text and add x and y axis labels</span></span>
<span id="cb181-33"><a href="#cb181-33"></a></span>
<span id="cb181-34"><a href="#cb181-34"></a><span class="fu">ggplot</span>(MeanPISA,</span>
<span id="cb181-35"><a href="#cb181-35"></a>       <span class="fu">aes</span>(<span class="at">x=</span>CNT, <span class="at">y=</span>mean_sci))<span class="sc">+</span></span>
<span id="cb181-36"><a href="#cb181-36"></a><span class="fu">geom_col</span>(<span class="at">fill=</span><span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb181-37"><a href="#cb181-37"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">hjust=</span><span class="fl">0.95</span>, <span class="at">vjust=</span><span class="fl">0.2</span>, <span class="at">size=</span><span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb181-38"><a href="#cb181-38"></a>  <span class="fu">xlab</span>(<span class="st">"Country"</span>) <span class="sc">+</span></span>
<span id="cb181-39"><a href="#cb181-39"></a>  <span class="fu">ylab</span>(<span class="st">"Science Score"</span>)</span>
<span id="cb181-40"><a href="#cb181-40"></a></span>
<span id="cb181-41"><a href="#cb181-41"></a><span class="co"># For plotting a scatter plot or PISA reading scores against science scores</span></span>
<span id="cb181-42"><a href="#cb181-42"></a><span class="co">#, first we make a managable data set</span></span>
<span id="cb181-43"><a href="#cb181-43"></a><span class="co"># I will filter the data set to include only the UK data</span></span>
<span id="cb181-44"><a href="#cb181-44"></a><span class="co"># Select the country, reading and science score, and remove any NAs</span></span>
<span id="cb181-45"><a href="#cb181-45"></a></span>
<span id="cb181-46"><a href="#cb181-46"></a>UKData <span class="ot">&lt;-</span> PISA_2018 <span class="sc">%&gt;%</span></span>
<span id="cb181-47"><a href="#cb181-47"></a>  <span class="fu">filter</span>(CNT<span class="sc">==</span><span class="st">"United Kingdom"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb181-48"><a href="#cb181-48"></a>  <span class="fu">select</span>(CNT, PV1SCIE, PV1READ, ST004D01T) <span class="sc">%&gt;%</span></span>
<span id="cb181-49"><a href="#cb181-49"></a>  <span class="fu">drop_na</span>(PV1SCIE)</span>
<span id="cb181-50"><a href="#cb181-50"></a></span>
<span id="cb181-51"><a href="#cb181-51"></a><span class="co"># This time I will use ggplot to plot a scatter graph</span></span>
<span id="cb181-52"><a href="#cb181-52"></a><span class="co"># I feed UKDATA to ggplot, specify the x (PISA Reading score)</span></span>
<span id="cb181-53"><a href="#cb181-53"></a><span class="co"># And y (PISA science score). This time, I have linked the colour</span></span>
<span id="cb181-54"><a href="#cb181-54"></a><span class="co"># to a variable (ST004D01T) which is the gender value, giving</span></span>
<span id="cb181-55"><a href="#cb181-55"></a><span class="co"># plot points of different colours for boys and girls</span></span>
<span id="cb181-56"><a href="#cb181-56"></a><span class="co"># To produce a scatter plot, I use geom_point to plot points,</span></span>
<span id="cb181-57"><a href="#cb181-57"></a><span class="co"># Giving the size of point and the transparency (alpha=0.5) -</span></span>
<span id="cb181-58"><a href="#cb181-58"></a><span class="co"># some transparency of points is helpful when plots become dense</span></span>
<span id="cb181-59"><a href="#cb181-59"></a><span class="co"># The x and y lables are added</span></span>
<span id="cb181-60"><a href="#cb181-60"></a><span class="co"># Finally, a line is plotted - geom_smooth(method='lm')</span></span>
<span id="cb181-61"><a href="#cb181-61"></a><span class="co"># sets the line to a linear ('lm') line</span></span>
<span id="cb181-62"><a href="#cb181-62"></a></span>
<span id="cb181-63"><a href="#cb181-63"></a>  <span class="fu">ggplot</span>(UKData,</span>
<span id="cb181-64"><a href="#cb181-64"></a>       <span class="fu">aes</span>(<span class="at">x=</span>PV1READ, <span class="at">y=</span>PV1SCIE, <span class="at">colour=</span>ST004D01T)) <span class="sc">+</span></span>
<span id="cb181-65"><a href="#cb181-65"></a>  <span class="fu">geom_point</span>(<span class="at">size=</span><span class="fl">0.1</span>, <span class="at">alpha=</span><span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb181-66"><a href="#cb181-66"></a>  <span class="fu">ylab</span>(<span class="st">"Science Score"</span>) <span class="sc">+</span></span>
<span id="cb181-67"><a href="#cb181-67"></a>  <span class="fu">xlab</span>(<span class="st">"Reading Score"</span>) <span class="sc">+</span></span>
<span id="cb181-68"><a href="#cb181-68"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">'lm'</span>)</span>
<span id="cb181-69"><a href="#cb181-69"></a>  </span>
<span id="cb181-70"><a href="#cb181-70"></a><span class="co"># Where R becomes very powerful is being able to produce multiple charts rapidly</span></span>
<span id="cb181-71"><a href="#cb181-71"></a><span class="co"># In the code below, I plot reading against science scores as above, but this time</span></span>
<span id="cb181-72"><a href="#cb181-72"></a><span class="co"># Use the entire data set - for the whole world!</span></span>
<span id="cb181-73"><a href="#cb181-73"></a><span class="co"># All the steps are the same, except, I use the facet_wrap, a way to create multiple</span></span>
<span id="cb181-74"><a href="#cb181-74"></a><span class="co"># graph panels - the instruction creates a set of graphs for each country  </span></span>
<span id="cb181-75"><a href="#cb181-75"></a>  </span>
<span id="cb181-76"><a href="#cb181-76"></a>  WorldData <span class="ot">&lt;-</span> PISA_2018 <span class="sc">%&gt;%</span></span>
<span id="cb181-77"><a href="#cb181-77"></a>    <span class="fu">select</span>(CNT, PV1SCIE, PV1READ, ST004D01T) <span class="sc">%&gt;%</span></span>
<span id="cb181-78"><a href="#cb181-78"></a>    <span class="fu">drop_na</span>(PV1SCIE)</span>
<span id="cb181-79"><a href="#cb181-79"></a>  </span>
<span id="cb181-80"><a href="#cb181-80"></a>  <span class="fu">ggplot</span>(WorldData,</span>
<span id="cb181-81"><a href="#cb181-81"></a>         <span class="fu">aes</span>(<span class="at">x=</span>PV1READ, <span class="at">y=</span>PV1SCIE, <span class="at">colour=</span>ST004D01T)) <span class="sc">+</span></span>
<span id="cb181-82"><a href="#cb181-82"></a>    <span class="fu">geom_point</span>(<span class="at">size=</span><span class="fl">0.1</span>, <span class="at">alpha=</span><span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb181-83"><a href="#cb181-83"></a>    <span class="fu">ylab</span>(<span class="st">"Science Score"</span>) <span class="sc">+</span></span>
<span id="cb181-84"><a href="#cb181-84"></a>    <span class="fu">xlab</span>(<span class="st">"Reading Score"</span>) <span class="sc">+</span></span>
<span id="cb181-85"><a href="#cb181-85"></a>    <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">'lm'</span>) <span class="sc">+</span></span>
<span id="cb181-86"><a href="#cb181-86"></a>    <span class="fu">facet_wrap</span>(CNT<span class="sc">~</span>.)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section></section><section id="gender-differences" class="level1" data-number="4"><h1 data-number="4">
<span class="header-section-number">4</span> Gender differences</h1>
<div class="cell">

</div>
<section id="statistical-analysis" class="level2" data-number="4.1"><h2 data-number="4.1" class="anchored" data-anchor-id="statistical-analysis">
<span class="header-section-number">4.1</span> Statistical analysis</h2>
<p>There are probably statistical libraries in R to do every sort of test you will ever need, from the typical ANOVA to cutting edge machine learning. The full list of R packages sits on the <a href="https://cran.r-project.org/web/packages/available_packages_by_name.html">cran server</a> and you can load packages as and when you need them at no cost. R comes pre-packaged with some common statistical tools, for example, the <code><a href="https://rdrr.io/r/stats/t.test.html">t.test()</a></code> and linear model regression <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code>. For other stats tools you’ll need to install the package and load it (see <a href="#sec-load-run-pckges">Section&nbsp;2.6.1</a>) before you can use the functions.</p>
</section></section><section id="t-tests" class="level1" data-number="5"><h1 data-number="5">
<span class="header-section-number">5</span> T-tests</h1>
<section id="task-1-1" class="level2" data-number="5.1"><h2 data-number="5.1" class="anchored" data-anchor-id="task-1-1">
<span class="header-section-number">5.1</span> Task 1</h2>
<div class="cell">

</div>
</section><section id="task-2-1" class="level2" data-number="5.2"><h2 data-number="5.2" class="anchored" data-anchor-id="task-2-1">
<span class="header-section-number">5.2</span> Task 2</h2>
<div class="cell">

</div>
</section><section id="task-3" class="level2" data-number="5.3"><h2 data-number="5.3" class="anchored" data-anchor-id="task-3">
<span class="header-section-number">5.3</span> Task 3</h2>
<div class="cell">

</div>
<section id="doing-t-tests-in-r" class="level3" data-number="5.3.1"><h3 data-number="5.3.1" class="anchored" data-anchor-id="doing-t-tests-in-r">
<span class="header-section-number">5.3.1</span> Doing t-tests in R</h3>
<iframe width="560" height="315" src="https://www.youtube.com/embed/KdhAcLPq5B4?start=3" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="">
</iframe>
<p>You can find the code from the video below:</p>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode cell-code" id="cb182"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb182-1"><a href="#cb182-1"></a><span class="co"># Introduction to t-tests in R</span></span>
<span id="cb182-2"><a href="#cb182-2"></a><span class="co">#</span></span>
<span id="cb182-3"><a href="#cb182-3"></a><span class="co"># Download data from /Users/k1765032/Library/CloudStorage/GoogleDrive-richardandrewbrock@gmail.com/.shortcut-targets-by-id/1c3CkaEBOICzepArDfjQUP34W2BYhFjM4/PISR/Data/PISA/subset/Students_2018_RBDP_none_levels.rds</span></span>
<span id="cb182-4"><a href="#cb182-4"></a><span class="co"># You want the file: Students_2018_RBDP_none_levels.rds</span></span>
<span id="cb182-5"><a href="#cb182-5"></a><span class="co"># and place in your own file system</span></span>
<span id="cb182-6"><a href="#cb182-6"></a><span class="co"># change loc to load the data directly. Loading into R might take a few minutes</span></span>
<span id="cb182-7"><a href="#cb182-7"></a><span class="fu">install.packages</span>(<span class="st">"nortest"</span>)</span>
<span id="cb182-8"><a href="#cb182-8"></a></span>
<span id="cb182-9"><a href="#cb182-9"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb182-10"><a href="#cb182-10"></a><span class="fu">library</span>(nortest)</span>
<span id="cb182-11"><a href="#cb182-11"></a>loc <span class="ot">&lt;-</span> <span class="st">"/Users/k1765032/Library/CloudStorage/GoogleDrive-richardandrewbrock@gmail.com/.shortcut-targets-by-id/1c3CkaEBOICzepArDfjQUP34W2BYhFjM4/PISR/Data/PISA/subset/Students_2018_RBDP_none_levels.rds"</span></span>
<span id="cb182-12"><a href="#cb182-12"></a>PISA_2018 <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(loc)</span>
<span id="cb182-13"><a href="#cb182-13"></a></span>
<span id="cb182-14"><a href="#cb182-14"></a><span class="co"># Are there differences between the mean scores of UK boys and girls in PISA mathematics?</span></span>
<span id="cb182-15"><a href="#cb182-15"></a><span class="co">#</span></span>
<span id="cb182-16"><a href="#cb182-16"></a><span class="co"># Select the gender (ST004D01T) and math score columns (PV1MATH)</span></span>
<span id="cb182-17"><a href="#cb182-17"></a><span class="co"># Filter the data to select UK responses</span></span>
<span id="cb182-18"><a href="#cb182-18"></a></span>
<span id="cb182-19"><a href="#cb182-19"></a>MaleUK<span class="ot">&lt;-</span>PISA_2018 <span class="sc">%&gt;%</span></span>
<span id="cb182-20"><a href="#cb182-20"></a>  <span class="fu">select</span>(CNT,ST004D01T, PV1MATH) <span class="sc">%&gt;%</span></span>
<span id="cb182-21"><a href="#cb182-21"></a>  <span class="fu">filter</span>(CNT<span class="sc">==</span><span class="st">'United Kingdom'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb182-22"><a href="#cb182-22"></a>  <span class="fu">filter</span>(ST004D01T<span class="sc">==</span><span class="st">'Male'</span>)</span>
<span id="cb182-23"><a href="#cb182-23"></a></span>
<span id="cb182-24"><a href="#cb182-24"></a>FemaleUK<span class="ot">&lt;-</span>PISA_2018 <span class="sc">%&gt;%</span></span>
<span id="cb182-25"><a href="#cb182-25"></a>  <span class="fu">select</span>(CNT,ST004D01T, PV1MATH) <span class="sc">%&gt;%</span></span>
<span id="cb182-26"><a href="#cb182-26"></a>  <span class="fu">filter</span>(CNT<span class="sc">==</span><span class="st">'United Kingdom'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb182-27"><a href="#cb182-27"></a>  <span class="fu">filter</span>(ST004D01T<span class="sc">==</span><span class="st">'Female'</span>)</span>
<span id="cb182-28"><a href="#cb182-28"></a></span>
<span id="cb182-29"><a href="#cb182-29"></a><span class="co"># The conditions to do a t-test include that the data are normally distributed</span></span>
<span id="cb182-30"><a href="#cb182-30"></a><span class="co"># and there is homogeneity (similarity) of the variances (the squared standard deviations)</span></span>
<span id="cb182-31"><a href="#cb182-31"></a><span class="co"># Let us check the conditions are met by calculating first if the data sets are normally</span></span>
<span id="cb182-32"><a href="#cb182-32"></a><span class="co"># distributed using the Pearson test of normality from the nortest package</span></span>
<span id="cb182-33"><a href="#cb182-33"></a></span>
<span id="cb182-34"><a href="#cb182-34"></a><span class="fu">pearson.test</span>(<span class="fu">as.numeric</span>(MaleUK<span class="sc">$</span>PV1MATH))</span>
<span id="cb182-35"><a href="#cb182-35"></a><span class="fu">pearson.test</span>(<span class="fu">as.numeric</span>(FemaleUK<span class="sc">$</span>PV1MATH))</span>
<span id="cb182-36"><a href="#cb182-36"></a></span>
<span id="cb182-37"><a href="#cb182-37"></a><span class="co"># The p-values are over 0.05 so both distriburtions are normal</span></span>
<span id="cb182-38"><a href="#cb182-38"></a><span class="co"># Pearson chi-square normality test</span></span>
<span id="cb182-39"><a href="#cb182-39"></a><span class="co">#</span></span>
<span id="cb182-40"><a href="#cb182-40"></a><span class="co"># data:  as.numeric(MaleUK$PV1MATH)</span></span>
<span id="cb182-41"><a href="#cb182-41"></a><span class="co"># P = 75.714, p-value = 0.1936</span></span>
<span id="cb182-42"><a href="#cb182-42"></a><span class="co"># Pearson chi-square normality test</span></span>
<span id="cb182-43"><a href="#cb182-43"></a><span class="co">#</span></span>
<span id="cb182-44"><a href="#cb182-44"></a><span class="co"># data:  as.numeric(FemaleUK$PV1MATH)</span></span>
<span id="cb182-45"><a href="#cb182-45"></a><span class="co"># P = 74.06, p-value = 0.2589</span></span>
<span id="cb182-46"><a href="#cb182-46"></a><span class="co">#</span></span>
<span id="cb182-47"><a href="#cb182-47"></a><span class="co"># We will then check the variances of the two data sets</span></span>
<span id="cb182-48"><a href="#cb182-48"></a></span>
<span id="cb182-49"><a href="#cb182-49"></a>VarM<span class="ot">&lt;-</span><span class="fu">var</span>(MaleUK<span class="sc">$</span>PV1MATH)</span>
<span id="cb182-50"><a href="#cb182-50"></a>VarF<span class="ot">&lt;-</span><span class="fu">var</span>(FemaleUK<span class="sc">$</span>PV1MATH)</span>
<span id="cb182-51"><a href="#cb182-51"></a>VarM<span class="sc">/</span>VarF</span>
<span id="cb182-52"><a href="#cb182-52"></a></span>
<span id="cb182-53"><a href="#cb182-53"></a><span class="co"># The variance ratio is close to 1 (1.1)</span></span>
<span id="cb182-54"><a href="#cb182-54"></a><span class="co"># So our two conditions are met and can we can perform the t-test</span></span>
<span id="cb182-55"><a href="#cb182-55"></a></span>
<span id="cb182-56"><a href="#cb182-56"></a><span class="fu">t.test</span>(MaleUK<span class="sc">$</span>PV1MATH, FemaleUK<span class="sc">$</span>PV1MATH)</span>
<span id="cb182-57"><a href="#cb182-57"></a></span>
<span id="cb182-58"><a href="#cb182-58"></a><span class="co"># The p-value is &lt;0.05 (4.061e-08) suggesting there are statistically</span></span>
<span id="cb182-59"><a href="#cb182-59"></a><span class="co"># differences between boys and girls</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section></section></section><section id="maths-anxiety" class="level1" data-number="6"><h1 data-number="6">
<span class="header-section-number">6</span> Maths Anxiety</h1>
<div class="cell">

</div>
<section id="chi-square-tests" class="level2" data-number="6.1"><h2 data-number="6.1" class="anchored" data-anchor-id="chi-square-tests">
<span class="header-section-number">6.1</span> Chi-square tests</h2>
<p>Chi squared (<span class="math inline">\(\chi^2\)</span>) tests are <em>non-parametric</em> tests, this means that the test isn’t expecting the underlying data to be distributed in a certain way. Chi-square determines how well the frequency distribution for a sample fits the population distribution and will let you know when things aren’t distributed as expected. For example you might expect girls and boys to have the same coloured dogs, chi square would tell you whether the null hypothesis, that there is no difference between the categories, is true or not. I.e. girls and boys are equally likely to have the same colours of dog at home.</p>
<p>In more mathematical terms, chi square examines differences between the categories of an independent variable with respect to a dependent variable measured on a nominal (or categorical) scale, that is a scale that has values that aren’t ordered, or continuous, for example Gender or favourite flavour of icecream.</p>
<p>In the example below you will be loading data about Ofsted inspections to see if the Ofsted grade of a state secondary school varies dependent on whether the school is all all boys, all girls or mixed.</p>
</section><section id="load-the-data" class="level2" data-number="6.2"><h2 data-number="6.2" class="anchored" data-anchor-id="load-the-data">
<span class="header-section-number">6.2</span> Load the data</h2>
<p>The data for this example comes from the DfE edubase system. This system is updated almost daily with information on all education providers in the country. The snapshot below was taken in 2018, you are welcome to <a href="https://www.get-information-schools.service.gov.uk/Downloads">download</a> a later copy.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb183"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb183-1"><a href="#cb183-1"></a><span class="co"># Download data on all educational providers in England</span></span>
<span id="cb183-2"><a href="#cb183-2"></a><span class="co"># with details on FSM and Ofsted inspections</span></span>
<span id="cb183-3"><a href="#cb183-3"></a></span>
<span id="cb183-4"><a href="#cb183-4"></a><span class="fu">library</span>(<span class="st">"tidyverse"</span>)</span>
<span id="cb183-5"><a href="#cb183-5"></a><span class="fu">library</span>(<span class="st">"openxlsx"</span>)</span>
<span id="cb183-6"><a href="#cb183-6"></a></span>
<span id="cb183-7"><a href="#cb183-7"></a>DfE_schools_2018 <span class="ot">&lt;-</span> <span class="fu">read.xlsx</span>(<span class="st">"https://drive.google.com/uc?export=download&amp;id=1tp9xe3dS__eg7RrXf0T_oMxcrz_TbMdM"</span>,</span>
<span id="cb183-8"><a href="#cb183-8"></a>                      <span class="at">sheet=</span><span class="st">"Schools"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="wrangling-the-data" class="level2" data-number="6.3"><h2 data-number="6.3" class="anchored" data-anchor-id="wrangling-the-data">
<span class="header-section-number">6.3</span> Wrangling the data</h2>
<p>The dataset is absolutely massive, weighing in at about 60Mb and almost 50,000 providers, both historic and current. You need to whittle this down to the schools that you are interested in, that is the schools that are open, for secondary school students and are not independent (private) providers.</p>
<p>We’ll also need to</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb184"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb184-1"><a href="#cb184-1"></a><span class="co"># note that 2018 data doesn't have inadequate</span></span>
<span id="cb184-2"><a href="#cb184-2"></a></span>
<span id="cb184-3"><a href="#cb184-3"></a>Ofsted_ratings <span class="ot">&lt;-</span> DfE_schools_2018 <span class="sc">%&gt;%</span></span>
<span id="cb184-4"><a href="#cb184-4"></a>  <span class="fu">filter</span>(Open <span class="sc">==</span> <span class="st">"Open"</span>,</span>
<span id="cb184-5"><a href="#cb184-5"></a>         EstablishmentGroup <span class="sc">!=</span> <span class="st">"Independent schools"</span>,</span>
<span id="cb184-6"><a href="#cb184-6"></a>         Phase <span class="sc">==</span> <span class="st">"Secondary"</span>,</span>
<span id="cb184-7"><a href="#cb184-7"></a>         OfstedRating <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Outstanding"</span>, <span class="st">"Good"</span>,</span>
<span id="cb184-8"><a href="#cb184-8"></a>                             <span class="st">"Requires improvement"</span>,<span class="st">"Inadequate"</span>,</span>
<span id="cb184-9"><a href="#cb184-9"></a>                             <span class="st">"Special Measures"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb184-10"><a href="#cb184-10"></a>  <span class="fu">mutate</span>(<span class="at">FSM_group =</span> <span class="fu">ntile</span>(FSM, <span class="at">n=</span><span class="dv">3</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb184-11"><a href="#cb184-11"></a>  <span class="fu">mutate</span>(<span class="at">FSM_group =</span> <span class="fu">ifelse</span>(FSM_group <span class="sc">==</span> <span class="dv">3</span>,</span>
<span id="cb184-12"><a href="#cb184-12"></a>                            <span class="st">"High"</span>,</span>
<span id="cb184-13"><a href="#cb184-13"></a>                            <span class="fu">ifelse</span>(FSM_group <span class="sc">==</span> <span class="dv">2</span>,</span>
<span id="cb184-14"><a href="#cb184-14"></a>                                   <span class="st">"Medium"</span>,</span>
<span id="cb184-15"><a href="#cb184-15"></a>                                   <span class="st">"Low"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="contingency-tables" class="level2" data-number="6.4"><h2 data-number="6.4" class="anchored" data-anchor-id="contingency-tables">
<span class="header-section-number">6.4</span> Contingency tables</h2>
<p>To get a feel for what the data looks like we can build a contingency table. This will show the number of providers that match each combination of of the two groupings we are looking at, in this case the OfstedRating and the FSM_group. To do this we will first <code>count</code> each <code>group</code> of <code>OfstedRating</code> and <code>FSM_group</code>. This makes a nice list of the number of instances of each group:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb185"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb185-1"><a href="#cb185-1"></a><span class="co"># to get a frequency table of the above we can use group_by</span></span>
<span id="cb185-2"><a href="#cb185-2"></a></span>
<span id="cb185-3"><a href="#cb185-3"></a>Ofsted_ratings_freq <span class="ot">&lt;-</span> Ofsted_ratings <span class="sc">%&gt;%</span></span>
<span id="cb185-4"><a href="#cb185-4"></a>  <span class="fu">group_by</span>(OfstedRating, FSM_group) <span class="sc">%&gt;%</span></span>
<span id="cb185-5"><a href="#cb185-5"></a>  <span class="fu">count</span>()</span>
<span id="cb185-6"><a href="#cb185-6"></a></span>
<span id="cb185-7"><a href="#cb185-7"></a><span class="fu">print</span>(Ofsted_ratings_freq)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 3
# Groups:   OfstedRating, FSM_group [12]
   OfstedRating         FSM_group     n
   &lt;chr&gt;                &lt;chr&gt;     &lt;int&gt;
 1 Good                 High        486
 2 Good                 Low         506
 3 Good                 Medium      577
 4 Outstanding          High         90
 5 Outstanding          Low         252
 6 Outstanding          Medium      100
 7 Requires improvement High        222
 8 Requires improvement Low          69
 9 Requires improvement Medium      145
10 Special Measures     High         34
11 Special Measures     Low           5
12 Special Measures     Medium       10</code></pre>
</div>
</div>
<p>To put this into a contingency table we can use <code>pivot_wider</code>, this will keep the <code>FSM_group</code> and by fetching <code>names_from = OfstedRating</code>, it will create a new column for each <code>OfstedRating</code> and will then show how many instances of each combined <code>OfstedRating</code> and <code>FSM_group</code> there are.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb187"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb187-1"><a href="#cb187-1"></a><span class="co"># build a contingency table</span></span>
<span id="cb187-2"><a href="#cb187-2"></a>contingency_table <span class="ot">&lt;-</span> Ofsted_ratings_freq <span class="sc">%&gt;%</span> </span>
<span id="cb187-3"><a href="#cb187-3"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> OfstedRating,</span>
<span id="cb187-4"><a href="#cb187-4"></a>              <span class="at">values_from =</span> n)</span>
<span id="cb187-5"><a href="#cb187-5"></a><span class="fu">print</span>(contingency_table)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 5
# Groups:   FSM_group [3]
  FSM_group  Good Outstanding `Requires improvement` `Special Measures`
  &lt;chr&gt;     &lt;int&gt;       &lt;int&gt;                  &lt;int&gt;              &lt;int&gt;
1 High        486          90                    222                 34
2 Low         506         252                     69                  5
3 Medium      577         100                    145                 10</code></pre>
</div>
</div>
</section><section id="plotting-the-chi-square-relationships" class="level2" data-number="6.5"><h2 data-number="6.5" class="anchored" data-anchor-id="plotting-the-chi-square-relationships">
<span class="header-section-number">6.5</span> Plotting the chi-square relationships</h2>
<p>The numbers in the contingency table might look odd, but it might be hard to see how far out they are from each other. We can also visualise the data from the contingency table by building a mosaic plot. To do this you are going to need to install and load the <code>ggmosaic</code> package. See packages section for more details on how to do this.</p>
<p>If you were to go and create a mosaic plot you might find that the order of the x and y axis isn’t to your liking:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb189"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb189-1"><a href="#cb189-1"></a> <span class="co"># install.packages("ggmosaic")</span></span>
<span id="cb189-2"><a href="#cb189-2"></a><span class="fu">library</span>(ggmosaic)</span>
<span id="cb189-3"><a href="#cb189-3"></a><span class="co"># plot results</span></span>
<span id="cb189-4"><a href="#cb189-4"></a><span class="fu">ggplot</span>(<span class="at">data =</span> Ofsted_ratings) <span class="sc">+</span></span>
<span id="cb189-5"><a href="#cb189-5"></a>  <span class="fu">geom_mosaic</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">product</span>(OfstedRating, </span>
<span id="cb189-6"><a href="#cb189-6"></a>                              FSM_group), </span>
<span id="cb189-7"><a href="#cb189-7"></a>                  <span class="at">fill =</span> OfstedRating))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: `unite_()` was deprecated in tidyr 1.2.0.
ℹ Please use `unite()` instead.
ℹ The deprecated feature was likely used in the ggmosaic package.
  Please report the issue at &lt;]8;;https://github.com/haleyjeppson/ggmosaichttps://github.com/haleyjeppson/ggmosaic]8;;&gt;.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-136-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The order of the x and y axis on the table are defined by the <em>levels</em> of the data. This is a specific R concept, where we have columns stored as factors, with levels. Factors define a column as only allowing a certain set of values, these values are defined by the levels, and the order of the levels.</p>
<p>. You #TODO: get the ‘factors’ in order</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb191"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb191-1"><a href="#cb191-1"></a> <span class="co"># install.packages("ggmosaic")</span></span>
<span id="cb191-2"><a href="#cb191-2"></a><span class="fu">library</span>(ggmosaic)</span>
<span id="cb191-3"><a href="#cb191-3"></a></span>
<span id="cb191-4"><a href="#cb191-4"></a><span class="co"># add order to the factors involved in the mosaic</span></span>
<span id="cb191-5"><a href="#cb191-5"></a>rdr <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Outstanding"</span>, <span class="st">"Good"</span>, <span class="st">"Requires improvement"</span>, <span class="st">"Special Measures"</span>) </span>
<span id="cb191-6"><a href="#cb191-6"></a></span>
<span id="cb191-7"><a href="#cb191-7"></a>Ofsted_ratings <span class="ot">&lt;-</span> Ofsted_ratings <span class="sc">%&gt;%</span> </span>
<span id="cb191-8"><a href="#cb191-8"></a>  <span class="fu">mutate</span>(<span class="at">OfstedRating =</span> <span class="fu">factor</span>(OfstedRating, </span>
<span id="cb191-9"><a href="#cb191-9"></a>                               <span class="at">levels=</span>rdr),</span>
<span id="cb191-10"><a href="#cb191-10"></a>        <span class="at">FSM_group =</span> <span class="fu">factor</span>(FSM_group, </span>
<span id="cb191-11"><a href="#cb191-11"></a>                           <span class="at">levels=</span><span class="fu">c</span>(<span class="st">"Low"</span>, <span class="st">"Medium"</span>, <span class="st">"High"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="running-chi-square-tests" class="level2" data-number="6.6"><h2 data-number="6.6" class="anchored" data-anchor-id="running-chi-square-tests">
<span class="header-section-number">6.6</span> Running Chi square tests</h2>
<p>Now we have the providers that we want, we can start to build a chi-square test. This is very easy in R and it follows the following structure:</p>
<blockquote class="blockquote">
<p>chi</p>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb192"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb192-1"><a href="#cb192-1"></a><span class="fu">chisq.test</span>(Ofsted_ratings<span class="sc">$</span>OfstedRating, Ofsted_ratings<span class="sc">$</span>FSM_group)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Pearson's Chi-squared test

data:  Ofsted_ratings$OfstedRating and Ofsted_ratings$FSM_group
X-squared = 230.58, df = 6, p-value &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb194"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb194-1"><a href="#cb194-1"></a><span class="co"># summary(chisq.test(Ofsted_ratings$OfstedRating, Ofsted_ratings$FSM_group))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="seminar-tasks-1" class="level2" data-number="6.7"><h2 data-number="6.7" class="anchored" data-anchor-id="seminar-tasks-1">
<span class="header-section-number">6.7</span> Seminar Tasks</h2>
<section id="activity-1--checking-chi-square-test-in-a-research-paper" class="level3" data-number="6.7.1"><h3 data-number="6.7.1" class="anchored" data-anchor-id="activity-1--checking-chi-square-test-in-a-research-paper">
<span class="header-section-number">6.7.1</span> Activity 1- Checking chi-square test in a research paper</h3>
<div class="cell">

</div>
<p>In this activity you are going to look at the data presented in a paper by <span class="citation" data-cites="mutodi2014influence">Mutodi and Ngirande (<a href="#ref-mutodi2014influence" role="doc-biblioref">2014</a>)</span>. They present the relationships between a number of demographic factors and maths anxiety. For example, table 3 in the paper looks at the relationship between gender and maths anxiety.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb195"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb195-1"><a href="#cb195-1"></a>anx3_table_out</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div id="xnvdtojemn" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#xnvdtojemn .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#xnvdtojemn .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#xnvdtojemn .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#xnvdtojemn .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#xnvdtojemn .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#xnvdtojemn .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#xnvdtojemn .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#xnvdtojemn .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#xnvdtojemn .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#xnvdtojemn .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#xnvdtojemn .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#xnvdtojemn .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#xnvdtojemn .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#xnvdtojemn .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#xnvdtojemn .gt_from_md > :first-child {
  margin-top: 0;
}

#xnvdtojemn .gt_from_md > :last-child {
  margin-bottom: 0;
}

#xnvdtojemn .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#xnvdtojemn .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#xnvdtojemn .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#xnvdtojemn .gt_row_group_first td {
  border-top-width: 2px;
}

#xnvdtojemn .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#xnvdtojemn .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#xnvdtojemn .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#xnvdtojemn .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#xnvdtojemn .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#xnvdtojemn .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#xnvdtojemn .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#xnvdtojemn .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#xnvdtojemn .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#xnvdtojemn .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#xnvdtojemn .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#xnvdtojemn .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#xnvdtojemn .gt_left {
  text-align: left;
}

#xnvdtojemn .gt_center {
  text-align: center;
}

#xnvdtojemn .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#xnvdtojemn .gt_font_normal {
  font-weight: normal;
}

#xnvdtojemn .gt_font_bold {
  font-weight: bold;
}

#xnvdtojemn .gt_font_italic {
  font-style: italic;
}

#xnvdtojemn .gt_super {
  font-size: 65%;
}

#xnvdtojemn .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#xnvdtojemn .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#xnvdtojemn .gt_indent_1 {
  text-indent: 5px;
}

#xnvdtojemn .gt_indent_2 {
  text-indent: 10px;
}

#xnvdtojemn .gt_indent_3 {
  text-indent: 15px;
}

#xnvdtojemn .gt_indent_4 {
  text-indent: 20px;
}

#xnvdtojemn .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table">
<thead class="gt_col_headings"><tr>
<th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="Gender">Gender</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="High level of anxiety">High level of anxiety</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Moderate level of anxiety">Moderate level of anxiety</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="No math anxiety">No math anxiety</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Not sure">Not sure</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Total">Total</th>
    </tr></thead>
<tbody class="gt_table_body">
<tr>
<td headers="Gender" class="gt_row gt_left">Female</td>
<td headers="High level of anxiety" class="gt_row gt_right">14</td>
<td headers="Moderate level of anxiety" class="gt_row gt_right">10</td>
<td headers="No math anxiety" class="gt_row gt_right">3</td>
<td headers="Not sure" class="gt_row gt_right">9</td>
<td headers="Total" class="gt_row gt_right">36</td>
</tr>
<tr>
<td headers="Gender" class="gt_row gt_left">Male</td>
<td headers="High level of anxiety" class="gt_row gt_right">26</td>
<td headers="Moderate level of anxiety" class="gt_row gt_right">35</td>
<td headers="No math anxiety" class="gt_row gt_right">6</td>
<td headers="Not sure" class="gt_row gt_right">17</td>
<td headers="Total" class="gt_row gt_right">84</td>
</tr>
<tr>
<td headers="Gender" class="gt_row gt_left">Total</td>
<td headers="High level of anxiety" class="gt_row gt_right">40</td>
<td headers="Moderate level of anxiety" class="gt_row gt_right">45</td>
<td headers="No math anxiety" class="gt_row gt_right">9</td>
<td headers="Not sure" class="gt_row gt_right">26</td>
<td headers="Total" class="gt_row gt_right">120</td>
</tr>
</tbody>
<tfoot class="gt_sourcenotes"><tr>
<td class="gt_sourcenote" colspan="6">Source: Table 3, Mutodi, P. and Ngirande, H. (2014) The influence of studentsperceptions on Mathematics performance. A case of a selected high school in South Africa. Mediterranean Journal of Social Sciences</td>
    </tr></tfoot>
</table>
</div>
</div>
</div>
<p>The raw survey data is available in a two column csv format, with each row equal to one survey response. The first column being the demographic data; in the case below, <code>Gender</code>, and the second column listing the student’s answer to the questions about maths anxiety, listed here as <code>name</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb196"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb196-1"><a href="#cb196-1"></a>anx3_data <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  Gender name                 
  &lt;chr&gt;  &lt;chr&gt;                
1 Male   High level of anxiety
2 Male   High level of anxiety
3 Male   High level of anxiety</code></pre>
</div>
</div>
<ul>
<li>Using the gender and maths anxiety <a href="https://drive.google.com/file/d/1jkRJwDGw6pcK9Jw7gjFmR2CrX0US2QWh/view?usp=share_link">dataset</a>, <code>group</code> the <code>Gender</code> and <code>name</code> fields, counting the number of responses in each group.</li>
<li>Comment on any issues you find with the data, the methodological or the calculations.</li>
<li>repeat this for <a href="https://drive.google.com/file/d/1jldvEU_IfLYO9vI-v3rNPSoVY-eSB3Ig/view?usp=share_link">Table 4</a> (HINT: you won’t be grouping by Gender this time!)</li>
<li>repeat this for <a href="https://drive.google.com/file/d/1rvqH1XhiBixMlqMpo13tJIG0oAg6_H37/view?usp=share_link">Table 5</a>
</li>
</ul>
<p>Now you have had a brief explore of the data we need to conduct some chi-square tests to check whether the results between groups are</p>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode cell-code" id="cb198"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb198-1"><a href="#cb198-1"></a><span class="co"># Load the csv files for the three tables</span></span>
<span id="cb198-2"><a href="#cb198-2"></a>loc<span class="ot">&lt;-</span><span class="st">"&lt;your HDD&gt;/anx_table_3.csv"</span></span>
<span id="cb198-3"><a href="#cb198-3"></a>anxiety_table_3 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(loc)</span>
<span id="cb198-4"><a href="#cb198-4"></a></span>
<span id="cb198-5"><a href="#cb198-5"></a>loc<span class="ot">&lt;-</span><span class="st">"&lt;your HDD&gt;/anx_table_4.csv"</span></span>
<span id="cb198-6"><a href="#cb198-6"></a>anxiety_table_4 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(loc)</span>
<span id="cb198-7"><a href="#cb198-7"></a></span>
<span id="cb198-8"><a href="#cb198-8"></a>loc<span class="ot">&lt;-</span><span class="st">"&lt;your HDD&gt;/anx_table_5.csv"</span></span>
<span id="cb198-9"><a href="#cb198-9"></a>anxiety_table_5 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(loc)</span>
<span id="cb198-10"><a href="#cb198-10"></a></span>
<span id="cb198-11"><a href="#cb198-11"></a></span>
<span id="cb198-12"><a href="#cb198-12"></a><span class="co"># This section gets the data into the correct format for the square test in R</span></span>
<span id="cb198-13"><a href="#cb198-13"></a><span class="co"># The Count tables are turned back into a long list of entries like this:</span></span>
<span id="cb198-14"><a href="#cb198-14"></a><span class="co"># A tibble: 120 × 2</span></span>
<span id="cb198-15"><a href="#cb198-15"></a><span class="co">#Gender name                 </span></span>
<span id="cb198-16"><a href="#cb198-16"></a><span class="co">#&lt;chr&gt;  &lt;chr&gt;                </span></span>
<span id="cb198-17"><a href="#cb198-17"></a><span class="co"># 1 Male   High level of anxiety</span></span>
<span id="cb198-18"><a href="#cb198-18"></a><span class="co"># 2 Male   High level of anxiety</span></span>
<span id="cb198-19"><a href="#cb198-19"></a><span class="co"># 3 Male   High level of anxiety</span></span>
<span id="cb198-20"><a href="#cb198-20"></a><span class="co">#</span></span>
<span id="cb198-21"><a href="#cb198-21"></a><span class="co"># That is done by </span></span>
<span id="cb198-22"><a href="#cb198-22"></a><span class="co"># 1) Select(-total) removes the total column which we don't need </span></span>
<span id="cb198-23"><a href="#cb198-23"></a><span class="co"># 2) filter(Gender !="Total") removes the row that stores totals</span></span>
<span id="cb198-24"><a href="#cb198-24"></a><span class="co">#    leaving just the rows storing actual data</span></span>
<span id="cb198-25"><a href="#cb198-25"></a><span class="co"># 3) pivot_longer turns the table into a long dataframe, -Gender</span></span>
<span id="cb198-26"><a href="#cb198-26"></a><span class="co">#    ignores/keeps the Gender column and converts all the other</span></span>
<span id="cb198-27"><a href="#cb198-27"></a><span class="co">#    columns into one column, with the heading and matching value </span></span>
<span id="cb198-28"><a href="#cb198-28"></a><span class="co">#    making up new rows</span></span>
<span id="cb198-29"><a href="#cb198-29"></a><span class="co"># 4) uncount turns the counts stored in value in the table into </span></span>
<span id="cb198-30"><a href="#cb198-30"></a><span class="co">#    individual entries, e.g. Male, No anxiety, 45 would create </span></span>
<span id="cb198-31"><a href="#cb198-31"></a><span class="co">#    45 rows with "Male, No anxiety"</span></span>
<span id="cb198-32"><a href="#cb198-32"></a></span>
<span id="cb198-33"><a href="#cb198-33"></a>anx_3 <span class="ot">&lt;-</span> Anxietytable3 <span class="sc">%&gt;%</span> </span>
<span id="cb198-34"><a href="#cb198-34"></a>  <span class="fu">select</span>(<span class="sc">-</span>Total) <span class="sc">%&gt;%</span> </span>
<span id="cb198-35"><a href="#cb198-35"></a>  <span class="fu">filter</span>(Gender <span class="sc">!=</span> <span class="st">"Total"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb198-36"><a href="#cb198-36"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>Gender) <span class="sc">%&gt;%</span> </span>
<span id="cb198-37"><a href="#cb198-37"></a>  <span class="fu">uncount</span>(value)</span>
<span id="cb198-38"><a href="#cb198-38"></a></span>
<span id="cb198-39"><a href="#cb198-39"></a>anx_4 <span class="ot">&lt;-</span> Anxietytable4 <span class="sc">%&gt;%</span> </span>
<span id="cb198-40"><a href="#cb198-40"></a>  <span class="fu">select</span>(<span class="sc">-</span>Total) <span class="sc">%&gt;%</span> </span>
<span id="cb198-41"><a href="#cb198-41"></a>  <span class="fu">filter</span>(Age <span class="sc">!=</span> <span class="st">"Total"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb198-42"><a href="#cb198-42"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>Age) <span class="sc">%&gt;%</span> </span>
<span id="cb198-43"><a href="#cb198-43"></a>  <span class="fu">uncount</span>(value)</span>
<span id="cb198-44"><a href="#cb198-44"></a></span>
<span id="cb198-45"><a href="#cb198-45"></a>anx_5 <span class="ot">&lt;-</span> Anxietytable5 <span class="sc">%&gt;%</span> </span>
<span id="cb198-46"><a href="#cb198-46"></a>  <span class="fu">select</span>(<span class="sc">-</span>Total) <span class="sc">%&gt;%</span> </span>
<span id="cb198-47"><a href="#cb198-47"></a>  <span class="fu">filter</span>(HomeLang <span class="sc">!=</span> <span class="st">"Total"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb198-48"><a href="#cb198-48"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>HomeLang) <span class="sc">%&gt;%</span> </span>
<span id="cb198-49"><a href="#cb198-49"></a>  <span class="fu">uncount</span>(value)</span>
<span id="cb198-50"><a href="#cb198-50"></a></span>
<span id="cb198-51"><a href="#cb198-51"></a><span class="co"># save long dataframes</span></span>
<span id="cb198-52"><a href="#cb198-52"></a><span class="co"># write.csv(anx_3, glue("{loc_amy}Amy/anx_table_3.csv"), row.names = FALSE)</span></span>
<span id="cb198-53"><a href="#cb198-53"></a><span class="co"># write.csv(anx_4, glue("{loc_amy}Amy/anx_table_4.csv"), row.names = FALSE)</span></span>
<span id="cb198-54"><a href="#cb198-54"></a><span class="co"># write.csv(anx_5, glue("{loc_amy}Amy/anx_table_5.csv"), row.names = FALSE)</span></span>
<span id="cb198-55"><a href="#cb198-55"></a></span>
<span id="cb198-56"><a href="#cb198-56"></a><span class="co"># conduct chi-square tests</span></span>
<span id="cb198-57"><a href="#cb198-57"></a><span class="fu">chisq.test</span>(anx_3<span class="sc">$</span>Gender, anx_3<span class="sc">$</span>name)</span>
<span id="cb198-58"><a href="#cb198-58"></a><span class="fu">chisq.test</span>(anx_4<span class="sc">$</span>Age, anx_4<span class="sc">$</span>name)</span>
<span id="cb198-59"><a href="#cb198-59"></a><span class="fu">chisq.test</span>(anx_5<span class="sc">$</span>HomeLang, anx_5<span class="sc">$</span>name)</span>
<span id="cb198-60"><a href="#cb198-60"></a></span>
<span id="cb198-61"><a href="#cb198-61"></a><span class="co"># conduct - Kruskal-Wallis tests</span></span>
<span id="cb198-62"><a href="#cb198-62"></a><span class="fu">kruskal.test</span>(anx_3<span class="sc">$</span>Gender, anx_3<span class="sc">$</span>name)</span>
<span id="cb198-63"><a href="#cb198-63"></a><span class="fu">kruskal.test</span> (anx_4<span class="sc">$</span>Age, anx_4<span class="sc">$</span>name)</span>
<span id="cb198-64"><a href="#cb198-64"></a><span class="fu">kruskal.test</span> (anx_5<span class="sc">$</span>HomeLang, anx_5<span class="sc">$</span>name)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="activity-2--determine-if-admissions-type-in-las-are-proportionate-to-national-averages" class="level3" data-number="6.7.2"><h3 data-number="6.7.2" class="anchored" data-anchor-id="activity-2--determine-if-admissions-type-in-las-are-proportionate-to-national-averages">
<span class="header-section-number">6.7.2</span> Activity 2- Determine if admissions type in LAs are proportionate to national averages</h3>
<p>Looking at the <a href="https://drive.google.com/uc?export=download&amp;id=1tp9xe3dS__eg7RrXf0T_oMxcrz_TbMdM">DfE Data set</a>, choose a Local Authority (I suggest Dorset) and determine if the proportion of selective and non-selective schools are statistically similar or different to the national average. Comment on any potential issues with the data or the approach.</p>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode cell-code" id="cb199"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb199-1"><a href="#cb199-1"></a><span class="co"># Task 2</span></span>
<span id="cb199-2"><a href="#cb199-2"></a><span class="co"># Load the file for the task</span></span>
<span id="cb199-3"><a href="#cb199-3"></a>loc<span class="ot">&lt;-</span><span class="st">"https://drive.google.com/uc?export=download&amp;id=1tp9xe3dS__eg7RrXf0T_oMxcrz_TbMdM"</span></span>
<span id="cb199-4"><a href="#cb199-4"></a>DfE_schools_2018 <span class="ot">&lt;-</span> <span class="fu">read.xlsx</span>(loc,<span class="at">sheet=</span><span class="st">"Schools"</span>)</span>
<span id="cb199-5"><a href="#cb199-5"></a><span class="co"># Create a dataframe of the admission policies of Dorset schools</span></span>
<span id="cb199-6"><a href="#cb199-6"></a>DorsetschAd<span class="ot">&lt;-</span>DfE_schools_2018 <span class="sc">%&gt;%</span></span>
<span id="cb199-7"><a href="#cb199-7"></a>  <span class="fu">select</span>(LA,AdmissionsPolicy)<span class="sc">%&gt;%</span></span>
<span id="cb199-8"><a href="#cb199-8"></a>  <span class="fu">filter</span>(LA<span class="sc">==</span><span class="st">"Dorset"</span>)</span>
<span id="cb199-9"><a href="#cb199-9"></a><span class="co"># Create a dataframe of the admission policies of all non-Dorset schools (note LA! means</span></span>
<span id="cb199-10"><a href="#cb199-10"></a><span class="co"># not equal to)</span></span>
<span id="cb199-11"><a href="#cb199-11"></a>OtherUKSch<span class="ot">&lt;-</span>DfE_schools_2018 <span class="sc">%&gt;%</span></span>
<span id="cb199-12"><a href="#cb199-12"></a>  <span class="fu">select</span>(LA,AdmissionsPolicy)<span class="sc">%&gt;%</span></span>
<span id="cb199-13"><a href="#cb199-13"></a>  <span class="fu">filter</span>(LA<span class="sc">!=</span><span class="st">"Dorset"</span>)</span>
<span id="cb199-14"><a href="#cb199-14"></a><span class="co"># OtherUKSchs are labelled by LA so reset all these names just to UK</span></span>
<span id="cb199-15"><a href="#cb199-15"></a>OtherUKSch<span class="sc">$</span>LA<span class="ot">&lt;-</span><span class="st">"UK"</span></span>
<span id="cb199-16"><a href="#cb199-16"></a><span class="co"># Join the two frames to give one long list</span></span>
<span id="cb199-17"><a href="#cb199-17"></a>AllSch<span class="ot">&lt;-</span><span class="fu">rbind</span>(OtherUKSch, DorsetschAd)</span>
<span id="cb199-18"><a href="#cb199-18"></a><span class="co"># To check what test to do print the frequency table</span></span>
<span id="cb199-19"><a href="#cb199-19"></a><span class="fu">table</span>(AllSch)</span>
<span id="cb199-20"><a href="#cb199-20"></a><span class="co"># And a percentage version</span></span>
<span id="cb199-21"><a href="#cb199-21"></a>(<span class="dv">100</span><span class="sc">*</span><span class="fu">prop.table</span>(<span class="fu">table</span>(AllSch)))</span>
<span id="cb199-22"><a href="#cb199-22"></a><span class="co"># Expected values are fine so use the Chi squared test</span></span>
<span id="cb199-23"><a href="#cb199-23"></a><span class="co"># AdmissionsPolicy</span></span>
<span id="cb199-24"><a href="#cb199-24"></a><span class="co"># LA       Non-selective Not applicable    Selective</span></span>
<span id="cb199-25"><a href="#cb199-25"></a><span class="co"># Dorset   0.059974356    0.349505729  0.006204244</span></span>
<span id="cb199-26"><a href="#cb199-26"></a><span class="co"># UK      16.075195434   81.718161889  1.790958349</span></span>
<span id="cb199-27"><a href="#cb199-27"></a><span class="co"># Note </span></span>
<span id="cb199-28"><a href="#cb199-28"></a><span class="fu">chisq.test</span>(AllSch<span class="sc">$</span>LA, AllSch<span class="sc">$</span>AdmissionsPolicy, <span class="at">simulate.p.value =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="activity-3--determine-if-ofsted-rating-and-gender-of-school-are-independent" class="level3" data-number="6.7.3"><h3 data-number="6.7.3" class="anchored" data-anchor-id="activity-3--determine-if-ofsted-rating-and-gender-of-school-are-independent">
<span class="header-section-number">6.7.3</span> Activity 3- Determine if Ofsted rating and gender of school are independent</h3>
<p>Looking again at the DfE Data set, compare Ofsted rating of the school against gender to determine if these are independent or not. You may wish to focus on a particular phase (such as secondary) and only include certain Ofsted ratings. Comment on any issues with the data.</p>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode cell-code" id="cb200"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb200-1"><a href="#cb200-1"></a><span class="co"># Is there a relationship between school gender and Ofsted Rating?</span></span>
<span id="cb200-2"><a href="#cb200-2"></a></span>
<span id="cb200-3"><a href="#cb200-3"></a><span class="fu">chisq.test</span>(DfE_schools_2018<span class="sc">$</span>Gender,DfE_schools_2018<span class="sc">$</span>OfstedRating, <span class="at">simulate.p.value =</span> <span class="cn">TRUE</span>)</span>
<span id="cb200-4"><a href="#cb200-4"></a><span class="co"># Yes!</span></span>
<span id="cb200-5"><a href="#cb200-5"></a><span class="co"># Pearson's Chi-squared test with simulated p-value (based on 2000 replicates)</span></span>
<span id="cb200-6"><a href="#cb200-6"></a><span class="co">#</span></span>
<span id="cb200-7"><a href="#cb200-7"></a><span class="co"># data:  DfE_schools_2018$Gender and DfE_schools_2018$OfstedRating</span></span>
<span id="cb200-8"><a href="#cb200-8"></a><span class="co"># X-squared = 675.4, df = NA, p-value = 0.0004998</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="activity-4--create-your-own-problem" class="level3" data-number="6.7.4"><h3 data-number="6.7.4" class="anchored" data-anchor-id="activity-4--create-your-own-problem">
<span class="header-section-number">6.7.4</span> Activity 4- Create your own problem</h3>
<p>Using the DfE Data set (or otherwise), create a research question which requires one of the chi-square tests to answer the question. State clearly what your null and alternative hypothesis are, what you are using as the significance level, what the chi-square calc and/or p-values for the test are, what conclusion you make, and any issues you think there are with the test.</p>
</section><section id="doing-chi-square-tests-in-r" class="level3" data-number="6.7.5"><h3 data-number="6.7.5" class="anchored" data-anchor-id="doing-chi-square-tests-in-r">
<span class="header-section-number">6.7.5</span> Doing Chi-Square tests in R</h3>
<iframe width="560" height="315" src="https://www.youtube.com/embed/qnZX0G1M29E" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="">
</iframe>
<p>You can find the code used in the video below</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb201"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb201-1"><a href="#cb201-1"></a><span class="co"># Introduction to Chi-square</span></span>
<span id="cb201-2"><a href="#cb201-2"></a><span class="co">#</span></span>
<span id="cb201-3"><a href="#cb201-3"></a><span class="co"># Download data from /Users/k1765032/Library/CloudStorage/GoogleDrive-richardandrewbrock@gmail.com/.shortcut-targets-by-id/1c3CkaEBOICzepArDfjQUP34W2BYhFjM4/PISR/Data/PISA/subset/Students_2018_RBDP_none_levels.rds</span></span>
<span id="cb201-4"><a href="#cb201-4"></a><span class="co"># You want the file: Students_2018_RBDP_none_levels.rds</span></span>
<span id="cb201-5"><a href="#cb201-5"></a><span class="co"># and place in your own file system</span></span>
<span id="cb201-6"><a href="#cb201-6"></a><span class="co"># change loc to load the data directly. Loading into R might take a few minutes</span></span>
<span id="cb201-7"><a href="#cb201-7"></a></span>
<span id="cb201-8"><a href="#cb201-8"></a>loc <span class="ot">&lt;-</span> <span class="st">"https://drive.google.com/open?id=14pL2Bz677Kk5_nn9BTmEuuUGY9S09bDb&amp;authuser=richardandrewbrock%40gmail.com&amp;usp=drive_fs"</span></span>
<span id="cb201-9"><a href="#cb201-9"></a>PISA_2018 <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(loc)</span>
<span id="cb201-10"><a href="#cb201-10"></a></span>
<span id="cb201-11"><a href="#cb201-11"></a><span class="co"># Are there differences between how often students change school?</span></span>
<span id="cb201-12"><a href="#cb201-12"></a><span class="co"># ST004D01T is the gender variable (Male, Female)</span></span>
<span id="cb201-13"><a href="#cb201-13"></a><span class="co"># SCCHANGE is a categorical variable (No change / One change / Two or more changes)</span></span>
<span id="cb201-14"><a href="#cb201-14"></a></span>
<span id="cb201-15"><a href="#cb201-15"></a>chidata <span class="ot">&lt;-</span> PISA_2018 <span class="sc">%&gt;%</span></span>
<span id="cb201-16"><a href="#cb201-16"></a>  <span class="fu">select</span>(CNT,ST004D01T,SCCHANGE) <span class="sc">%&gt;%</span></span>
<span id="cb201-17"><a href="#cb201-17"></a>  <span class="fu">filter</span>(CNT<span class="sc">==</span><span class="st">"United Kingdom"</span>)</span>
<span id="cb201-18"><a href="#cb201-18"></a></span>
<span id="cb201-19"><a href="#cb201-19"></a>chidata<span class="ot">&lt;-</span>chidata[<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span>)]</span>
<span id="cb201-20"><a href="#cb201-20"></a>chidata<span class="ot">&lt;-</span><span class="fu">drop_na</span>(chidata)</span>
<span id="cb201-21"><a href="#cb201-21"></a></span>
<span id="cb201-22"><a href="#cb201-22"></a> chidata <span class="ot">&lt;-</span> PISA_2018 <span class="sc">%&gt;%</span></span>
<span id="cb201-23"><a href="#cb201-23"></a>   <span class="fu">filter</span>(CNT<span class="sc">==</span><span class="st">"United Kingdom"</span>)</span>
<span id="cb201-24"><a href="#cb201-24"></a>   <span class="fu">select</span>(ST004D01T,SCCHANGE) <span class="sc">%&gt;%</span> </span>
<span id="cb201-25"><a href="#cb201-25"></a>   <span class="fu">drop_na</span>()</span>
<span id="cb201-26"><a href="#cb201-26"></a><span class="co"># Above is the approiach I took in the video</span></span>
<span id="cb201-27"><a href="#cb201-27"></a><span class="co"># An alternative, Pete suggests, which is more elegant, is below</span></span>
<span id="cb201-28"><a href="#cb201-28"></a><span class="co"># Note he drops the country varibale, within the piped section</span></span>
<span id="cb201-29"><a href="#cb201-29"></a><span class="co"># using: elect(-CNT)</span></span>
<span id="cb201-30"><a href="#cb201-30"></a><span class="co">#    </span></span>
<span id="cb201-31"><a href="#cb201-31"></a><span class="co"># chidata &lt;- PISA_2018 %&gt;%</span></span>
<span id="cb201-32"><a href="#cb201-32"></a><span class="co">#   select(CNT,ST004D01T,SCCHANGE) %&gt;%</span></span>
<span id="cb201-33"><a href="#cb201-33"></a><span class="co">#   filter(CNT=="United Kingdom") %&gt;%</span></span>
<span id="cb201-34"><a href="#cb201-34"></a><span class="co">#   select(-CNT) %&gt;% </span></span>
<span id="cb201-35"><a href="#cb201-35"></a><span class="co">#   drop_na()</span></span>
<span id="cb201-36"><a href="#cb201-36"></a></span>
<span id="cb201-37"><a href="#cb201-37"></a><span class="co"># run the test</span></span>
<span id="cb201-38"><a href="#cb201-38"></a><span class="fu">chisq.test</span>(chidata<span class="sc">$</span>ST004D01T, chidata<span class="sc">$</span>SCCHANGE)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>```</p>
</section></section></section><section id="inquiry-learning-in-science" class="level1" data-number="7"><h1 data-number="7">
<span class="header-section-number">7</span> Inquiry learning in science</h1>
<div class="cell">

</div>
<!--https://www.r-bloggers.com/2022/01/how-to-perform-eta-squared-in-r/-->
<div class="cell">
<details><summary>inquiry preparation code</summary><div class="sourceCode cell-code" id="cb202"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb202-1"><a href="#cb202-1"></a><span class="co"># mapping used</span></span>
<span id="cb202-2"><a href="#cb202-2"></a><span class="co"># c(1 = "In all lessons",</span></span>
<span id="cb202-3"><a href="#cb202-3"></a><span class="co">#  2 = "In most lessons",</span></span>
<span id="cb202-4"><a href="#cb202-4"></a><span class="co">#  3 = "In some lessons",</span></span>
<span id="cb202-5"><a href="#cb202-5"></a><span class="co">#  4 = "Never or hardly ever",</span></span>
<span id="cb202-6"><a href="#cb202-6"></a><span class="co">#  NA = "Valid Skip",</span></span>
<span id="cb202-7"><a href="#cb202-7"></a><span class="co">#  NA = "Not Reached",</span></span>
<span id="cb202-8"><a href="#cb202-8"></a><span class="co">#  NA = "Not Applicable",</span></span>
<span id="cb202-9"><a href="#cb202-9"></a><span class="co">#  NA = "Invalid",</span></span>
<span id="cb202-10"><a href="#cb202-10"></a><span class="co">#  NA = "No Response")</span></span>
<span id="cb202-11"><a href="#cb202-11"></a></span>
<span id="cb202-12"><a href="#cb202-12"></a>inquiry_data <span class="ot">&lt;-</span> PISA_2015 <span class="sc">%&gt;%</span></span>
<span id="cb202-13"><a href="#cb202-13"></a>  <span class="fu">select</span>(ST098Q10NA, ST098Q07TA, ST098Q05TA, </span>
<span id="cb202-14"><a href="#cb202-14"></a>         ST098Q02TA, PV1SCIE, IBTEACH, TDTEACH) <span class="sc">%&gt;%</span></span>
<span id="cb202-15"><a href="#cb202-15"></a>  <span class="fu">mutate</span>(<span class="at">ST098Q10NA =</span> <span class="fu">as.numeric</span>(ST098Q10NA),</span>
<span id="cb202-16"><a href="#cb202-16"></a>         <span class="at">ST098Q07TA =</span> <span class="fu">as.numeric</span>(ST098Q07TA),</span>
<span id="cb202-17"><a href="#cb202-17"></a>         <span class="at">ST098Q05TA =</span> <span class="fu">as.numeric</span>(ST098Q05TA),</span>
<span id="cb202-18"><a href="#cb202-18"></a>         <span class="at">ST098Q02TA =</span> <span class="fu">as.numeric</span>(ST098Q02TA)) <span class="sc">%&gt;%</span></span>
<span id="cb202-19"><a href="#cb202-19"></a>  <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span></span>
<span id="cb202-20"><a href="#cb202-20"></a>    <span class="fu">mutate</span>(<span class="at">inquiry_components =</span>  <span class="fu">ifelse</span>(</span>
<span id="cb202-21"><a href="#cb202-21"></a>                ST098Q10NA <span class="sc">&gt;</span> <span class="dv">2</span> <span class="sc">&amp;</span> ST098Q07TA <span class="sc">&gt;</span> <span class="dv">2</span> <span class="sc">&amp;</span> ST098Q05TA <span class="sc">&gt;</span> <span class="dv">2</span> <span class="sc">&amp;</span> ST098Q02TA <span class="sc">&gt;</span> <span class="dv">2</span>, <span class="st">"N"</span>,</span>
<span id="cb202-22"><a href="#cb202-22"></a>              <span class="fu">ifelse</span>(</span>
<span id="cb202-23"><a href="#cb202-23"></a>                ST098Q10NA <span class="sc">&gt;</span> <span class="dv">2</span> <span class="sc">&amp;</span> ST098Q07TA <span class="sc">&gt;</span> <span class="dv">2</span> <span class="sc">&amp;</span> ST098Q05TA <span class="sc">&gt;</span> <span class="dv">2</span> <span class="sc">&amp;</span> ST098Q02TA <span class="sc">&lt;</span> <span class="dv">3</span>, <span class="st">"A"</span>,</span>
<span id="cb202-24"><a href="#cb202-24"></a>              <span class="fu">ifelse</span>(</span>
<span id="cb202-25"><a href="#cb202-25"></a>                ST098Q10NA <span class="sc">&gt;</span> <span class="dv">2</span> <span class="sc">&amp;</span> ST098Q07TA <span class="sc">&gt;</span> <span class="dv">2</span> <span class="sc">&amp;</span> ST098Q05TA <span class="sc">&lt;</span> <span class="dv">3</span> <span class="sc">&amp;</span> ST098Q02TA <span class="sc">&lt;</span> <span class="dv">3</span>, <span class="st">"C"</span>,</span>
<span id="cb202-26"><a href="#cb202-26"></a>              <span class="fu">ifelse</span>(</span>
<span id="cb202-27"><a href="#cb202-27"></a>                ST098Q10NA <span class="sc">&gt;</span> <span class="dv">2</span> <span class="sc">&amp;</span> ST098Q07TA <span class="sc">&lt;</span> <span class="dv">3</span> <span class="sc">&amp;</span> ST098Q05TA <span class="sc">&lt;</span> <span class="dv">3</span> <span class="sc">&amp;</span> ST098Q02TA <span class="sc">&lt;</span> <span class="dv">3</span>, <span class="st">"I"</span>,</span>
<span id="cb202-28"><a href="#cb202-28"></a>              <span class="fu">ifelse</span>(</span>
<span id="cb202-29"><a href="#cb202-29"></a>                ST098Q10NA <span class="sc">&lt;</span> <span class="dv">3</span> <span class="sc">&amp;</span> ST098Q07TA <span class="sc">&lt;</span> <span class="dv">3</span> <span class="sc">&amp;</span> ST098Q05TA <span class="sc">&lt;</span> <span class="dv">3</span> <span class="sc">&amp;</span> ST098Q02TA <span class="sc">&lt;</span> <span class="dv">3</span>, <span class="st">"Q"</span>,</span>
<span id="cb202-30"><a href="#cb202-30"></a>              <span class="dv">99</span>)))))) <span class="sc">%&gt;%</span></span>
<span id="cb202-31"><a href="#cb202-31"></a>  <span class="fu">mutate</span>(<span class="at">inquiry_components =</span> <span class="fu">as.factor</span>(inquiry_components)) <span class="sc">%&gt;%</span></span>
<span id="cb202-32"><a href="#cb202-32"></a>  <span class="fu">filter</span>(inquiry_components <span class="sc">!=</span> <span class="st">"99"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="running-the-test" class="level2" data-number="7.1"><h2 data-number="7.1" class="anchored" data-anchor-id="running-the-test">
<span class="header-section-number">7.1</span> Running the test</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb203"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb203-1"><a href="#cb203-1"></a>res_aov <span class="ot">&lt;-</span> <span class="fu">aov</span>(PV1SCIE <span class="sc">~</span> inquiry_components,</span>
<span id="cb203-2"><a href="#cb203-2"></a>               <span class="at">data =</span> inquiry_data)</span>
<span id="cb203-3"><a href="#cb203-3"></a></span>
<span id="cb203-4"><a href="#cb203-4"></a><span class="fu">summary</span>(res_aov)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                       Df    Sum Sq  Mean Sq F value Pr(&gt;F)    
inquiry_components      4 1.563e+08 39086096    4161 &lt;2e-16 ***
Residuals          250922 2.357e+09     9393                   
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb205"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb205-1"><a href="#cb205-1"></a><span class="fu">TukeyHSD</span>(res_aov)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Tukey multiple comparisons of means
    95% family-wise confidence level

Fit: aov(formula = PV1SCIE ~ inquiry_components, data = inquiry_data)

$inquiry_components
         diff       lwr        upr p adj
C-A  43.60278  39.91980  47.285765     0
I-A -30.38961 -35.31026 -25.468963     0
N-A  25.60709  22.48822  28.725951     0
Q-A -42.80561 -46.19298 -39.418240     0
I-C -73.99239 -78.35836 -69.626429     0
N-C -17.99570 -20.13490 -15.856492     0
Q-C -86.40840 -88.92299 -83.893803     0
N-I  55.99670  52.09482  59.898570     0
Q-I -12.41600 -16.53566  -8.296343     0
Q-N -68.41270 -69.98945 -66.835952     0</code></pre>
</div>
</div>
<section id="reporting-the-test" class="level3" data-number="7.1.1"><h3 data-number="7.1.1" class="anchored" data-anchor-id="reporting-the-test">
<span class="header-section-number">7.1.1</span> Reporting the test</h3>
<p>To put the ANOVA and Tukey tests in a format for reporting we can use the <code>easystats</code> package. Easystats is a collection of tools to help you statistically analyse data and present your findings. One you have installed and loaded <code>easystats</code> you can then use the <code>report(&lt;stats_model&gt;)</code> command to format your results for a paper you are writing:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb207"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb207-1"><a href="#cb207-1"></a><span class="fu">install.packages</span>(<span class="st">"easystats"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'easystats' is in use and will not be installed</code></pre>
</div>
<div class="sourceCode cell-code" id="cb209"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb209-1"><a href="#cb209-1"></a><span class="fu">library</span>(<span class="st">"easystats"</span>) <span class="co"># Load the package every time you want to use these tools</span></span>
<span id="cb209-2"><a href="#cb209-2"></a></span>
<span id="cb209-3"><a href="#cb209-3"></a><span class="fu">report</span>(res_aov)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Could not find Sum-of-Squares for the (Intercept) in the ANOVA table.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>The ANOVA (formula: PV1SCIE ~ inquiry_components) suggests that:

  - The main effect of inquiry_components is statistically significant and medium
(F(4, 250922) = 4161.08, p &lt; .001; Eta2 = 0.06, 95% CI [0.07, 1.00])

Effect sizes were labelled following Field's (2013) recommendations.</code></pre>
</div>
</div>
</section><section id="plotting-the-results" class="level3" data-number="7.1.2"><h3 data-number="7.1.2" class="anchored" data-anchor-id="plotting-the-results">
<span class="header-section-number">7.1.2</span> Plotting the results</h3>
<ul>
<li>Explain how to understand this</li>
<li>Could we have a ggplot version of this?</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb212"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb212-1"><a href="#cb212-1"></a><span class="fu">plot</span>(<span class="fu">TukeyHSD</span>(res_aov))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-150-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section><section id="post-tests-function" class="level3" data-number="7.1.3"><h3 data-number="7.1.3" class="anchored" data-anchor-id="post-tests-function">
<span class="header-section-number">7.1.3</span> Post tests function</h3>
<p>Explanation needed here</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb213"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb213-1"><a href="#cb213-1"></a><span class="fu">library</span>(multcomp)</span>
<span id="cb213-2"><a href="#cb213-2"></a><span class="co"># Tukey HSD test:</span></span>
<span id="cb213-3"><a href="#cb213-3"></a>post_test <span class="ot">&lt;-</span> <span class="fu">glht</span>(res_aov,</span>
<span id="cb213-4"><a href="#cb213-4"></a>                  <span class="at">linfct =</span> <span class="fu">mcp</span>(<span class="at">inquiry_components =</span> <span class="st">"Tukey"</span>))</span>
<span id="cb213-5"><a href="#cb213-5"></a><span class="fu">summary</span>(post_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
     Simultaneous Tests for General Linear Hypotheses

Multiple Comparisons of Means: Tukey Contrasts


Fit: aov(formula = PV1SCIE ~ inquiry_components, data = inquiry_data)

Linear Hypotheses:
           Estimate Std. Error  t value Pr(&gt;|t|)    
C - A == 0  43.6028     1.3502   32.294   &lt;1e-10 ***
I - A == 0 -30.3896     1.8039  -16.847   &lt;1e-10 ***
N - A == 0  25.6071     1.1434   22.396   &lt;1e-10 ***
Q - A == 0 -42.8056     1.2418  -34.470   &lt;1e-10 ***
I - C == 0 -73.9924     1.6006  -46.229   &lt;1e-10 ***
N - C == 0 -17.9957     0.7842  -22.947   &lt;1e-10 ***
Q - C == 0 -86.4084     0.9218  -93.734   &lt;1e-10 ***
N - I == 0  55.9967     1.4304   39.147   &lt;1e-10 ***
 [ reached getOption("max.print") -- omitted 2 rows ]
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
(Adjusted p values reported -- single-step method)</code></pre>
</div>
</div>
</section><section id="eta-squared" class="level3" data-number="7.1.4"><h3 data-number="7.1.4" class="anchored" data-anchor-id="eta-squared">
<span class="header-section-number">7.1.4</span> Eta squared</h3>
<p>Explanation needed here</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb215"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb215-1"><a href="#cb215-1"></a><span class="fu">library</span>(lsr)</span>
<span id="cb215-2"><a href="#cb215-2"></a><span class="fu">etaSquared</span>(res_aov)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                       eta.sq eta.sq.part
inquiry_components 0.06220631  0.06220631</code></pre>
</div>
</div>
</section></section><section id="seminar-tasks-2" class="level2" data-number="7.2"><h2 data-number="7.2" class="anchored" data-anchor-id="seminar-tasks-2">
<span class="header-section-number">7.2</span> Seminar tasks</h2>
<section id="activity-1-run-anova-tests-exploring" class="level3" data-number="7.2.1"><h3 data-number="7.2.1" class="anchored" data-anchor-id="activity-1-run-anova-tests-exploring">
<span class="header-section-number">7.2.1</span> Activity 1: run ANOVA tests exploring…</h3>
<p>Need to set something simple for them to do here</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb217"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb217-1"><a href="#cb217-1"></a><span class="co"># code solution to go here</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="activity-2-prepare-for-and-run-tukey-hsd-post-hoc-test-with-summary-and-plot-of-which-contrasts-between-levels-are-statistically-significant" class="level3" data-number="7.2.2"><h3 data-number="7.2.2" class="anchored" data-anchor-id="activity-2-prepare-for-and-run-tukey-hsd-post-hoc-test-with-summary-and-plot-of-which-contrasts-between-levels-are-statistically-significant">
<span class="header-section-number">7.2.2</span> Activity 2: prepare for and run Tukey HSD post hoc test with summary and plot of which contrasts between levels are statistically significant</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb218"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb218-1"><a href="#cb218-1"></a><span class="co"># code solution to go here</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="activity-3" class="level3" data-number="7.2.3"><h3 data-number="7.2.3" class="anchored" data-anchor-id="activity-3">
<span class="header-section-number">7.2.3</span> Activity 3</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb219"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb219-1"><a href="#cb219-1"></a><span class="co"># code solution to go here</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section></section><section id="science-capital" class="level1" data-number="8"><h1 data-number="8">
<span class="header-section-number">8</span> Science capital</h1>
<section id="writing-a-quantitative-report" class="level2" data-number="8.1"><h2 data-number="8.1" class="anchored" data-anchor-id="writing-a-quantitative-report">
<span class="header-section-number">8.1</span> Writing a Quantitative Report</h2>
<p>In the lecture you looked at <span class="citation" data-cites="du2019science">Du and Wong (<a href="#ref-du2019science" role="doc-biblioref">2019</a>)</span> as an example of a quantitative report. This session will help you structure your writing for your own quantitative report in assignment 3.</p>
<section id="activity-1-proposing-a-question" class="level3" data-number="8.1.1"><h3 data-number="8.1.1" class="anchored" data-anchor-id="activity-1-proposing-a-question">
<span class="header-section-number">8.1.1</span> Activity 1: Proposing a question</h3>
<ol type="a">
<li><p>Spend 10 minutes researching a problem (this can’t be extensive but find something that is flagged as requiring more research). Alternatively, you make already have a problem, in which case move onto the next step</p></li>
<li>
<p>State a rough research problem:</p>
<p>e.g., There is an imbalance in the number of students studying a-level biology (i.e., too few boys)</p>
</li>
<li>
<p>Turn the problem into a question:</p>
<p>e.g., What school features correlate with higher and lower level of male uptake of a-level biology?</p>
</li>
<li>
<p>Increase the specificity of the question:</p>
<p>e.g., In DfE school census data for the period 2017-2022 what school variables (including number of biology teachers, uptake of GCSE triple science, % of FSM students etc.) correlate with higher and lower level of male uptake of a-level biology?</p>
</li>
</ol></section><section id="activity-2-find-a-data-set-and-check-its-applicability" class="level3" data-number="8.1.2"><h3 data-number="8.1.2" class="anchored" data-anchor-id="activity-2-find-a-data-set-and-check-its-applicability">
<span class="header-section-number">8.1.2</span> Activity 2: Find a data set and check its applicability</h3>
<ul>
<li>Use the list of open data sets to choose an appropriate data set</li>
<li>Does it include all the data to answer your question? Which items will you use in your analysis? What form is the data you will use in?</li>
<li>What form of cleaning will the data require?</li>
<li>Will you need to draw on multiple data sets?</li>
</ul></section><section id="activity-3-decide-on-approaches-to-analysis" class="level3" data-number="8.1.3"><h3 data-number="8.1.3" class="anchored" data-anchor-id="activity-3-decide-on-approaches-to-analysis">
<span class="header-section-number">8.1.3</span> Activity 3: Decide on approaches to analysis</h3>
<ul>
<li>What types of data are relevant to your questions (continuous, discontinuous?)</li>
<li>What types of test will you need to run?</li>
<li>What kind of descriptive statistics will be useful?</li>
</ul></section><section id="activity-4-sketch-a-research-plan" class="level3" data-number="8.1.4"><h3 data-number="8.1.4" class="anchored" data-anchor-id="activity-4-sketch-a-research-plan">
<span class="header-section-number">8.1.4</span> Activity 4: Sketch a research plan</h3>
<ul>
<li>When will you finalize your question?</li>
<li>When will you carry out your data analysis?</li>
<li>When will you write up?</li>
<li>What help will you need?</li>
<li>How can you collaborate with peers?</li>
<li>What R/SPSS/Excel skills do you need to acquire?</li>
</ul></section></section></section><section id="selecting-the-correct-statistical-tool" class="level1" data-number="9"><h1 data-number="9">
<span class="header-section-number">9</span> Selecting the correct statistical tool</h1>
<div class="cell">

</div>
<section id="choosing-appropriate-quantitative-tests" class="level2" data-number="9.1"><h2 data-number="9.1" class="anchored" data-anchor-id="choosing-appropriate-quantitative-tests">
<span class="header-section-number">9.1</span> Choosing appropriate quantitative tests</h2>
<p>In the lecture, this flow chart was introduced:</p>
<p><embed src="chapters/images/011%20Selecting%20a%20test-01.pdf" style="width:20cm;height:15cm"></p>
<p>That chart will help you choose the test to use for the tasks below.</p>
</section><section id="seminar-tasks-3" class="level2" data-number="9.2"><h2 data-number="9.2" class="anchored" data-anchor-id="seminar-tasks-3">
<span class="header-section-number">9.2</span> Seminar Tasks</h2>
<p>Use the reduced <a href="https://drive.google.com/open?id=1goZwdHOrwW70-zqQpOK-9NvxI1qowRxT&amp;authuser=richardandrewbrock%40gmail.com&amp;usp=drive_fs">PISA 2018 dataset</a></p>
<p>We will store the location of the file in loc and then use read-rds to import the file. This is a cut down version of the PISA 2018 student dataset.</p>
<p>Load the data from there dataset:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb220"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb220-1"><a href="#cb220-1"></a><span class="fu">install.packages</span>(<span class="st">"tidyverse"</span>)</span>
<span id="cb220-2"><a href="#cb220-2"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb220-3"><a href="#cb220-3"></a></span>
<span id="cb220-4"><a href="#cb220-4"></a><span class="co"># Download data from /Users/k1765032/Library/CloudStorage/GoogleDrive-richardandrewbrock@gmail.com/.shortcut-targets-by-id/1c3CkaEBOICzepArDfjQUP34W2BYhFjM4/PISR/Data/PISA/subset/Students_2018_RBDP_none_levels.rds</span></span>
<span id="cb220-5"><a href="#cb220-5"></a><span class="co"># You want the file: Students_2018_RBDP_none_levels.rds</span></span>
<span id="cb220-6"><a href="#cb220-6"></a><span class="co"># and place in your own file system</span></span>
<span id="cb220-7"><a href="#cb220-7"></a><span class="co"># change loc to load the data directly. Loading into R might take a few minutes</span></span>
<span id="cb220-8"><a href="#cb220-8"></a></span>
<span id="cb220-9"><a href="#cb220-9"></a>loc <span class="ot">&lt;-</span> <span class="st">"/Users/k1765032/Library/CloudStorage/GoogleDrive-richardandrewbrock@gmail.com/.shortcut-targets-by-id/1c3CkaEBOICzepArDfjQUP34W2BYhFjM4/PISR/Data/PISA/subset/Students_2018_RBDP_none_levels.rds"</span></span>
<span id="cb220-10"><a href="#cb220-10"></a> PISA_2018 <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(loc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="task-1-plot-a-graph-of-mean-science-scores-by-country" class="level3" data-number="9.2.1"><h3 data-number="9.2.1" class="anchored" data-anchor-id="task-1-plot-a-graph-of-mean-science-scores-by-country">
<span class="header-section-number">9.2.1</span> Task 1 Plot a graph of mean science scores by country</h3>
<p>Imagine we wish to compare the mean scores of students on the science element of PISA by plotting a bar graph. First you need to use the <code>sumarise</code> function to calculate means by countries. Then use ggplot with <code>geom_col</code> to create the graph.</p>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode cell-code" id="cb221"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb221-1"><a href="#cb221-1"></a><span class="co"># Task 1: Plot a graph of mean science scores by country</span></span>
<span id="cb221-2"><a href="#cb221-2"></a><span class="co"># Create a variable avgscience - for every country (Group_by(CNT)) calcuate the mean</span></span>
<span id="cb221-3"><a href="#cb221-3"></a><span class="co"># science score (PV1SCIE) and ignore NA (na.rm=TRUE)</span></span>
<span id="cb221-4"><a href="#cb221-4"></a>avgscience <span class="ot">&lt;-</span> PISA_2018 <span class="sc">%&gt;%</span> </span>
<span id="cb221-5"><a href="#cb221-5"></a>  <span class="fu">group_by</span>(CNT) <span class="sc">%&gt;%</span></span>
<span id="cb221-6"><a href="#cb221-6"></a>  <span class="fu">summarise</span>(<span class="at">mean_sci =</span> <span class="fu">mean</span>(PV1SCIE, <span class="at">na.rm=</span><span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb221-7"><a href="#cb221-7"></a><span class="co"># Arrange in descending order  </span></span>
<span id="cb221-8"><a href="#cb221-8"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(mean_sci))</span>
<span id="cb221-9"><a href="#cb221-9"></a><span class="co"># Plot the data in avgscience, x=CNT (reorder to ascending order), mean science score on the y</span></span>
<span id="cb221-10"><a href="#cb221-10"></a><span class="co"># Change the fill colour to red, rotate the text, locate the text and reduce the font size</span></span>
<span id="cb221-11"><a href="#cb221-11"></a>    <span class="fu">ggplot</span>(<span class="at">data =</span> avgscience, </span>
<span id="cb221-12"><a href="#cb221-12"></a>           <span class="fu">aes</span>(<span class="at">x=</span> <span class="fu">reorder</span>(CNT, <span class="sc">-</span>mean_sci), <span class="at">y=</span>mean_sci)) <span class="sc">+</span></span>
<span id="cb221-13"><a href="#cb221-13"></a>    <span class="fu">geom_col</span>(<span class="at">fill=</span><span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb221-14"><a href="#cb221-14"></a>    <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">hjust=</span><span class="fl">0.95</span>, <span class="at">vjust=</span><span class="fl">0.2</span>, <span class="at">size=</span><span class="dv">5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="task-2-are-there-differences-in-science-scores-by-gender-for-the-total-data-set" class="level3" data-number="9.2.2"><h3 data-number="9.2.2" class="anchored" data-anchor-id="task-2-are-there-differences-in-science-scores-by-gender-for-the-total-data-set">
<span class="header-section-number">9.2.2</span> Task 2 Are there differences in Science scores by gender for the total data set?</h3>
<p>Consider the kinds of variables that represent the science score. What is an appropriate test to determine differences in the means between the two groups? Create two vectors, for boys and girls, that you can feed into the <code>t.test</code> function.</p>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode cell-code" id="cb222"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb222-1"><a href="#cb222-1"></a><span class="co"># Task 2: Are there differences in Science scores by gender for the total data set? (No)</span></span>
<span id="cb222-2"><a href="#cb222-2"></a></span>
<span id="cb222-3"><a href="#cb222-3"></a><span class="co"># Choose the  gender (ST004D01T) and science score columns (PV1SCIE) from  2018 data, filter for males </span></span>
<span id="cb222-4"><a href="#cb222-4"></a><span class="co"># Put that data into MaleSci</span></span>
<span id="cb222-5"><a href="#cb222-5"></a>MaleSci <span class="ot">&lt;-</span> PISA_2018 <span class="sc">%&gt;%</span> </span>
<span id="cb222-6"><a href="#cb222-6"></a>  <span class="fu">select</span>(ST004D01T, PV1SCIE) <span class="sc">%&gt;%</span> </span>
<span id="cb222-7"><a href="#cb222-7"></a>  <span class="fu">filter</span>(ST004D01T <span class="sc">==</span> <span class="st">"Male"</span>)</span>
<span id="cb222-8"><a href="#cb222-8"></a></span>
<span id="cb222-9"><a href="#cb222-9"></a><span class="co"># Choose the  gender (ST004D01T) and science score columns (PV1SCIE) from  2018 data, filter for females </span></span>
<span id="cb222-10"><a href="#cb222-10"></a><span class="co"># Put that data into FemaleSci</span></span>
<span id="cb222-11"><a href="#cb222-11"></a>FemaleSci <span class="ot">&lt;-</span> PISA_2018 <span class="sc">%&gt;%</span> </span>
<span id="cb222-12"><a href="#cb222-12"></a>  <span class="fu">select</span>(CNT, ST004D01T, PV1SCIE) <span class="sc">%&gt;%</span> </span>
<span id="cb222-13"><a href="#cb222-13"></a>  <span class="fu">filter</span>(ST004D01T <span class="sc">==</span> <span class="st">"Female"</span>)</span>
<span id="cb222-14"><a href="#cb222-14"></a></span>
<span id="cb222-15"><a href="#cb222-15"></a><span class="co">#Do a t-test comparing MaleSci and FemaleSci</span></span>
<span id="cb222-16"><a href="#cb222-16"></a><span class="fu">t.test</span>(MaleSci<span class="sc">$</span>PV1SCIE, FemaleSci<span class="sc">$</span>PV1SCIE)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="task-3-are-there-differences-in-science-scores-by-gender-for-uk-students" class="level3" data-number="9.2.3"><h3 data-number="9.2.3" class="anchored" data-anchor-id="task-3-are-there-differences-in-science-scores-by-gender-for-uk-students">
<span class="header-section-number">9.2.3</span> Task 3 Are there differences in Science scores by gender for UK students?</h3>
<p>As above, but include a filter by country.</p>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode cell-code" id="cb223"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb223-1"><a href="#cb223-1"></a><span class="co"># Task 3: Are there differences in Science scores by gender for UK students? (No)</span></span>
<span id="cb223-2"><a href="#cb223-2"></a></span>
<span id="cb223-3"><a href="#cb223-3"></a><span class="co"># Choose the country (CNT), gender (ST004D01T) and science score columns (PV1SCIE) from  2018 data, filter for males and the UK</span></span>
<span id="cb223-4"><a href="#cb223-4"></a><span class="co"># Put that data into UKMaleSci</span></span>
<span id="cb223-5"><a href="#cb223-5"></a>UKMaleSci <span class="ot">&lt;-</span> PISA_2018 <span class="sc">%&gt;%</span> </span>
<span id="cb223-6"><a href="#cb223-6"></a>  <span class="fu">select</span>(CNT, ST004D01T, PV1SCIE) <span class="sc">%&gt;%</span> </span>
<span id="cb223-7"><a href="#cb223-7"></a>  <span class="fu">filter</span>(ST004D01T <span class="sc">==</span> <span class="st">"Male"</span>)  <span class="sc">%&gt;%</span> </span>
<span id="cb223-8"><a href="#cb223-8"></a>  <span class="fu">filter</span>(CNT<span class="sc">==</span><span class="st">"United Kingdom"</span>)</span>
<span id="cb223-9"><a href="#cb223-9"></a></span>
<span id="cb223-10"><a href="#cb223-10"></a><span class="co"># Choose the country (CNT), gender (ST004D01T) and science score columns (PV1SCIE) from  2018 data, filter for females and the UK</span></span>
<span id="cb223-11"><a href="#cb223-11"></a><span class="co"># Put that data into UKFemaleSci</span></span>
<span id="cb223-12"><a href="#cb223-12"></a>UKFemaleSci <span class="ot">&lt;-</span> PISA_2018 <span class="sc">%&gt;%</span> </span>
<span id="cb223-13"><a href="#cb223-13"></a>  <span class="fu">select</span>(CNT, ST004D01T, PV1SCIE) <span class="sc">%&gt;%</span> </span>
<span id="cb223-14"><a href="#cb223-14"></a>  <span class="fu">filter</span>(ST004D01T <span class="sc">==</span> <span class="st">"Female"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb223-15"><a href="#cb223-15"></a>  <span class="fu">filter</span>(CNT<span class="sc">==</span><span class="st">"United Kingdom"</span>)</span>
<span id="cb223-16"><a href="#cb223-16"></a></span>
<span id="cb223-17"><a href="#cb223-17"></a><span class="co"># Do a t-test comparing UKMaleSci and UKFemaleSci</span></span>
<span id="cb223-18"><a href="#cb223-18"></a><span class="fu">t.test</span>(UKMaleSci<span class="sc">$</span>PV1SCIE, UKFemaleSci<span class="sc">$</span>PV1SCIE)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="task-4-for-the-whole-data-set-is-there-a-correlation-between-students-science-score-and-reading-scores" class="level3" data-number="9.2.4"><h3 data-number="9.2.4" class="anchored" data-anchor-id="task-4-for-the-whole-data-set-is-there-a-correlation-between-students-science-score-and-reading-scores">
<span class="header-section-number">9.2.4</span> Task 4 For the whole data set, is there a correlation between students’ science score and reading scores?</h3>
<p>Reflect on the appropriate test to show correlation between two scores. This test can be carried out quite simply using a couple of lines of code.</p>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode cell-code" id="cb224"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb224-1"><a href="#cb224-1"></a><span class="co"># Task 4: For the whole data set, is there a correlation between students’ science score reading score? (Yes, significant 0.77)</span></span>
<span id="cb224-2"><a href="#cb224-2"></a></span>
<span id="cb224-3"><a href="#cb224-3"></a><span class="co"># Do the regression test between science score (PV1SCIE) and reading score (PV1READ) on the PISA_2018 data</span></span>
<span id="cb224-4"><a href="#cb224-4"></a>lmSciRead <span class="ot">&lt;-</span> <span class="fu">lm</span>(PV1SCIE <span class="sc">~</span> PV1READ, <span class="at">data=</span>PISA_2018)</span>
<span id="cb224-5"><a href="#cb224-5"></a><span class="fu">summary</span>(lmSciRead)</span>
<span id="cb224-6"><a href="#cb224-6"></a></span>
<span id="cb224-7"><a href="#cb224-7"></a><span class="co"># Add Gender to this as well? Not sure I have the correct lm type here, but it looks interesting!</span></span>
<span id="cb224-8"><a href="#cb224-8"></a><span class="co"># lmSciRead &lt;- lm(PV1SCIE ~ PV1READ + ST004D01T, data=PISA_2018)</span></span>
<span id="cb224-9"><a href="#cb224-9"></a><span class="co"># summary(lmSciRead)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="task-5-plot-a-representation-of-uk-students-science-score-against-reading-score." class="level3" data-number="9.2.5"><h3 data-number="9.2.5" class="anchored" data-anchor-id="task-5-plot-a-representation-of-uk-students-science-score-against-reading-score.">
<span class="header-section-number">9.2.5</span> Task 5 Plot a representation of UK students’ science score against reading score.</h3>
<p>It can help here to create a <code>data.frame</code> that contains a filtered version of the whole dataset you can pass to ggplot.</p>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode cell-code" id="cb225"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb225-1"><a href="#cb225-1"></a><span class="co"># Task 5: Plot a representation of UK students’ science score against reading score.</span></span>
<span id="cb225-2"><a href="#cb225-2"></a> </span>
<span id="cb225-3"><a href="#cb225-3"></a><span class="co"># Choose the three variables of interest, science score (PV1SCIE), reading score (PV1READ) and country (CNT)</span></span>
<span id="cb225-4"><a href="#cb225-4"></a><span class="co"># and filter for the UK. Put the values into regplotdata</span></span>
<span id="cb225-5"><a href="#cb225-5"></a>regplotdata<span class="ot">&lt;-</span> PISA_2018 <span class="sc">%&gt;%</span> </span>
<span id="cb225-6"><a href="#cb225-6"></a>  <span class="fu">select</span>(PV1SCIE, PV1READ, CNT) <span class="sc">%&gt;%</span> </span>
<span id="cb225-7"><a href="#cb225-7"></a>  <span class="fu">filter</span>(CNT<span class="sc">==</span><span class="st">"United Kingdom"</span>)</span>
<span id="cb225-8"><a href="#cb225-8"></a></span>
<span id="cb225-9"><a href="#cb225-9"></a><span class="co"># Plot the data in regplotdata, set the science score on the x-xis and reading on y-axis, set the size, colour and alpha (transparency)</span></span>
<span id="cb225-10"><a href="#cb225-10"></a><span class="co"># of points and add a linear ('lm') black line</span></span>
<span id="cb225-11"><a href="#cb225-11"></a>  <span class="fu">ggplot</span>(<span class="at">data =</span> regplotdata, </span>
<span id="cb225-12"><a href="#cb225-12"></a>         <span class="fu">aes</span>(<span class="at">x=</span>PV1SCIE, <span class="at">y=</span>PV1READ)) <span class="sc">+</span></span>
<span id="cb225-13"><a href="#cb225-13"></a>    <span class="fu">geom_point</span>(<span class="at">size=</span><span class="fl">0.5</span>, <span class="at">colour=</span><span class="st">"red"</span>, <span class="at">alpha=</span><span class="fl">0.3</span>) <span class="sc">+</span> </span>
<span id="cb225-14"><a href="#cb225-14"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">colour=</span><span class="st">"black"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="task-6-is-there-a-relationship-between-uk-students-gender-and-the-number-of-years-students-spend-in-early-childhood-care-e.g.-kindergarten" class="level3" data-number="9.2.6"><h3 data-number="9.2.6" class="anchored" data-anchor-id="task-6-is-there-a-relationship-between-uk-students-gender-and-the-number-of-years-students-spend-in-early-childhood-care-e.g.-kindergarten">
<span class="header-section-number">9.2.6</span> Task 6 Is there a relationship between UK students’ gender and the number of years students spend in early childhood care (e.g.&nbsp;kindergarten)?</h3>
<p>Note here that the time spent learning science (SMIS) is categorical as only certain values of time are allowed (0, 45, 90, 130 etc). Consider an appropriate test in that case.</p>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode cell-code" id="cb226"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb226-1"><a href="#cb226-1"></a><span class="co"># Task 6: Is there a relationship between UK students’ gender and the number of years students spend in early childhood care (e.g. kindergarten)? (No significant difference by gender exists)</span></span>
<span id="cb226-2"><a href="#cb226-2"></a>  </span>
<span id="cb226-3"><a href="#cb226-3"></a>chi_data <span class="ot">&lt;-</span> PISA_2018 <span class="sc">%&gt;%</span></span>
<span id="cb226-4"><a href="#cb226-4"></a>  <span class="fu">select</span>(CNT, ST004D01T, DURECEC) <span class="sc">%&gt;%</span> </span>
<span id="cb226-5"><a href="#cb226-5"></a>  <span class="fu">filter</span>(CNT<span class="sc">==</span><span class="st">"United Kingdom"</span>)  <span class="sc">%&gt;%</span> </span>
<span id="cb226-6"><a href="#cb226-6"></a>  <span class="fu">na.omit</span>()</span>
<span id="cb226-7"><a href="#cb226-7"></a></span>
<span id="cb226-8"><a href="#cb226-8"></a><span class="co"># Create a frequency table</span></span>
<span id="cb226-9"><a href="#cb226-9"></a>YrsECFred <span class="ot">&lt;-</span> chi_data <span class="sc">%&gt;%</span></span>
<span id="cb226-10"><a href="#cb226-10"></a>    <span class="fu">group_by</span>(ST004D01T, DURECEC)<span class="sc">%&gt;%</span></span>
<span id="cb226-11"><a href="#cb226-11"></a>    <span class="fu">count</span>()</span>
<span id="cb226-12"><a href="#cb226-12"></a>  </span>
<span id="cb226-13"><a href="#cb226-13"></a><span class="co"># Perform the Kruskal Wallis test (note the no of years is</span></span>
<span id="cb226-14"><a href="#cb226-14"></a><span class="co"># ordinal rather than categorical)  test on the data</span></span>
<span id="cb226-15"><a href="#cb226-15"></a></span>
<span id="cb226-16"><a href="#cb226-16"></a><span class="fu">kruskal.test</span>(YrsECFred<span class="sc">$</span>ST004D01T,YrsECFred<span class="sc">$</span>n)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section></section></section><section id="setting-up-analysis-for-specific-datasets" class="level1" data-number="10"><h1 data-number="10">
<span class="header-section-number">10</span> Setting up analysis for specific datasets</h1>
<p>The examples shown in this booklet use a range of freely available datasets. We would like to encourage you to use one of these datasets in your own analysis, but you are welcome to use other datasets if agreed with your supervisor. This section will take you through the process of downloading, understanding and using these datasets.</p>
<section id="pisa" class="level2" data-number="10.1"><h2 data-number="10.1" class="anchored" data-anchor-id="pisa">
<span class="header-section-number">10.1</span> PISA</h2>
</section><section id="what-is-pisa" class="level2" data-number="10.2"><h2 data-number="10.2" class="anchored" data-anchor-id="what-is-pisa">
<span class="header-section-number">10.2</span> What is PISA</h2>
<p>The Programme for International Student Assessment (PISA) is an OECD initiative that looks at the reading, mathematics and science abilities of students aged 15 years old. Data is collected from ~38 OECD countries and other partner countries every three years.</p>
<table class="table">
<thead><tr class="header">
<th>Dataset</th>
<th>Description</th>
<th style="text-align: center;">03</th>
<th style="text-align: center;">06</th>
<th style="text-align: center;">09</th>
<th style="text-align: center;">12</th>
<th style="text-align: center;">15</th>
<th style="text-align: center;">18</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Student</td>
<td>demographic data on student participants</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;"><a href="https://drive.google.com/file/d/1-41Ynn4hzEL1vO2L-wIqdRotXDtDdjYh/view?usp=share_link">x</a></td>
<td style="text-align: center;"><a href="https://drive.google.com/file/d/1sO-W2fPKNK51cpeMpxYaJ_6hOjrFAdqc/view?usp=share_link">x</a></td>
<td style="text-align: center;"><a href="https://drive.google.com/file/d/1lQs5mMgG5u7T3qu-9Sei5as8viiw2hAL/view?usp=share_link">x</a></td>
</tr>
<tr class="even">
<td>School</td>
<td>descriptive data about schools</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;"><a href="https://drive.google.com/file/d/1wWfsZcGW2nGFloS0CUOX1DlX7KdptxQr/view?usp=share_link">x</a></td>
<td style="text-align: center;"><a href="https://drive.google.com/file/d/1sIrtiz035J4OT3-eHUhECIwtzfdDTCEa/view?usp=share_link">x</a></td>
<td style="text-align: center;"><a href="https://drive.google.com/file/d/1lEnN4P5wg6wFHeiA8lljLwtg2gar21BV/view?usp=share_link">x</a></td>
</tr>
<tr class="odd">
<td>Parent</td>
<td>a survey for student’s parents including information about home environments and parental education</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td>Teacher</td>
<td>demographic, teaching, qualification and training data</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">x</td>
<td style="text-align: center;"><a href="https://drive.google.com/file/d/1sK-kbiPJv8GPZP47vBfeIc1xD4Ex0jbk/view?usp=share_link">x</a></td>
<td style="text-align: center;"><a href="https://drive.google.com/file/d/1lKQYKOB0HIXzklelwIZF6IFBJ6KqPX1R/view?usp=share_link">x</a></td>
</tr>
<tr class="odd">
<td>Cognitive</td>
<td></td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;"><a href="https://drive.google.com/file/d/19GLw1-YA1aJGWoCWXfZGtUWnQi4pcjik/view?usp=share_link">x</a></td>
<td style="text-align: center;"><a href="https://drive.google.com/file/d/1sTpe3TJSnByhZdxzezkmXjH2uTH9TOUP/view?usp=share_link">x</a></td>
<td style="text-align: center;"><a href="https://drive.google.com/file/d/1nhwySp0A-LHfN-oO8HES9PQOIDZNmOzT/view?usp=share_link">x</a></td>
</tr>
</tbody>
</table>
<p>PISA datasets above can be found on the <a href="https://www.oecd.org/pisa/data/">OECD website</a>. The links in the table above will allow you to download .rds versions of these files which we have created, though they might need additional editing, e.g.&nbsp;reducing the number of columns or changing the types of each column. If you want to find out more about what each field stores, take a look at the corresponding codebook, for example from <a href="https://webfs.oecd.org/pisa2018/PISA2018_CODEBOOK.xlsx">2018</a>.</p>
</section><section id="how-to-use-it" class="level2" data-number="10.3"><h2 data-number="10.3" class="anchored" data-anchor-id="how-to-use-it">
<span class="header-section-number">10.3</span> How to use it</h2>
<p>The PISA datasets come in <em>SPSS</em> or <em>SAS</em> formats. The data used in this course comes directly from downloading the SPSS <code>.sav</code> files and using the <code>haven</code> package to clean it into a native R format suitable for analysis. There are a few quirks that you need to be aware of:</p>
<ul>
<li><p>R uses levels (factors) instead of labelled data</p></li>
<li><p>All SPSS fields are <em>labelled</em>, and auto conversion into the native R dataframe format would make numeric fields factors(!?). To avoid this confusion we have stripped out the no-response data and replaced it with <code>NA</code> values. This means that you won’t be able to tell the reason that a field is missing, and the following labels have all been set to NA:</p></li>
</ul>
<table class="table">
<caption>Labels set to NA in .rds file</caption>
<thead><tr class="header">
<th>value</th>
<th>label</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>95</td>
<td>Valid Skip</td>
</tr>
<tr class="even">
<td>97</td>
<td>Not Applicable</td>
</tr>
<tr class="odd">
<td>98</td>
<td>Invalid</td>
</tr>
<tr class="even">
<td>99</td>
<td>No Response</td>
</tr>
</tbody>
</table>
<ul>
<li>As the fields are now using R’s native factor format you might find that the data doesn’t quite match the format of the table labels. For example, <code>CNT</code> is labelled “Country code 3-character”, but the data is now instead the full country name.</li>
<li>the examples shown above use cut down PISA datasets, where only a limited number of columns are included.</li>
</ul></section><section id="common-issues" class="level2" data-number="10.4"><h2 data-number="10.4" class="anchored" data-anchor-id="common-issues">
<span class="header-section-number">10.4</span> Common issues</h2>
<p>The PISA datasets can be absolutely huge and might bring your computer to its knees; if you are using a computer with less than 16Gb of RAM you might not be able to load some tables at all. Tables such as the <em>Cognitive</em> dataset have hundreds of thousands of rows and thousands of columns, loading them directly might lead to an error similar to this: <code>Error: cannot allocate vector of size 2.1 Gb</code>. This means that R can’t find enough RAM to load the dataset and has given up. You can see a rough estimate of how much RAM R is currently using the top Environment panel:</p>
<p><img src="./images/environment-RAM.png" class="img-fluid"></p>
<p>To get around this issues you can try to clean your current R environment using the brush tool:</p>
<p><img src="./images/environment-brush.png" class="img-fluid"></p>
<p>This will drop all the current dataframes, objects, functions and packages that you have loaded meaning you will have to reload packages such as <code><a href="https://tidyverse.tidyverse.org">library(tidyverse)</a></code> and <code><a href="https://haven.tidyverse.org">library(haven)</a></code> before you can attempt to reload the PISA tables.</p>
<p>A lack of RAM might also be the result of lots of other programs running concurrently on your computer. Try to close anything that you don’t need, web browsers can be particularly RAM hungry, so close them or as many tabs as you can.</p>
<p>If none of the above works, then please get in touch with the team, letting them know which table you need from which year, with which fields and for which countries. We will be able to provide you with a cutdown dataset.</p>
</section><section id="questions-7" class="level2" data-number="10.5"><h2 data-number="10.5" class="anchored" data-anchor-id="questions-7">
<span class="header-section-number">10.5</span> Questions</h2>
<section id="sec-PV" class="level3" data-number="10.5.1"><h3 data-number="10.5.1" class="anchored" data-anchor-id="sec-PV">
<span class="header-section-number">10.5.1</span> What are Plausible Values?</h3>
<p>In the PISA dataset, the outcomes of student tests are reported as plausible values, for example, in the variables of the science test (<code>PV1SCIE</code>, <code>PV2SCIE</code>, <code>PV3SCIE</code>, <code>PV3SCIE</code>, and <code>PV5SCIE</code>). It might seem counter intuitive that there are five values for a score on a test.</p>
<p>Plausible values (PVs) are a way of expressing the error in a measurement. The number of questions in the full PISA survey is very large, so students are randomly allocated to take a subset of questions (and even then, the test still takes two hours!). As no student completes the full set of questions, estimating how a student would have performed on the full question set involves some error. Plausible values are a way of expressing the uncertainty in the estimation of student scores.</p>
<p>One way of thinking of the PV scores is that they represent five different estimates of students’ abilities based on the questions they have answered. To decrease measurement error, five different approaches are applied to create five different estimates, the PV scores.</p>
<p>The PISA Data Analysis Manual suggests:</p>
<blockquote class="blockquote">
<p>Population statistics should be estimated using each plausible value separately. The reported population statistic is then the average of each plausible value statistic. For instance, if one is interested in the correlation coefficient between the social index and the reading performance in PISA, then five correlation coefficients should be computed and then averaged</p>
<p>Plausible values should never be averaged at the student level, i.e.&nbsp;by computing in the dataset the mean of the five plausible values at the student level and then computing the statistic of interest once using that average PV value. Doing so would be equivalent to an EAP estimate, with a bias as described in the previous section.</p>
<p>(p.&nbsp;100) <span class="citation" data-cites="monseur2009pisa">Monseur et al. (<a href="#ref-monseur2009pisa" role="doc-biblioref">2009</a>)</span></p>
</blockquote>
<ul>
<li>What are PV Values - exclude non-OECD? as mean too low</li>
<li>difference between TA and NA for field names</li>
</ul></section><section id="why-are-some-countries-oecd-countries-and-others-arent" class="level3" data-number="10.5.2"><h3 data-number="10.5.2" class="anchored" data-anchor-id="why-are-some-countries-oecd-countries-and-others-arent">
<span class="header-section-number">10.5.2</span> Why are some countries OECD countries and others aren’t?</h3>
<p>The Organisation for Economic Co-operation and Development (OECD) has 38 member states. PISA is run by the OECD and its member states normally take part in each PISA cycle, but other countries are allowed to take part as <em>Partners</em>. You can find more details on participation <a href="https://www.oecd.org/pisa/aboutpisa/pisa-participants.htm">here</a>.</p>
<p>Results for OECD members are generally higher than for Partner countries:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb227"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb227-1"><a href="#cb227-1"></a>PISA_2018 <span class="sc">%&gt;%</span> </span>
<span id="cb227-2"><a href="#cb227-2"></a>  <span class="fu">group_by</span>(OECD) <span class="sc">%&gt;%</span> </span>
<span id="cb227-3"><a href="#cb227-3"></a>  <span class="fu">summarise</span>(<span class="at">country_n =</span> <span class="fu">length</span>(<span class="fu">unique</span>(CNT)),</span>
<span id="cb227-4"><a href="#cb227-4"></a>            <span class="at">math_mean =</span> <span class="fu">mean</span>(PV1MATH, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb227-5"><a href="#cb227-5"></a>            <span class="at">math_sd =</span> <span class="fu">sd</span>(PV1MATH, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb227-6"><a href="#cb227-6"></a>            <span class="at">students_n =</span> <span class="fu">n</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 5
  OECD  country_n math_mean math_sd students_n
  &lt;fct&gt;     &lt;int&gt;     &lt;dbl&gt;   &lt;dbl&gt;      &lt;int&gt;
1 No           43      434.   106.      317477
2 Yes          37      490.    93.8     294527</code></pre>
</div>
</div>
</section><section id="why-are-the-pv-grades-pivoting-around-the-500-mark" class="level3" data-number="10.5.3"><h3 data-number="10.5.3" class="anchored" data-anchor-id="why-are-the-pv-grades-pivoting-around-the-500-mark">
<span class="header-section-number">10.5.3</span> Why are the PV grades pivoting around the ~500 mark?</h3>
</section><section id="why-are-the-letters-ta-and-na-used-in-some-field-names" class="level3" data-number="10.5.4"><h3 data-number="10.5.4" class="anchored" data-anchor-id="why-are-the-letters-ta-and-na-used-in-some-field-names">
<span class="header-section-number">10.5.4</span> Why are the letters TA and NA used in some field names?</h3>
</section></section><section id="interesting-papers-and-reading-on-pisa" class="level2" data-number="10.6"><h2 data-number="10.6" class="anchored" data-anchor-id="interesting-papers-and-reading-on-pisa">
<span class="header-section-number">10.6</span> Interesting papers and reading on PISA</h2>
<p>Jerrim <span class="citation" data-cites="jiang2015effects">Jiang and McComas (<a href="#ref-jiang2015effects" role="doc-biblioref">2015</a>)</span> <span class="citation" data-cites="monseur2009pisa">Monseur et al. (<a href="#ref-monseur2009pisa" role="doc-biblioref">2009</a>)</span></p>
</section><section id="copyright" class="level2" data-number="10.7"><h2 data-number="10.7" class="anchored" data-anchor-id="copyright">
<span class="header-section-number">10.7</span> Copyright</h2>
<blockquote class="blockquote">
<p>All PISA products are published under the <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/igo/">Creative Commons Attribution-NonCommercial-ShareAlike 3.0 IGO</a> (CC BY-NC-SA 3.0 IGO)</p>
</blockquote>
<p>This includes the rds formatted datasets linked above.</p>
</section><section id="english-department-for-education" class="level2" data-number="10.8"><h2 data-number="10.8" class="anchored" data-anchor-id="english-department-for-education">
<span class="header-section-number">10.8</span> English Department for Education</h2>
<p>Education provider details https://www.get-information-schools.service.gov.uk/Downloads</p>
<p>Results</p>
</section><section id="timss" class="level2" data-number="10.9"><h2 data-number="10.9" class="anchored" data-anchor-id="timss">
<span class="header-section-number">10.9</span> TIMSS</h2>
</section><section id="other-datasets" class="level2" data-number="10.10"><h2 data-number="10.10" class="anchored" data-anchor-id="other-datasets">
<span class="header-section-number">10.10</span> Other datasets</h2>
<p>Gender development index:</p>
<p>https://hdr.undp.org/gender-development-index#/indicies/GDI</p>
<div class="cell">

</div>
<p>ONS</p>
<p>https://www.ons.gov.uk/census/2011census/2011censusdata</p>
<p>https://www.ons.gov.uk/peoplepopulationandcommunity/populationandmigration/populationestimates/datasets/populationandhouseholdestimatesenglandandwalescensus2021</p>
<div class="cell">

</div>
</section></section><section id="questions-and-answers" class="level1" data-number="11"><h1 data-number="11">
<span class="header-section-number">11</span> Questions and answers</h1>
<section id="sec-QANDA" class="level2" data-number="11.1"><h2 data-number="11.1" class="anchored" data-anchor-id="sec-QANDA">
<span class="header-section-number">11.1</span> About R</h2>
<p><strong>Why doesn’t my <code>select</code>/<code>filter</code> statement work?</strong></p>
<p>When you are loading packages, sometimes different packages have the same function names in them, and the functions themselves will do very different things. For example, there is a <code>select</code> function in the <code>tidyverse</code>, but also <em>another</em> <code>select</code> function in the package <code>MASS</code> that does something very different. If we load the tidyverse before loading MASS, then the MASS version of select is the one that will be used?!</p>
<div class="cell">

</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb229"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb229-1"><a href="#cb229-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb229-2"><a href="#cb229-2"></a><span class="fu">library</span>(MASS)</span>
<span id="cb229-3"><a href="#cb229-3"></a></span>
<span id="cb229-4"><a href="#cb229-4"></a>diamonds <span class="sc">%&gt;%</span> <span class="fu">select</span>(carat, cut, color)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To get around this make sure that you load the <code>tidyverse</code> <em>after</em> <code>MASS</code>, in fact you should always load the <code>tidyverse</code> last.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb230"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb230-1"><a href="#cb230-1"></a><span class="fu">library</span>(MASS) </span>
<span id="cb230-2"><a href="#cb230-2"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb230-3"><a href="#cb230-3"></a></span>
<span id="cb230-4"><a href="#cb230-4"></a>diamonds <span class="sc">%&gt;%</span> <span class="fu">select</span>(carat, cut, color)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 53,940 × 3
   carat cut       color
   &lt;dbl&gt; &lt;ord&gt;     &lt;ord&gt;
 1  0.23 Ideal     E    
 2  0.21 Premium   E    
 3  0.23 Good      E    
 4  0.29 Premium   I    
 5  0.31 Good      J    
 6  0.24 Very Good J    
 7  0.24 Very Good I    
 8  0.26 Very Good H    
 9  0.22 Fair      E    
10  0.23 Very Good H    
# … with 53,930 more rows</code></pre>
</div>
</div>
<p>you can also specify the package that select comes from (in this case from a package within the <code>tidyverse</code> called <code>dplyr</code>):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb232"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb232-1"><a href="#cb232-1"></a>diamonds <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(carat, cut, color)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 53,940 × 3
   carat cut       color
   &lt;dbl&gt; &lt;ord&gt;     &lt;ord&gt;
 1  0.23 Ideal     E    
 2  0.21 Premium   E    
 3  0.23 Good      E    
 4  0.29 Premium   I    
 5  0.31 Good      J    
 6  0.24 Very Good J    
 7  0.24 Very Good I    
 8  0.26 Very Good H    
 9  0.22 Fair      E    
10  0.23 Very Good H    
# … with 53,930 more rows</code></pre>
</div>
</div>
<p><strong>How can I unload packages</strong></p>
<p>If you are finding yourself with a conflict as mentioned above and want to <code>unload</code> packages, then you need to run the following code:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb234"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb234-1"><a href="#cb234-1"></a><span class="co"># adapted from: @mmfrgmpds https://stackoverflow.com/questions/7505547/detach-all-packages-while-working-in-r</span></span>
<span id="cb234-2"><a href="#cb234-2"></a><span class="cf">while</span>(<span class="sc">!</span><span class="fu">is.null</span>(<span class="fu">sessionInfo</span>()<span class="sc">$</span>loadedOnly)){</span>
<span id="cb234-3"><a href="#cb234-3"></a>  <span class="fu">lapply</span>(<span class="fu">names</span>(<span class="fu">sessionInfo</span>()<span class="sc">$</span>loadedOnly), require, <span class="at">character.only =</span> <span class="cn">TRUE</span>)</span>
<span id="cb234-4"><a href="#cb234-4"></a>  <span class="fu">invisible</span>(<span class="fu">lapply</span>(<span class="fu">paste0</span>(<span class="st">'package:'</span>, <span class="fu">names</span>(<span class="fu">sessionInfo</span>()<span class="sc">$</span>otherPkgs)), detach, <span class="at">character.only=</span><span class="cn">TRUE</span>, <span class="at">unload=</span><span class="cn">TRUE</span>, <span class="at">force=</span><span class="cn">TRUE</span>))    </span>
<span id="cb234-5"><a href="#cb234-5"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="about-the-coursework" class="level2" data-number="11.2"><h2 data-number="11.2" class="anchored" data-anchor-id="about-the-coursework">
<span class="header-section-number">11.2</span> About the coursework</h2>
<p>?filter</p>
</section></section><section id="references" class="level1" data-number="12"><h1 data-number="12">
<span class="header-section-number">12</span> References</h1>



</section><div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" role="doc-bibliography">
<div id="ref-berman1977" class="csl-entry" role="doc-biblioentry">
Berman, P., M. McLaughlin, G. Bass, E. Pauly, and G. Zellman. 1977. <span>“Federal Programs Supporting Educational Change. Vol. VII. Factors Affecting Implementation and Continuation.”</span> <em><span>RAND</span> Corporation</em>. <a href="https://files.eric.ed.gov/fulltext/ED140432.pdf">https://files.eric.ed.gov/fulltext/ED140432.pdf</a>.
</div>
<div id="ref-davis2013introduction" class="csl-entry" role="doc-biblioentry">
Davis, Lennard J. 2013. <span>“Introduction: Normality, Power, and Culture.”</span> <em>The Disability Studies Reader</em> 4: 1–14. <a href="https://ieas-szeged.hu/downtherabbithole/wp-content/uploads/2018/02/Lennard-J.-Davis-ed.-The-Disability-Studies-Reader-Routledge-2014.pdf#page=15">https://ieas-szeged.hu/downtherabbithole/wp-content/uploads/2018/02/Lennard-J.-Davis-ed.-The-Disability-Studies-Reader-Routledge-2014.pdf#page=15</a>.
</div>
<div id="ref-du2019science" class="csl-entry" role="doc-biblioentry">
Du, Xin, and Billy Wong. 2019. <span>“Science Career Aspiration and Science Capital in China and UK: A Comparative Study Using PISA Data.”</span> <em>International Journal of Science Education</em> 41 (15): 2136–55.
</div>
<div id="ref-gibson1984" class="csl-entry" role="doc-biblioentry">
Gibson, Sherri, and Myron H. Dembo. 1984. <span>“Teacher Efficacy: A Construct Validation.”</span> <em>Journal of Educational Psychology</em> 76 (4): 569–82. <a href="https://doi.org/10.1037/0022-0663.76.4.569">https://doi.org/10.1037/0022-0663.76.4.569</a>.
</div>
<div id="ref-jiang2015effects" class="csl-entry" role="doc-biblioentry">
Jiang, Feng, and William F McComas. 2015. <span>“The Effects of Inquiry Teaching on Student Science Achievement and Attitudes: Evidence from Propensity Score Analysis of PISA Data.”</span> <em>International Journal of Science Education</em> 37 (3): 554–76. <a href="https://www.tandfonline.com/doi/full/10.1080/09500693.2014.1000426?casa_token=fgGJdfxGtpgAAAAA%3APlZg4i0qZhJEnDine0zKSVoWS8ylQ8eddQBr18Gid9xADlIWaDWh_tZLy8ozpMmJ5zl0Jo3c5TcmTw">https://www.tandfonline.com/doi/full/10.1080/09500693.2014.1000426?casa_token=fgGJdfxGtpgAAAAA%3APlZg4i0qZhJEnDine0zKSVoWS8ylQ8eddQBr18Gid9xADlIWaDWh_tZLy8ozpMmJ5zl0Jo3c5TcmTw</a>.
</div>
<div id="ref-monseur2009pisa" class="csl-entry" role="doc-biblioentry">
Monseur, Christian et al. 2009. <span>“PISA Data Analysis Manual: Spss Second Edition.”</span> <a href="https://www.oecd-ilibrary.org/docserver/9789264056275-en.pdf?expires=1672909117&amp;id=id&amp;accname=guest&amp;checksum=3AD95B021546E6CB9B93D8895B011056">https://www.oecd-ilibrary.org/docserver/9789264056275-en.pdf?expires=1672909117&amp;id=id&amp;accname=guest&amp;checksum=3AD95B021546E6CB9B93D8895B011056</a>.
</div>
<div id="ref-mutodi2014influence" class="csl-entry" role="doc-biblioentry">
Mutodi, Paul, and Hlanganipai Ngirande. 2014. <span>“The Influence of Studentsperceptions on Mathematics Performance. A Case of a Selected High School in South Africa.”</span> <em>Mediterranean Journal of Social Sciences</em> 5 (3): 431.
</div>
<div id="ref-pasha-zaidi2016" class="csl-entry" role="doc-biblioentry">
Pasha-Zaidi, Nausheen, and Ernest Afari. 2016. <span>“Gender in STEM Education: An Exploratory Study of Student Perceptions of Math and Science Instructors in the United Arab Emirates.”</span> <em>International Journal of Science and Mathematics Education</em> 14 (7): 12151231. <a href="https://link.springer.com/article/10.1007/s10763-015-9656-z">https://link.springer.com/article/10.1007/s10763-015-9656-z</a>.
</div>
<div id="ref-pring2000" class="csl-entry" role="doc-biblioentry">
Pring, Richard. 2000. <span>“The <span>‘</span>False Dualism<span>’</span> of Educational Research.”</span> <em>Journal of Philosophy of Education</em> 34 (2): 247–60. <a href="https://doi.org/10.1111/1467-9752.00171">https://doi.org/10.1111/1467-9752.00171</a>.
</div>
</div></section><section class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>
<ol>
<li id="fn1" role="doc-endnote"><p>As of November 2022, <a href="https://www.tiobe.com/tiobe-index/">Tiobe</a> has R as the 12th most popular programming language. Many other, contradictory, ranking systems exist.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2" role="doc-endnote"><p><code>camelCase</code> has a capital letter in the front or front and middle forming the camel’s hump(s), there are multiple <a href="https://en.wikipedia.org/wiki/Naming_convention_(programming)">naming conventions</a>, it doesn’t matter which you pick, just stick to one of them.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3" role="doc-endnote"><p><code>camelCase</code> has a capital letter in the front or front and middle forming the camel’s hump(s), there are multiple <a href="https://en.wikipedia.org/wiki/Naming_convention_(programming)">naming conventions</a>, it doesn’t matter which you pick, just stick to one of them.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4" role="doc-endnote"><p>R was created to allow for <a href="https://en.wikipedia.org/wiki/Array_programming"><em>vector programming</em></a>, that is a programming language where you can apply operations to entire sets of values (vectors) at the same time, rather than having to cycle through them individually. Vector languages work in a way that is close to how mathematical notation works, making them well suited for performing mathematical functions.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5" role="doc-endnote"><p>You’ll sometimes see the words package and library used interchangeably, technically the <em>library</em> is the place where the <em>packages</em> are stored.<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn6" role="doc-endnote"><p>Even in this cut down format the PISA data might take a few minutes to load. You can find the full dataset <a href="https://drive.google.com/file/d/1lQs5mMgG5u7T3qu-9Sei5as8viiw2hAL/view?usp=share_link">here</a>, but be warned, it might crash you machine when trying to load it! Plug your laptop into a power supply, and having 16GB of RAM highly recommended! You might also need to wrangle some of the fields to make them work for your purposes, you might enjoy the challenge!<a href="#fnref6" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol></section></div></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>